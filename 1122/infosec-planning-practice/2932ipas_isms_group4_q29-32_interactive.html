<!-- filename: ipas_isms_group4_q29-32_interactive.html -->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPAS 資安規劃實務衝刺班 - 題組4解析</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --error-color: #c0392b;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #333333;
            --border-color: #e0e0e0;
            --highlight-color: #fff3cd;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans TC", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1, h2, h3 {
            color: var(--primary-color);
            font-weight: 600;
        }

        h1 { font-size: 1.8rem; margin-bottom: 1rem; text-align: center; }
        h2 { font-size: 1.4rem; border-left: 5px solid var(--accent-color); padding-left: 10px; margin-top: 1.5rem; }
        h3 { font-size: 1.1rem; margin-top: 1rem; color: var(--secondary-color); }

        /* Scenario Card */
        .scenario-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-top: 4px solid var(--primary-color);
        }

        .scenario-title {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
            display: block;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 5px;
        }

        .tab-btn {
            background: #e9ecef;
            border: none;
            padding: 10px 20px;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
            font-size: 1rem;
            color: #666;
            transition: all 0.2s;
            flex: 1;
            white-space: nowrap;
        }

        .tab-btn.active {
            background: var(--card-bg);
            color: var(--accent-color);
            font-weight: bold;
            border-top: 3px solid var(--accent-color);
            box-shadow: 0 -2px 5px rgba(0,0,0,0.05);
        }

        .tab-btn.completed::after {
            content: " ✓";
            color: var(--success-color);
            font-weight: bold;
        }

        /* Question Content */
        .question-container {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: none; /* Controlled by JS */
        }
        
        .question-container.active {
            display: block;
        }

        /* Interactive Elements */
        .keyword {
            cursor: pointer;
            border-bottom: 2px dotted #aaa;
            transition: background 0.2s;
        }

        .keyword:hover {
            background-color: #f0f0f0;
        }

        .keyword.active {
            background-color: #ffd700;
            color: #000;
            border-bottom: 2px solid #b8860b;
        }

        /* Quiz Options */
        .options-group {
            margin: 20px 0;
        }

        .option-label {
            display: block;
            padding: 12px 15px;
            margin-bottom: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option-label:hover {
            background-color: #f8f9fa;
            border-color: #bbb;
        }

        .option-input {
            margin-right: 10px;
        }
        
        /* Feedback Styles */
        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-weight: bold;
            display: none;
        }
        
        .feedback.correct {
            background-color: #d4edda;
            color: #155724;
            display: block;
        }
        
        .feedback.wrong {
            background-color: #f8d7da;
            color: #721c24;
            display: block;
        }

        /* Explanation Section */
        .explanation-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px dashed #ddd;
            display: none;
        }

        .explanation-section.visible {
            display: block;
        }

        .step-block {
            background: #fff;
            border-left: 4px solid var(--accent-color);
            padding: 15px;
            margin-bottom: 15px;
        }

        .step-title {
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 5px;
            font-size: 0.95rem;
        }

        .mnemonic-box {
            background-color: #e8f4fd;
            border: 1px solid #b6e0fe;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }

        .trap-box {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }

        /* Buttons */
        .btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            margin-right: 10px;
        }

        .btn:hover {
            background-color: #2980b9;
        }

        .btn-toggle {
            background-color: #95a5a6;
        }
        
        .btn-toggle:hover {
            background-color: #7f8c8d;
        }

        /* Spoiler */
        .spoiler-content {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        .spoiler-btn {
            background: none;
            border: 1px solid #ccc;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.9rem;
            border-radius: 4px;
        }

        /* Glossary */
        .glossary-section {
            margin-top: 40px;
            border-top: 2px solid #333;
            padding-top: 20px;
        }

        .glossary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .glossary-item {
            background: #fff;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .completion-msg {
            text-align: center;
            padding: 20px;
            background: #d4edda;
            color: #155724;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            font-weight: bold;
        }

        @media (max-width: 600px) {
            .tabs { flex-wrap: wrap; }
            .tab-btn { flex: 1 1 40%; font-size: 0.9rem; }
            h1 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>iPAS 資安規劃實務衝刺 - 題組4 互動解析</h1>

    <div id="completion-message" class="completion-msg">
        恭喜完成所有題目！請複習下方的名詞小字典。
    </div>

    <div class="scenario-card">
        <span class="scenario-title">【題組情境卡】</span>
        <p>A 公司主要業務為客戶提供客製化軟體系統之開發、維護以及主機代管服務。</p>
        <p>因為甲客戶（<span class="keyword" onclick="toggleKw(this)">資通安全管理法</span>規範對象）要求 A 公司於承接委託方所委託之系統平台開發業務（委託業務費為新台幣一仟萬元整，部分系統利用<span class="keyword" onclick="toggleKw(this)">第三方公司</span>所開發之系統）時，A 公司應有 <span class="keyword" onclick="toggleKw(this)">ISO 27001</span> 資訊安全管理制度之導入並適用於<span class="keyword" onclick="toggleKw(this)">全公司人員</span>，以確保委託方所委託業務之資訊安全獲得保障。（題目附圖略）</p>
    </div>

    <div class="tabs" id="tab-container">
        <!-- Tabs generated by JS -->
    </div>

    <div id="questions-wrapper">
        <!-- Questions generated by JS -->
    </div>

    <div class="glossary-section">
        <h2>名詞小字典（必考重點）</h2>
        <div class="glossary-grid" id="glossary-grid">
            <!-- Glossary items generated by JS -->
        </div>
    </div>
</div>

<script>
    // Data Structure
    const questions = [
        {
            id: 29,
            type: 'multi',
            title: "題目 29（複選）：導入範圍評估",
            text: "A 公司為滿足甲客戶要求，正評估導入 ISO 27001 資訊安全管理制度之範圍。試問 A 公司針對導入範圍評估過程與結果之敘述，下列哪些正確？",
            options: [
                { id: 'A', text: "將甲客戶的需求與期望納入利害關係方議題調查過程" },
                { id: 'B', text: "將 A 公司高層對於組織內部資訊安全的需求與期望納入利害關係方議題調查過程" },
                { id: 'C', text: "將 A 公司軟體系統之開發、維護之業務活動納入 ISO 27001 導入範圍" },
                { id: 'D', text: "將 A 公司主機代管服務之業務活動排除納入 ISO 27001 導入範圍" }
            ],
            correct: ['A', 'B', 'C'],
            keywords: ["ISO 27001", "導入範圍", "利害關係方", "議題調查", "排除"],
            steps: {
                step1: "重點在「甲客戶要求」、「全公司人員」、「開發、維護、主機代管」。注意 ISO 27001 條款 4.1 (組織背景) 與 4.2 (利害關係人需求)。",
                step2: "題目問的是：A 公司要怎麼決定資安制度要管多寬？誰的意見要聽？哪些業務要管？",
                step3: "ISO 27001 要求我們必須了解「利害關係人（Stakeholders）」想要什麼。甲客戶是付錢的老闆，A 公司高層是自家老闆，兩邊的需求都要聽。情境說「適用於全公司人員」，且 A 公司業務包含「主機代管」，所以不能故意把主機代管切出去不管。",
                step4: "<ul><li>(A) 正確：客戶是外部最重要的利害關係人。</li><li>(B) 正確：高層是內部最重要的利害關係人。</li><li>(C) 正確：這是核心受託業務，一定要納入。</li><li>(D) 錯誤：情境提到「適用於全公司人員」且主機代管是 A 公司主要業務之一，刻意排除不符合情境要求，也無法讓甲客戶安心。</li></ul>"
            },
            supplement: "<strong>ISMS 範圍 (Scope)：</strong>決定資安管理制度邊界的過程。雖然 ISO 允許排除部分範圍，但不能為了「容易過關」而排除核心業務或客戶要求的業務。",
            mnemonic: "範圍界定看邊界，內外需求全聽見；核心業務不可切，主機代管也得練。",
            trap: "考生常以為可以隨意切割驗證範圍（Scope）。實務上雖然可以切，但若情境已說明「全公司適用」或「客戶要求保障」，就不能隨意排除。",
            selfTest: [
                { q: "利害關係人只包含付錢的客戶嗎？", a: "錯。還包含員工、股東、主管機關、供應商等。" },
                { q: "ISMS 範圍一旦決定就永遠不能變嗎？", a: "錯。隨業務變更或定期審查，範圍可調整。" }
            ]
        },
        {
            id: 30,
            type: 'single',
            title: "題目 30（單選）：風險管理與適用性聲明",
            text: "A 公司為了執行軟體系統之開發、維護業務活動內有關資訊資產的風險管理事項，因此實施了一系列作為。試問下列何者錯誤？",
            options: [
                { id: 'A', text: "盤點人員、軟體、硬體、服務與資訊類資產並計算資產價值" },
                { id: 'B', text: "識別弱點與威脅並考量衝擊以計算風險值" },
                { id: 'C', text: "對不可接受之風險採取控制措施降低至可接受程度" },
                { id: 'D', text: "依控制措施結果，於適用性聲明排除「資訊系統獲取、開發及維護」之適用" }
            ],
            correct: 'D',
            keywords: ["資產價值", "風險值", "控制措施", "適用性聲明", "排除"],
            steps: {
                step1: "找關鍵字：「錯誤」、「風險管理」、「適用性聲明 (SoA)」。",
                step2: "A 公司做了一堆資安動作，哪一個是不合理的？特別注意最後一個選項的「排除」。",
                step3: "風險管理標準流程：資產盤點 → 風險評鑑 (威脅x弱點x衝擊) → 風險處理 (控制措施)。<br>SoA (Statement of Applicability) 是用來聲明 ISO 27001 附錄 A 的 93 個控制措施中，我們採用了哪些、排除了哪些。A 公司的核心業務就是「軟體開發與維護」，怎麼可能把針對開發維護的控制措施整段排除？這是不合邏輯的。",
                step4: "<ul><li>(A) 正確：這是風險評鑑的第一步（資產識別與評價）。</li><li>(B) 正確：這是風險分析的核心公式。</li><li>(C) 正確：這是風險處理（Risk Treatment）。</li><li>(D) 錯誤：A 的本業就是開發，若排除「資訊系統獲取、開發及維護」相關控制，等於核心業務沒有資安規範，違反 ISO 精神。</li></ul>"
            },
            supplement: "<strong>SoA (適用性聲明)：</strong>是一份重要文件，列出標準中所有控制措施，並說明「適用」或「不適用」的理由。排除必須有正當理由（如：公司完全沒有該項業務），不能因爲「不想做」而排除。",
            mnemonic: "資產盤點算價值，威脅弱點求風險；核心業務若排除，SoA 審查被打臉。",
            trap: "誤以為只要寫了 SoA 就可以隨意排除控制措施。排除必須具備「法律無法執行」或「業務不存在」等正當性。",
            selfTest: [
                { q: "風險值通常如何計算？", a: "風險值 = 資產價值 × 威脅 × 弱點 (常見公式之一)。" },
                { q: "什麼是殘餘風險？", a: "實施控制措施後，仍然剩餘的風險。" }
            ]
        },
        {
            id: 31,
            type: 'single',
            title: "題目 31（單選）：委外監督與檢測",
            text: "為滿足資通安全管理法關於機關/特定非公務機關之委外選任與監督要求，A 公司與甲客戶均實施一系列作為。下列何者較不適當？",
            options: [
                { id: 'A', text: "A 公司針對受託業務相關活動之資訊資產進行風險評鑑" },
                { id: 'B', text: "甲客戶定期以稽核方式確認 A 公司受託業務執行情形" },
                { id: 'C', text: "甲客戶委託 A 公司對該委託業務之資通系統實施安全性檢測" },
                { id: 'D', text: "A 公司標示非自行開發內容與來源並提供授權證明" }
            ],
            correct: 'C',
            keywords: ["委外選任", "監督", "安全性檢測", "不適當", "利益衝突"],
            steps: {
                step1: "關注角色關係：甲是業主（監督者），A 是廠商（被監督者）。關鍵字：「較不適當」。",
                step2: "甲客戶要把系統交給 A 做，還要檢查 A 做得好不好。哪一項做法會有問題？",
                step3: "這題考的是「球員兼裁判」的利益衝突 (Conflict of Interest) 問題。A 公司開發系統，如果又由 A 公司自己來做安全性檢測（如滲透測試、弱點掃描），A 公司可能會為了交差而隱瞞漏洞。通常檢測應由甲客戶自己做，或委託獨立的第三方 B 公司來做。",
                step4: "<ul><li>(A) 適當：廠商自己要先做好風險評鑑。</li><li>(B) 適當：業主稽核廠商是標準監督程序。</li><li>(C) 不適當：這叫「球員兼裁判」。檢測應由獨立第三方執行才客觀。</li><li>(D) 適當：這是釐清智慧財產權與供應鏈風險的正確做法。</li></ul>"
            },
            supplement: "<strong>獨立性原則：</strong>驗證與確認（V&V）的工作，最好由與開發單位無關的人員或第三方執行，以確保客觀性。",
            mnemonic: "委外監督要避嫌，球員裁判不兩全；自我檢測雖可做，驗收還需第三方。",
            trap: "覺得廠商最了解系統，所以給廠商測最快。雖快但不可信。",
            selfTest: [
                { q: "為什麼要有委外監督？", a: "因為資安責任無法完全轉嫁，業主仍需對最終資安結果負責。" },
                { q: "SLA 是什麼？", a: "服務水準協議 (Service Level Agreement)，定義服務品質指標的文件。" }
            ]
        },
        {
            id: 32,
            type: 'single',
            title: "題目 32（單選）：開發安全與供應鏈風險",
            text: "A 公司為確保如期如質完成受託業務，增設開發人員職缺並導入開發安全控制措施。下列何者較不適宜？",
            options: [
                { id: 'A', text: "針對開發、維護業務活動實施風險評鑑" },
                { id: 'B', text: "針對新進開發人員實施資通安全教育訓練" },
                { id: 'C', text: "採用未驗證的第三方套件" },
                { id: 'D', text: "導入安全軟體發展生命週期（SSDLC）" }
            ],
            correct: 'C',
            keywords: ["開發安全", "不適宜", "第三方套件", "SSDLC"],
            steps: {
                step1: "目標是「確保資安」，找出哪個選項會「破壞資安」。",
                step2: "新進人員要訓練嗎？開發要有流程嗎？外面抓來的程式庫可以直接用嗎？",
                step3: "現代軟體開發常使用第三方套件（Libraries/Frameworks）。但如果使用「未經驗證」或「含有已知漏洞」的套件，會直接引入資安風險（即供應鏈攻擊風險）。",
                step4: "<ul><li>(A) 適宜：這是基本的風險管理。</li><li>(B) 適宜：人員是資安最弱的一環，訓練必要。</li><li>(C) 不適宜：這就是「供應鏈風險」。Log4j 漏洞就是這類問題的典型例子。應先進行掃描或驗證來源。</li><li>(D) 適宜：SSDLC (Secure Software Development Life Cycle) 是將資安融入開發每一階段的正確做法。</li></ul>"
            },
            supplement: "<strong>供應鏈安全 (Supply Chain Security)：</strong>你的系統安全不只取決於你的程式碼，還取決於你引用的所有外部元件。必須建立「軟體物料清單 (SBOM)」來管理。",
            mnemonic: "開發流程跑 S S，人員訓練不可少；外來套件先驗證，漏洞才不會進來跑。",
            trap: "為了趕進度（如期完成），直接下載網路上的開源碼使用而未經檢查。",
            selfTest: [
                { q: "SSDLC 跟 SDLC 差在哪？", a: "SSDLC 在需求、設計、開發、測試每一階段都加入了資安活動 (Security)。" },
                { q: "SBOM 是什麼？", a: "軟體物料清單 (Software Bill of Materials)，就像食品成分表一樣，列出軟體用了哪些組件。" }
            ]
        }
    ];

    // Glossary Terms (Auto-generated content logic mostly, but hardcoded here for precision)
    const glossaryTerms = [
        { term: "ISO 27001", desc: "一套國際通用的資訊安全管理標準，教公司如何建立資安制度。" },
        { term: "ISMS", desc: "資訊安全管理制度 (Information Security Management System)，即 ISO 27001 建立的那套系統。" },
        { term: "Scope (驗證範圍)", desc: "界定資安制度要管轄的區域、業務或部門邊界。" },
        { term: "利害關係人 (Stakeholder)", desc: "會影響組織決策或被組織決策影響的人或單位（如客戶、員工、政府）。" },
        { term: "風險 (Risk)", desc: "威脅利用弱點造成資產損失的可能性。" },
        { term: "威脅 (Threat)", desc: "可能對系統造成損害的潛在原因（如駭客、地震）。" },
        { term: "弱點 (Vulnerability)", desc: "系統防護上的缺陷或漏洞（如沒更新的軟體、弱密碼）。" },
        { term: "衝擊 (Impact)", desc: "當資安事件發生時，對組織造成的損害程度。" },
        { term: "控制措施 (Control)", desc: "用來降低風險的手段（如防火牆、教育訓練）。" },
        { term: "SoA (適用性聲明)", desc: "Statement of Applicability，一份清單，說明組織採用了哪些 ISO 的控制措施。" },
        { term: "委外監督", desc: "把工作包給外面廠商做時，要盯著他們確保資安沒問題。" },
        { term: "SSDLC", desc: "安全軟體發展生命週期，在寫程式的每個階段都把資安考慮進去。" },
        { term: "第三方套件", desc: "別的公司或開源社群寫好的程式碼庫，直接拿來用。" },
        { term: "供應鏈風險", desc: "上游廠商或使用的工具不安全，導致自己被駭的風險。" }
    ];

    // State
    let currentTab = 0;
    const userProgress = [false, false, false, false];

    // Initialization
    function init() {
        renderTabs();
        renderQuestions();
        renderGlossary();
        showTab(0);
    }

    // Render Tabs
    function renderTabs() {
        const container = document.getElementById('tab-container');
        container.innerHTML = questions.map((q, index) => `
            <button class="tab-btn ${index === 0 ? 'active' : ''}" onclick="showTab(${index})" id="tab-${index}">
                Q${q.id}
            </button>
        `).join('');
    }

    // Render Questions
    function renderQuestions() {
        const container = document.getElementById('questions-wrapper');
        container.innerHTML = questions.map((q, index) => {
            const inputType = q.type === 'multi' ? 'checkbox' : 'radio';
            const inputName = `q${index}`;
            
            // Highlight keywords in text
            let processedText = q.text;
            q.keywords.forEach(kw => {
                // Simple replace to wrap keywords for initial rendering (interactive logic handled separately in plain text usually, but here we inject span)
                // Note: In a real app, complex regex prevents double wrapping. Here we assume simple keywords.
                const regex = new RegExp(kw, 'g');
                processedText = processedText.replace(regex, `<span class="keyword" onclick="toggleKw(this)">${kw}</span>`);
            });

            return `
            <div class="question-container" id="q-content-${index}">
                <h3>${q.title}</h3>
                <p style="font-size:1.1rem; margin-bottom:20px;">${processedText}</p>
                
                <div class="options-group">
                    ${q.options.map(opt => `
                        <label class="option-label">
                            <input type="${inputType}" name="${inputName}" value="${opt.id}" class="option-input">
                            <strong>(${opt.id})</strong> ${opt.text}
                        </label>
                    `).join('')}
                </div>

                <button class="btn" onclick="checkAnswer(${index})">送出答案</button>
                <div id="feedback-${index}" class="feedback"></div>

                <div class="explanation-section" id="explain-${index}">
                    <button class="btn btn-toggle" style="margin-bottom:15px; width:100%;" onclick="toggleFullExplanation(${index}, this)">
                        ▼ 顯示完整解析教學
                    </button>
                    
                    <div id="full-explain-content-${index}" style="display:none;">
                        <div class="step-block">
                            <div class="step-title">第一步：找關鍵字</div>
                            <p>${q.steps.step1}</p>
                        </div>
                        <div class="step-block">
                            <div class="step-title">第二步：白話翻譯</div>
                            <p>${q.steps.step2}</p>
                        </div>
                        <div class="step-block">
                            <div class="step-title">第三步：解題思路</div>
                            <p>${q.steps.step3}</p>
                        </div>
                        <div class="step-block">
                            <div class="step-title">第四步：選項分析</div>
                            ${q.steps.step4}
                        </div>

                        <div class="step-block" style="border-left-color: #9b59b6;">
                            <div class="step-title" style="color: #8e44ad;">觀念補充與延伸</div>
                            <p>${q.supplement}</p>
                        </div>

                        <div class="mnemonic-box">
                            <strong>⚡ 記憶口訣：</strong> ${q.mnemonic}
                        </div>

                        <div class="trap-box">
                            <strong>⚠️ 常見陷阱：</strong> ${q.trap}
                        </div>

                        <div class="step-block" style="border-left-color: #27ae60;">
                            <div class="step-title" style="color: #27ae60;">自我檢測 (點擊展開答案)</div>
                            ${q.selfTest.map(st => `
                                <div style="margin-bottom:10px;">
                                    <strong>Q: ${st.q}</strong><br>
                                    <button class="spoiler-btn" onclick="toggleSpoiler(this)">查看答案</button>
                                    <div class="spoiler-content">${st.a}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            </div>
            `;
        }).join('');
    }

    // Render Glossary
    function renderGlossary() {
        const grid = document.getElementById('glossary-grid');
        grid.innerHTML = glossaryTerms.map(item => `
            <div class="glossary-item">
                <strong style="color:var(--primary-color)">${item.term}</strong><br>
                <span style="color:#555">${item.desc}</span>
            </div>
        `).join('');
    }

    // Interactive Functions
    function showTab(index) {
        // Hide all questions
        document.querySelectorAll('.question-container').forEach(el => el.classList.remove('active'));
        // Show target
        document.getElementById(`q-content-${index}`).classList.add('active');
        
        // Update tab buttons
        document.querySelectorAll('.tab-btn').forEach((btn, idx) => {
            if(idx === index) btn.classList.add('active');
            else btn.classList.remove('active');
        });
        
        currentTab = index;
    }

    function toggleKw(element) {
        element.classList.toggle('active');
    }

    function checkAnswer(index) {
        const q = questions[index];
        const feedbackEl = document.getElementById(`feedback-${index}`);
        const inputs = document.querySelectorAll(`input[name="q${index}"]:checked`);
        let userVals = Array.from(inputs).map(i => i.value);
        
        // Sort for comparison
        userVals.sort();
        let correctVals = Array.isArray(q.correct) ? q.correct.sort() : [q.correct];
        
        // Compare
        const isCorrect = JSON.stringify(userVals) === JSON.stringify(correctVals);
        
        if (isCorrect) {
            feedbackEl.className = "feedback correct";
            feedbackEl.innerHTML = "✅ 答對了！太棒了！請閱讀下方解析加深印象。";
            
            // Mark progress
            userProgress[index] = true;
            document.getElementById(`tab-${index}`).classList.add('completed');
            checkAllCompleted();
            
            // Auto open explanation
            const explainBtn = document.querySelector(`#explain-${index} .btn-toggle`);
            const content = document.getElementById(`full-explain-content-${index}`);
            if (content.style.display === 'none') {
                 // Don't force open, but reveal the section container
            }
            document.getElementById(`explain-${index}`).classList.add('visible');

        } else {
            feedbackEl.className = "feedback wrong";
            feedbackEl.innerHTML = "❌ 答錯囉！別氣餒，試著再看一次題目或直接查看下方解析。";
            document.getElementById(`explain-${index}`).classList.add('visible');
        }
    }
    
    function toggleFullExplanation(index, btn) {
        const content = document.getElementById(`full-explain-content-${index}`);
        if (content.style.display === 'none') {
            content.style.display = 'block';
            btn.innerHTML = "▲ 收合解析教學";
        } else {
            content.style.display = 'none';
            btn.innerHTML = "▼ 顯示完整解析教學";
        }
    }

    function toggleSpoiler(btn) {
        const content = btn.nextElementSibling;
        if (content.style.display === 'block') {
            content.style.display = 'none';
            btn.innerHTML = "查看答案";
        } else {
            content.style.display = 'block';
            btn.innerHTML = "隱藏答案";
        }
    }

    function checkAllCompleted() {
        if (userProgress.every(p => p === true)) {
            document.getElementById('completion-message').style.display = 'block';
            window.scrollTo(0, 0);
        }
    }

    // Run
    init();

</script>

</body>
</html>