<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第38題｜一頁式攻擊鏈流程圖</title>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 引入 Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* 自定義動畫 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        body {
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
    </style>
</head>
<body class="min-h-screen bg-slate-900 text-slate-200 p-4 selection:bg-green-900 selection:text-green-100">

    <div class="max-w-3xl mx-auto space-y-6">
        
        <!-- Header -->
        <header class="text-center space-y-2 mb-8">
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-red-900/30 border border-red-500/50 text-red-400 text-xs font-mono mb-2">
                <i data-lucide="shield-alert" class="w-3.5 h-3.5"></i>
                <span>第 38 題考點解析</span>
            </div>
            <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-blue-500">
                SQLi → LFI → RCE
            </h1>
            <p class="text-slate-400 font-mono text-sm">Log Poisoning 完整攻擊鏈流程圖</p>
        </header>

        <!-- Prerequisites -->
        <div class="bg-slate-800/50 border border-slate-700 rounded-lg p-4 backdrop-blur-sm">
            <h3 class="text-slate-300 font-bold mb-3 flex items-center gap-2 text-sm uppercase tracking-wider">
                <i data-lucide="lock" class="w-4 h-4 text-yellow-500"></i>
                攻擊前提 (Initial Conditions)
            </h3>
            <ul class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-slate-400">
                <li class="flex items-center gap-2"><div class="w-1.5 h-1.5 bg-red-500 rounded-full"></div>目標存在 SQL Injection</li>
                <li class="flex items-center gap-2"><div class="w-1.5 h-1.5 bg-red-500 rounded-full"></div>目標存在 LFI 漏洞</li>
                <li class="flex items-center gap-2"><div class="w-1.5 h-1.5 bg-red-500 rounded-full"></div>Web Server 記錄 Log (Access/Auth)</li>
                <li class="flex items-center gap-2"><div class="w-1.5 h-1.5 bg-red-500 rounded-full"></div>PHP 解析被 LFI 包含的檔案</li>
            </ul>
        </div>

        <!-- Attack Chain Steps Container -->
        <div class="relative space-y-4">
            <!-- Vertical Line (Desktop only) -->
            <div class="absolute left-6 top-4 bottom-4 w-0.5 bg-gradient-to-b from-blue-500 via-purple-500 to-green-500 opacity-30 md:left-1/2 md:-ml-px hidden md:block"></div>

            <!-- STEP 1: SQL Injection -->
            <div onclick="toggleStep(1)" id="step-1" class="relative group cursor-pointer transition-all duration-300 hover:scale-[1.01]">
                <!-- Number Circle -->
                <div class="absolute left-6 md:left-1/2 -ml-3 w-6 h-6 rounded-full bg-slate-900 border-2 border-blue-500 flex items-center justify-center z-10 top-0 hidden md:flex">
                    <span class="text-[10px] font-bold text-blue-500">1</span>
                </div>
                
                <!-- Card -->
                <div class="bg-slate-800 border-l-4 border-blue-500 rounded-r-lg p-5 shadow-lg shadow-blue-900/10">
                    <div class="flex justify-between items-start">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-blue-900/30 rounded-lg text-blue-400">
                                <i data-lucide="database" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-blue-100">SQL Injection</h3>
                                <p class="text-xs text-blue-300 font-mono">取得初步控制</p>
                            </div>
                        </div>
                        <i data-lucide="chevron-down" id="chevron-1" class="text-slate-500 transition-transform duration-300"></i>
                    </div>
                    
                    <!-- Details (Hidden by default) -->
                    <div id="details-1" class="hidden mt-4 space-y-3 pt-3 border-t border-slate-700/50 text-sm animate-fadeIn">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <span class="text-xs font-bold text-slate-500 uppercase">攻擊者行為</span>
                                <p class="text-slate-300 mt-1">操控資料庫查詢，影響登入流程或寫入異常資料。</p>
                            </div>
                            <div>
                                <span class="text-xs font-bold text-slate-500 uppercase">目的</span>
                                <p class="text-slate-300 mt-1">驗證系統可操控，為後續鋪路。</p>
                            </div>
                        </div>
                        <div class="bg-slate-950 p-3 rounded border border-slate-700 font-mono text-xs text-yellow-300">
                            關鍵字：' or 1=1 --<br/>
                            關鍵字：UNION SELECT
                        </div>
                    </div>
                </div>
            </div>

            <!-- Arrow Down (Mobile only) -->
            <div class="flex justify-center md:hidden"><i data-lucide="arrow-down" class="text-slate-600 w-5 h-5"></i></div>


            <!-- STEP 2: Log Poisoning -->
            <div onclick="toggleStep(2)" id="step-2" class="relative group cursor-pointer transition-all duration-300 hover:scale-[1.01]">
                <div class="absolute left-6 md:left-1/2 -ml-3 w-6 h-6 rounded-full bg-slate-900 border-2 border-purple-500 flex items-center justify-center z-10 top-0 hidden md:flex">
                    <span class="text-[10px] font-bold text-purple-500">2</span>
                </div>
                <div class="bg-slate-800 border-l-4 border-purple-500 rounded-r-lg p-5 shadow-lg shadow-purple-900/10">
                    <div class="flex justify-between items-start">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-purple-900/30 rounded-lg text-purple-400">
                                <i data-lucide="file-code" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-purple-100">Log Poisoning</h3>
                                <p class="text-xs text-purple-300 font-mono">寫入惡意 PHP</p>
                            </div>
                        </div>
                        <i data-lucide="chevron-down" id="chevron-2" class="text-slate-500 transition-transform duration-300"></i>
                    </div>

                    <div id="details-2" class="hidden mt-4 space-y-3 pt-3 border-t border-slate-700/50 text-sm animate-fadeIn">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <span class="text-xs font-bold text-slate-500 uppercase">攻擊者行為</span>
                                <p class="text-slate-300 mt-1">利用 User-Agent 或登入欄位，將 PHP 代碼寫入 Access Log。</p>
                            </div>
                            <div>
                                <span class="text-xs font-bold text-slate-500 uppercase">寫入位置</span>
                                <p class="text-slate-300 mt-1 font-mono text-xs">/var/log/apache/access.log</p>
                            </div>
                        </div>
                        <div class="bg-slate-950 p-3 rounded border border-slate-700 font-mono text-xs text-pink-400">
                            Payload: &lt;?php system($_GET['c']); ?&gt;
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-center md:hidden"><i data-lucide="arrow-down" class="text-slate-600 w-5 h-5"></i></div>


            <!-- STEP 3: LFI -->
            <div onclick="toggleStep(3)" id="step-3" class="relative group cursor-pointer transition-all duration-300 hover:scale-[1.01]">
                <div class="absolute left-6 md:left-1/2 -ml-3 w-6 h-6 rounded-full bg-slate-900 border-2 border-orange-500 flex items-center justify-center z-10 top-0 hidden md:flex">
                    <span class="text-[10px] font-bold text-orange-500">3</span>
                </div>
                <div class="bg-slate-800 border-l-4 border-orange-500 rounded-r-lg p-5 shadow-lg shadow-orange-900/10">
                    <div class="flex justify-between items-start">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-orange-900/30 rounded-lg text-orange-400">
                                <i data-lucide="alert-triangle" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-orange-100">LFI (Local File Inclusion)</h3>
                                <p class="text-xs text-orange-300 font-mono">包含並執行 Log</p>
                            </div>
                        </div>
                        <i data-lucide="chevron-down" id="chevron-3" class="text-slate-500 transition-transform duration-300"></i>
                    </div>

                    <div id="details-3" class="hidden mt-4 space-y-3 pt-3 border-t border-slate-700/50 text-sm animate-fadeIn">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <span class="text-xs font-bold text-slate-500 uppercase">原理</span>
                                <p class="text-slate-300 mt-1">網站 Include Log 檔，PHP 引擎將 Log 內的純文字 payload 當作程式碼執行。</p>
                            </div>
                            <div>
                                <span class="text-xs font-bold text-slate-500 uppercase">特徵</span>
                                <p class="text-slate-300 mt-1">讀取伺服器本機檔案 (../../)</p>
                            </div>
                        </div>
                        <div class="bg-slate-950 p-3 rounded border border-slate-700 font-mono text-xs text-orange-300">
                            URL: ?page=/var/log/apache/access.log
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-center md:hidden"><i data-lucide="arrow-down" class="text-slate-600 w-5 h-5"></i></div>


            <!-- STEP 4: RCE -->
            <div onclick="toggleStep(4)" id="step-4" class="relative group cursor-pointer transition-all duration-300 hover:scale-[1.01]">
                <div class="absolute left-6 md:left-1/2 -ml-3 w-6 h-6 rounded-full bg-slate-900 border-2 border-green-500 flex items-center justify-center z-10 top-0 hidden md:flex">
                    <span class="text-[10px] font-bold text-green-500">4</span>
                </div>
                <div class="bg-slate-800 border-l-4 border-green-500 rounded-r-lg p-5 shadow-lg shadow-green-900/10">
                    <div class="flex justify-between items-start">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-green-900/30 rounded-lg text-green-400">
                                <i data-lucide="terminal" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-green-100">RCE (Remote Command Execution)</h3>
                                <p class="text-xs text-green-300 font-mono">遠端指令執行 (Game Over)</p>
                            </div>
                        </div>
                        <i data-lucide="chevron-down" id="chevron-4" class="text-slate-500 transition-transform duration-300"></i>
                    </div>

                    <div id="details-4" class="hidden mt-4 space-y-3 pt-3 border-t border-slate-700/50 text-sm animate-fadeIn">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <span class="text-xs font-bold text-slate-500 uppercase">執行方式</span>
                                <p class="text-slate-300 mt-1">透過網址參數傳入 OS 指令，剛才埋入的 system() 執行它。</p>
                            </div>
                            <div>
                                <span class="text-xs font-bold text-slate-500 uppercase">關鍵參數</span>
                                <p class="text-slate-300 mt-1 font-mono text-xs">?c=whoami&&id</p>
                            </div>
                        </div>
                        <div class="bg-slate-950 p-3 rounded border border-slate-700 font-mono text-xs text-green-400">
                            Result: uid=33(www-data) gid=33(www-data)
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Cheat Sheet Logic Section -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-8">
            
            <!-- Exam Logic -->
            <div class="bg-gradient-to-br from-slate-800 to-slate-900 p-5 rounded-lg border border-slate-700">
                <h3 class="flex items-center gap-2 text-yellow-400 font-bold mb-3">
                    <i data-lucide="shield-alert" class="w-4.5 h-4.5"></i>
                    考試秒判心法
                </h3>
                <p class="text-slate-400 text-sm mb-3">若題目同時出現以下四要素，直接選 RCE：</p>
                <div class="grid grid-cols-2 gap-2 font-mono text-xs text-center">
                    <span class="bg-slate-950/50 p-2 rounded text-blue-300 border border-slate-700">system($_GET)</span>
                    <span class="bg-slate-950/50 p-2 rounded text-orange-300 border border-slate-700">LFI</span>
                    <span class="bg-slate-950/50 p-2 rounded text-purple-300 border border-slate-700">Log 檔</span>
                    <span class="bg-slate-950/50 p-2 rounded text-green-300 border border-slate-700">OS 指令</span>
                </div>
            </div>

            <!-- Mnemonic -->
            <div class="bg-gradient-to-br from-green-900/20 to-slate-900 p-5 rounded-lg border border-green-900/30 flex flex-col justify-center">
                <h3 class="flex items-center gap-2 text-green-400 font-bold mb-3">
                    <i data-lucide="skull" class="w-4.5 h-4.5"></i>
                    一句話記憶口訣
                </h3>
                <blockquote class="border-l-4 border-green-500 pl-4 italic text-lg text-slate-200 leading-relaxed font-serif">
                    「SQL 開門，Log 藏刀；<br/>
                    <span class="ml-4">LFI 一載，主機就倒。」</span>
                </blockquote>
            </div>

        </div>

        <!-- Footer Traps -->
        <div class="bg-red-950/30 border border-red-900/30 rounded-lg p-4 mt-4">
            <h4 class="text-red-400 font-bold text-sm mb-2">❌ 常見陷阱提醒</h4>
            <ul class="text-sm text-red-200/70 space-y-1 list-disc pl-4">
                <li>題目開頭提到 SQLi 只是「前菜」，真正的考點是最後的「指令執行」。</li>
                <li>system() 函數只執行 OS 指令 (ls, whoami)，不執行 SQL 語法 (SELECT)。</li>
            </ul>
        </div>

    </div>

    <!-- Logic Script -->
    <script>
        // 初始化 Icons
        lucide.createIcons();

        let currentExpandedStep = null;

        function toggleStep(step) {
            // 處理 Details 的顯示/隱藏
            const detailsId = `details-${step}`;
            const detailsElement = document.getElementById(detailsId);
            
            // 處理 Chevron 的旋轉
            const chevronId = `chevron-${step}`;
            const chevronElement = document.getElementById(chevronId);

            // 處理 Card 的縮放 (Active State)
            const cardId = `step-${step}`;
            const cardElement = document.getElementById(cardId);

            if (currentExpandedStep === step) {
                // 關閉目前打開的
                detailsElement.classList.add('hidden');
                chevronElement.classList.remove('rotate-180');
                cardElement.classList.remove('scale-[1.02]');
                currentExpandedStep = null;
            } else {
                // 如果有其他打開的，先關閉它
                if (currentExpandedStep !== null) {
                    document.getElementById(`details-${currentExpandedStep}`).classList.add('hidden');
                    document.getElementById(`chevron-${currentExpandedStep}`).classList.remove('rotate-180');
                    document.getElementById(`step-${currentExpandedStep}`).classList.remove('scale-[1.02]');
                }

                // 打開新的
                detailsElement.classList.remove('hidden');
                chevronElement.classList.add('rotate-180');
                cardElement.classList.add('scale-[1.02]');
                currentExpandedStep = step;
            }
        }
    </script>
</body>
</html>