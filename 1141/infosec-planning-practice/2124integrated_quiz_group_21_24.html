<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPAS è³‡å®‰å·¥ç¨‹å¸« - é¡Œçµ„è¡åˆº (21-24)</title>
    <style>
        :root {
            /* é…è‰²ç³»çµ± */
            --primary-bg: #f4f7f6;
            --card-bg: #ffffff;
            --text-main: #333333;
            --text-secondary: #666666;
            
            /* æ¨™ç±¤é¡è‰² */
            --tag-law: #607d8b;   /* æ³•è¦ */
            --tag-iso: #27ae60;   /* æ¨™æº– */
            --tag-zt: #8e44ad;    /* é›¶ä¿¡ä»» */
            --tag-net: #2980b9;   /* ç¶²è·¯ */
            --tag-sec: #c0392b;   /* æŠ€è¡“ */
            --tag-mgm: #d35400;   /* é¢¨éšª/ç®¡ç† */

            /* ç‹€æ…‹é¡è‰² */
            --success-bg: #e8f5e9;
            --success-text: #2e7d32;
            --error-bg: #fce4ec;
            --error-text: #c62828;
            --neutral-gray: #e0e0e0;
            --highlight-red: #d32f2f;
            --step-badge-bg: #34495e;

            /* ä»‹é¢å°ºå¯¸ */
            --radius: 16px;
            --spacing: 20px;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: system-ui, "Noto Sans TC", sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            font-size: 16px;
        }

        /* å®¹å™¨èˆ‡ä½ˆå±€ */
        .app-container {
            max-width: 960px;
            margin: 0 auto;
            background-color: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 80vh;
        }

        /* é é¦– Header */
        header {
            padding: var(--spacing);
            border-bottom: 1px solid #eee;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        h1 {
            margin: 0;
            font-size: 1.25rem;
            color: #2c3e50;
        }

        .progress-info {
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--text-secondary);
        }

        .progress-track {
            width: 100%;
            height: 8px;
            background-color: #eee;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--tag-net);
            width: 0%;
            transition: width 0.4s ease;
        }

        /* é¡Œçµ„æƒ…å¢ƒ Context */
        .context-box {
            background-color: #e3f2fd;
            padding: var(--spacing);
            border-left: 5px solid #2196f3;
            margin: 0;
            font-size: 0.95rem;
            color: #0d47a1;
        }

        .context-label {
            font-weight: bold;
            display: block;
            margin-bottom: 8px;
            font-size: 0.85rem;
            opacity: 0.8;
        }

        /* åˆ†é  Tabs */
        .tabs-container {
            display: flex;
            background-color: #f8f9fa;
            padding: 10px var(--spacing) 0;
            gap: 5px;
            overflow-x: auto;
            scrollbar-width: none; /* Firefox */
        }
        .tabs-container::-webkit-scrollbar {
            display: none; /* Chrome/Safari */
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            background: #e9ecef;
            border-radius: 12px 12px 0 0;
            font-weight: bold;
            color: var(--text-secondary);
            transition: all 0.2s;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 6px;
            border: 1px solid transparent;
            border-bottom: none;
            min-height: 48px;
        }

        .tab:hover {
            background: #dde2e6;
        }

        .tab.active {
            background: #ffffff;
            color: var(--tag-net);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }

        .tab-icon {
            font-size: 1.1em;
        }

        .tab.correct { color: var(--success-text); }
        .tab.wrong { color: var(--error-text); }

        /* é¡Œç›®å€åŸŸ Question Area */
        .question-container {
            padding: var(--spacing);
            flex: 1;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .q-meta {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        .tag {
            padding: 4px 10px;
            border-radius: 4px;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .tag-law { background-color: var(--tag-law); }
        .tag-iso { background-color: var(--tag-iso); }
        .tag-zt { background-color: var(--tag-zt); }
        .tag-net { background-color: var(--tag-net); }
        .tag-sec { background-color: var(--tag-sec); }
        .tag-mgm { background-color: var(--tag-mgm); }

        .q-text {
            font-size: 1.15rem;
            font-weight: bold;
            margin-bottom: 25px;
            line-height: 1.7;
        }

        .highlight-negative {
            color: var(--highlight-red);
            font-weight: 900;
            border-bottom: 2px solid var(--highlight-red);
        }

        /* é¸é … Options */
        .options-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 30px;
        }

        .option-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #eee;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .option-item:hover:not(.disabled) {
            border-color: var(--tag-net);
            background-color: #f8fbff;
        }

        .option-item.selected {
            border-color: var(--tag-net);
            background-color: #e3f2fd;
        }

        .option-item.disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        .option-item.correct-answer {
            border-color: var(--success-text);
            background-color: var(--success-bg);
        }

        .option-item.wrong-answer {
            border-color: var(--error-text);
            background-color: var(--error-bg);
        }

        .option-check {
            width: 20px;
            height: 20px;
            border: 2px solid #bdbdbd;
            border-radius: 50%;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .option-item[data-type="checkbox"] .option-check {
            border-radius: 4px; /* Square for checkbox */
        }

        .option-item.selected .option-check {
            border-color: var(--tag-net);
            background-color: var(--tag-net);
        }

        .option-check::after {
            content: '';
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            display: none;
        }
        
        .option-item[data-type="checkbox"].selected .option-check::after {
             display: block;
             width: 5px;
             height: 9px;
             border: solid white;
             border-width: 0 2px 2px 0;
             transform: rotate(45deg);
             border-radius: 0;
             background: transparent;
             margin-bottom: 2px;
        }

        .option-item.selected .option-check::after {
            display: block;
        }

        /* æŒ‰éˆ•å€ Action Area */
        .action-area {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-submit {
            background-color: var(--tag-net);
            color: white;
            flex: 1;
        }

        .btn-retry {
            background-color: var(--tag-mgm);
            color: white;
            flex: 1;
            display: none;
        }
        
        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* è©³è§£å€ Explain Section (æ–°ç‰ˆè¨­è¨ˆ) */
        .explain-section {
            background-color: #fff;
            border-radius: 12px;
            overflow: hidden;
            display: none;
            margin-top: 20px;
            border: 2px solid #e0e0e0;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .explain-header {
            background-color: #34495e;
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1rem;
        }

        .explain-content {
            padding: 25px;
            background-color: #fcfcfc;
        }

        /* è©³è§£å€å¡Šé€šç”¨æ¨£å¼ */
        .step-box {
            margin-bottom: 25px;
            padding: 15px;
            background: white;
            border: 1px solid #eee;
            border-radius: 8px;
            position: relative;
        }

        .step-badge {
            display: inline-block;
            background-color: var(--step-badge-bg);
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .step-content {
            padding-left: 5px;
            color: #444;
        }

        .keyword-highlight {
            color: var(--tag-sec);
            font-weight: bold;
            background-color: #fff3cd;
            padding: 0 4px;
        }

        /* é‚è¼¯å€å¡Š */
        .logic-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .logic-list li {
            margin-bottom: 8px;
            position: relative;
            padding-left: 20px;
        }
        .logic-list li::before {
            content: 'â€¢';
            color: var(--tag-net);
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        /* é¸é …åˆ†æè¡¨æ ¼ */
        .analysis-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
            margin-top: 10px;
        }
        .analysis-table th, .analysis-table td {
            border: 1px solid #eee;
            padding: 8px;
            text-align: left;
        }
        .analysis-table th {
            background-color: #f2f2f2;
            color: var(--text-main);
        }
        .analysis-table tr.correct-row {
            background-color: var(--success-bg);
        }

        /* è¨˜æ†¶é‡‘å¥ */
        .golden-sentence {
            background-color: #fff8e1;
            border-left: 5px solid #ffc107;
            padding: 15px;
            font-weight: bold;
            color: #795548;
            font-size: 1.1rem;
            text-align: center;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }

        /* é™·é˜±å€ */
        .trap-box {
            background-color: #ffebee;
            border: 1px solid #ffcdd2;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px;
        }
        .trap-title {
            color: var(--error-text);
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* è‡ªæˆ‘æª¢æ¸¬ (Self-Check) */
        .check-container {
            margin-top: 20px;
        }
        .check-item {
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }
        .check-question {
            padding: 12px 15px;
            font-weight: bold;
            background-color: #f8f9fa;
            border-bottom: 1px solid #eee;
            color: var(--text-main);
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }
        .check-answer-box {
            padding: 0;
        }
        .check-toggle-btn {
            width: 100%;
            border: none;
            background: white;
            color: var(--tag-net);
            padding: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            transition: background 0.2s;
        }
        .check-toggle-btn:hover {
            background-color: #f0f8ff;
        }
        .check-answer {
            padding: 15px;
            background-color: #e8f5e9;
            color: #2e7d32;
            display: none; /* é è¨­éš±è— */
            border-top: 1px dashed #c8e6c9;
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .app-container { border-radius: 0; }
            .tabs-container { padding-left: 10px; }
            .q-text { font-size: 1.05rem; }
            .analysis-table { font-size: 0.85rem; }
        }
    </style>
</head>
<body>

<div class="app-container">
    <!-- Header -->
    <header>
        <div class="header-top">
            <h1>iPAS è³‡å®‰é¡Œçµ„è¡åˆº (No.21-24)</h1>
            <div class="progress-info">é€²åº¦ï¼š<span id="progressText">0/4</span></div>
        </div>
        <div class="progress-track">
            <div class="progress-bar" id="progressBar"></div>
        </div>
    </header>

    <!-- Context -->
    <div class="context-box">
        <span class="context-label">ã€é¡Œçµ„å…±åŒæƒ…å¢ƒã€‘</span>
        K å…¬å¸ç‚ºåœ‹å…§è‚¡ç¥¨ä¸Šå¸‚é£Ÿå“ä¹‹è£½é€ å•†ï¼Œå…¬å¸æ–°å»ºç½®ç¶²è·¯è²©å”®ç³»çµ±ï¼Œå°‡ç”¢å“ç›´æ¥éŠ·å”®çµ¦åœ‹å…§çš„æ¶ˆè²»è€…ï¼Œä¸¦æš«æ™‚ä¸æä¾›å°‡æ‰€è²©å”®ç”¢å“å¯„åˆ°æœ¬åœ‹ä»¥å¤–çš„åœ°å€ã€‚å…¬å¸åœ¨è¦åŠƒèˆ‡å»ºç½®æ­¤ç¶²è·¯è²©å”®ç³»çµ±æ™‚ï¼Œéœ€åŒæ­¥è€ƒé‡æ³•è¦éµå¾ªã€è³‡å®‰è¦æ±‚èˆ‡ç³»çµ±å®‰å…¨è¨­è¨ˆï¼Œä»¥ç¢ºä¿ç‡Ÿé‹èˆ‡æ¶ˆè²»è€…è³‡æ–™å®‰å…¨ã€‚
    </div>

    <!-- Tabs -->
    <div class="tabs-container" id="tabsContainer">
        <!-- Rendered by JS -->
    </div>

    <!-- Question Area -->
    <div class="question-container" id="questionContainer">
        <!-- Rendered by JS -->
    </div>
</div>

<script>
    // --- 1. è³‡æ–™å®šç¾© (Data Structure Updated) ---
    const quizData = {
        groupTitle: "K å…¬å¸é›»å•†ç³»çµ±å»ºç½®èˆ‡è³‡å®‰è¦åŠƒ",
        questions: [
            {
                id: 21,
                tag: "ç®¡ç†",
                tagClass: "tag-mgm",
                text: "è«‹å•å…¬å¸åœ¨å»ºç½®æ­¤ç¶²è·¯è²©å”®ç³»çµ±æ™‚ï¼Œä¸‹åˆ—ä½•é …ç‚ºæœ€ã€Œä¸ã€éœ€è¦è€ƒæ…®çš„é …ç›®ï¼Ÿ",
                type: "radio",
                options: [
                    "ä¸»ç®¡æ©Ÿé—œçš„è¦æ±‚",
                    "æ³•ä»¤è¦å®š",
                    "å…¬å¸è³‡å®‰é•·çš„å°ˆé•·",
                    "ç³»çµ±å®‰å…¨éœ€æ±‚"
                ],
                correct: ["å…¬å¸è³‡å®‰é•·çš„å°ˆé•·"],
                analysis: {
                    keywords: ["å»ºç½®ç¶²è·¯è²©å”®ç³»çµ±", "æœ€ã€Œä¸ã€éœ€è¦è€ƒæ…®", "è³‡å®‰é•·çš„å°ˆé•·"],
                    translation: "å…¬å¸è¦è“‹ä¸€å€‹æ­£è¦çš„ç³»çµ±ï¼Œæ‡‰è©²ä¾æ“šæ³•å¾‹è¦å®šå’Œç³»çµ±éœ€æ±‚ä¾†è“‹ï¼Œé‚„æ˜¯çœ‹è³‡å®‰é•·å€‹äººæ“…é•·ä»€éº¼å°±è“‹ä»€éº¼ï¼Ÿ",
                    logic: {
                        steps: [
                            "å€åˆ†ã€Œå®¢è§€å¿…è¦æ¢ä»¶ã€èˆ‡ã€Œä¸»è§€èƒ½åŠ›è³‡æºã€ã€‚",
                            "æ³•è¦èˆ‡å®‰å…¨éœ€æ±‚æ˜¯ã€Œæ­»çš„ã€ï¼ˆå¿…é ˆéµå®ˆï¼‰ï¼Œä¸éµå®ˆæœƒé•æ³•æˆ–è¢«é§­ã€‚",
                            "äººå“¡å°ˆé•·æ˜¯ã€Œæ´»çš„ã€ï¼ˆè³‡æºï¼‰ï¼Œè‹¥å°ˆé•·ä¸è¶³æ‡‰è©²å¤–è˜é¡§å•æˆ–é€²ä¿®ï¼Œè€Œéé™ä½ç³»çµ±æ¨™æº–ã€‚"
                        ],
                        principle: "éœ€æ±‚åˆ†ææ‡‰åŸºæ–¼æ¥­å‹™ç›®æ¨™èˆ‡åˆè¦æ€§ (Compliance)ï¼Œè€Œéç¾æœ‰äººåŠ›è³‡æºã€‚",
                        example: "å°±åƒè“‹æˆ¿å­ï¼ˆå»ºç½®ç³»çµ±ï¼‰å¿…é ˆç¬¦åˆå»ºç¯‰æ³•è¦ï¼ˆæ³•ä»¤ï¼‰å’Œè€éœ‡æ¨™æº–ï¼ˆå®‰å…¨éœ€æ±‚ï¼‰ï¼Œä¸èƒ½å› ç‚ºå»ºç¯‰å¸«ä¸æ“…é•·è“‹è€éœ‡çµæ§‹ï¼ˆå°ˆé•·ï¼‰ï¼Œå°±æ±ºå®šæˆ¿å­ä¸ç”¨è€éœ‡ã€‚"
                    },
                    options_analysis: [
                        { opt: "ä¸»ç®¡æ©Ÿé—œçš„è¦æ±‚", result: "å¿…è¦", reason: "ä¸Šå¸‚å…¬å¸å—é«˜åº¦ç›£ç®¡ï¼Œä¸éµå®ˆæœƒå—ç½°ã€‚" },
                        { opt: "æ³•ä»¤è¦å®š", result: "å¿…è¦", reason: "é€™æ˜¯æ³•éµåº•ç·šï¼ˆå¦‚å€‹è³‡æ³•ï¼‰ã€‚" },
                        { opt: "å…¬å¸è³‡å®‰é•·çš„å°ˆé•·", result: "éå¿…è¦ (æ­£è§£)", reason: "å°ˆé•·å±¬æ–¼åŸ·è¡Œå±¤é¢çš„å·¥å…·ï¼Œä¸æ‡‰åéä¾†æ±ºå®šç³»çµ±çš„è¦æ ¼ç›®æ¨™ã€‚è‹¥å°ˆé•·ä¸è¶³æ‡‰å°‹æ±‚å¤–éƒ¨è³‡æºã€‚" },
                        { opt: "ç³»çµ±å®‰å…¨éœ€æ±‚", result: "å¿…è¦", reason: "ç¼ºä¹å®‰å…¨éœ€æ±‚çš„ç³»çµ±ç„¡æ³•æŠµç¦¦æ”»æ“Šã€‚" }
                    ],
                    extension: {
                        law: "éœ€æ±‚è¦æ ¼æ›¸ (RFP) çš„æ’°å¯«æ‡‰ç¨ç«‹æ–¼åŸ·è¡Œåœ˜éšŠçš„èƒ½åŠ›ä¹‹å¤–ã€‚",
                        analogy: "è€ƒé§•ç…§ï¼ˆæ³•è¦ï¼‰ä¸æœƒå› ç‚ºä½ ä¸æœƒè·¯é‚Šåœè»Šï¼ˆå°ˆé•·ï¼‰ï¼Œç›£ç†ç«™å°±å–æ¶ˆé€™å€‹è€ƒç§‘ã€‚"
                    },
                    mnemonic: "ã€Œå»ºç½®çœ‹éœ€æ±‚ï¼Œä¸çœ‹äººé ­ã€‚ã€",
                    trap: {
                        blindspot: "æ¬Šå¨åèª¤ï¼šè¦ºå¾—è³‡å®‰é•·è·ä½å¾ˆå¤§ï¼Œä»–çš„æ„è¦‹æˆ–èƒ½åŠ›å°±æ˜¯æ¨™æº–ã€‚",
                        guide: "çœ‹åˆ°ã€Œå€‹äººã€ç‰¹è³ªï¼ˆå°ˆé•·ã€å–œå¥½ã€ç¿’æ…£ï¼‰é€šå¸¸ä¸æ˜¯åˆ¶åº¦é¢çš„è€ƒé‡ä¾æ“šã€‚"
                    },
                    self_check: [
                        { q: "å¦‚æœè³‡å®‰é•·é›¢è·äº†ï¼Œç³»çµ±åŸæœ¬çš„å®‰å…¨å»ºç½®æ¨™æº–éœ€è¦æ”¹è®Šå—ï¼Ÿ", a: "ä¸ç”¨ã€‚æ¨™æº–æ˜¯è·Ÿè‘—å…¬å¸èˆ‡æ³•è¦çš„ï¼Œä¸éš¨äººå“¡ç•°å‹•è€Œæ”¹è®Šã€‚" },
                        { q: "æ³•ä»¤è¦å®šå±¬æ–¼å…§åœ¨éœ€æ±‚é‚„æ˜¯å¤–åœ¨é™åˆ¶ï¼Ÿ", a: "å¤–åœ¨é™åˆ¶ (Constraint)ã€‚" }
                    ]
                }
            },
            {
                id: 22,
                tag: "é¢¨éšª",
                tagClass: "tag-mgm",
                text: "å…¬å¸æ–¼å»ºç½®ç³»çµ±æ™‚è©•ä¼°è‡ªè¡Œè² è²¬é‡‘æµä½œæ¥­é¢¨éšªéå¤§ï¼Œæ±ºå®šå°‡ç¶²è·¯é‡‘æµä½œæ¥­äº¤ç”±åˆæ ¼ä¹‹é‡‘è³‡æœå‹™æ©Ÿæ§‹è¾¦ç†ï¼Œä¸è‡ªè¡Œè™•ç†é‡‘æµä½œæ¥­ã€‚è«‹å•æ­¤é …æ±ºç­–å±¬ä¸‹åˆ—ä½•é …é¢¨éšªè™•ç†æªæ–½ï¼Ÿ",
                type: "radio",
                options: [
                    "é¢¨éšªç·©è§£ (Risk Mitigation)",
                    "é¢¨éšªé¿å… (Risk Avoidance)",
                    "é¢¨éšªåˆ†æ“” (Risk Sharing)",
                    "é¢¨éšªä¿ç•™ (Risk Retention)"
                ],
                correct: ["é¢¨éšªé¿å… (Risk Avoidance)"],
                analysis: {
                    keywords: ["ä¸è‡ªè¡Œè™•ç†", "äº¤ç”±...è¾¦ç†", "é¢¨éšªè™•ç†æªæ–½"],
                    translation: "å› ç‚ºæ€•è™•ç†é‡‘æµæœƒå‡ºäº‹ï¼ˆé¢¨éšªå¤§ï¼‰ï¼Œæ‰€ä»¥å…¬å¸æ±ºå®šã€Œæˆ‘ä¸åšäº†ã€ï¼Œé€™å€‹å‹•ä½œå«ä»€éº¼ï¼Ÿ",
                    logic: {
                        steps: [
                            "åˆ¤æ–·å…¬å¸æ˜¯å¦ç¹¼çºŒé€²è¡Œè©²é …é«˜é¢¨éšªæ´»å‹•ï¼Ÿ",
                            "æ˜¯ -> è€ƒæ…®ç·©è§£æˆ–åˆ†æ“”ï¼›å¦ -> é¢¨éšªé¿å…ã€‚",
                            "é¡Œç›®å¼·èª¿ã€Œä¸è‡ªè¡Œè™•ç†ã€ï¼Œä»£è¡¨å…¬å¸æœ¬èº«åœæ­¢äº†é‡‘æµè™•ç†é€™é …æ´»å‹•ã€‚"
                        ],
                        principle: "é¢¨éšªé¿å… (Risk Avoidance) = åœæ­¢æˆ–ä¸åƒèˆ‡ç”¢ç”Ÿé¢¨éšªçš„æ´»å‹•ã€‚",
                        example: "æ€•é–‹è»Šæœƒæ’äººï¼ˆé¢¨éšªï¼‰ï¼Œæ‰€ä»¥æ±ºå®šæŠŠè»Šè³£äº†ï¼Œä»¥å¾Œéƒ½æ­æ·é‹ï¼ˆä¸è‡ªè¡Œé–‹è»Š = é¿å…ï¼‰ã€‚"
                    },
                    options_analysis: [
                        { opt: "é¢¨éšªç·©è§£", result: "éŒ¯èª¤", reason: "ç¹¼çºŒåšï¼Œä½†åŠ è£é˜²è­·ï¼ˆå¦‚é˜²ç«ç‰†ï¼‰ã€‚" },
                        { opt: "é¢¨éšªé¿å…", result: "æ­£ç¢º", reason: "ç›´æ¥åœæ­¢å…§éƒ¨è™•ç†é‡‘æµçš„æ´»å‹•ï¼Œé¿é–‹äº†é¢¨éšªæºã€‚" },
                        { opt: "é¢¨éšªåˆ†æ“”", result: "æ˜“æ··æ·†", reason: "é›–ç„¶æ‰¾äº†ç¬¬ä¸‰æ–¹ï¼Œä½†åˆ†æ“”é€šå¸¸æŒ‡ã€Œæ´»å‹•ç…§åšï¼Œä½†æ‰¾äººåˆ†æ”¤æå¤±ï¼ˆå¦‚ä¿éšªï¼‰ã€ã€‚é¡Œç›®å¼·èª¿ã€Œä¸è‡ªè¡Œè™•ç†ã€çš„æ±ºç­–ï¼Œæ›´åå‘é¿å…å…§éƒ¨æ“ä½œé¢¨éšªã€‚" },
                        { opt: "é¢¨éšªä¿ç•™", result: "éŒ¯èª¤", reason: "ç…§åšä¸”ä¸é¿éšªï¼Œè‡ªå·±æ‰¿æ“”å¾Œæœã€‚" }
                    ],
                    extension: {
                        law: "é¢¨éšªè™•ç½®ç­–ç•¥å››è±¡é™ï¼šé«˜è¡æ“Š/é«˜æ©Ÿç‡é€šå¸¸å»ºè­°ã€Œé¿å…ã€ã€‚",
                        analogy: "æ€•ä¼ºæœå™¨è¢«ç¶²è·¯æ”»æ“Šï¼Œæ±ºå®šç›´æ¥æ‹”æ‰ç¶²è·¯ç·šï¼ˆæ¥µç«¯é¿å…ï¼‰ã€‚"
                    },
                    mnemonic: "ã€Œä¸åšå°±æ˜¯é¿å…ï¼Œæ‰¾äººæ‰›æ˜¯åˆ†æ“”ã€‚ã€",
                    trap: {
                        blindspot: "çœ‹åˆ°ã€Œäº¤çµ¦åˆ¥äººã€å°±ç›´è¦ºæƒ³åˆ°åˆ†æ“”ï¼ˆç§»è½‰ï¼‰ã€‚",
                        guide: "é—œéµåœ¨å‹•è©ï¼ã€Œä¸è‡ªè¡Œè™•ç†ã€å¼·åº¦å¤§æ–¼ã€Œæ‰¾äººå¹«å¿™ã€ã€‚é‡é»åœ¨æ–¼å…¬å¸å…§éƒ¨ã€Œé¿é–‹ã€äº†é€™å€‹ä½œæ¥­æµç¨‹ã€‚"
                    },
                    self_check: [
                        { q: "å¦‚æœå…¬å¸è‡ªå·±åšé‡‘æµï¼Œä½†è²·äº†è³‡å®‰ä¿éšªï¼Œé€™å±¬æ–¼å“ªä¸€ç¨®ï¼Ÿ", a: "é¢¨éšªåˆ†æ“” (Risk Sharing)ã€‚" },
                        { q: "å¦‚æœå…¬å¸è©•ä¼°å¾Œè¦ºå¾—é‡‘æµé¢¨éšªå¾ˆå°ï¼Œæ±ºå®šè‡ªå·±åšä¸”ä¸è²·ä¿éšªï¼Œé€™å±¬æ–¼å“ªä¸€ç¨®ï¼Ÿ", a: "é¢¨éšªä¿ç•™ (Risk Retention)ã€‚" }
                    ]
                }
            },
            {
                id: 23,
                tag: "æŠ€è¡“",
                tagClass: "tag-sec",
                text: "å»ºç½®ç¶²è·¯è²©å”®ç³»çµ±æ™‚ï¼Œå…¬å¸è€ƒé‡è©²ç³»çµ±ä¹‹æ©Ÿå¯†æ€§ã€å¯ç”¨æ€§ã€å®Œæ•´æ€§ï¼ˆCIAï¼‰è¦åŠƒäº†ç›¸é—œæ§åˆ¶é …ç›®ï¼Œè«‹å•ä¸‹åˆ—ä½•é …ç³»çµ±å»ºç½®è¦åŠƒã€Œä¸ã€å±¬æ©Ÿå¯†æ€§ï¼ˆConfidentialityï¼‰çš„è€ƒé‡ï¼Ÿ",
                type: "radio",
                options: [
                    "è¦å®šä½¿ç”¨å¤šå› å­èªè­‰ (MFA) ç™»å…¥ç³»çµ±",
                    "è¦æ±‚å®šæœŸæ›´æ”¹å¯†ç¢¼",
                    "å»ºç½®å³æ™‚ç³»çµ±å‚™æ´æ©Ÿåˆ¶",
                    "ä½¿ç”¨ TLS 1.3 åŠ å¯†é€šè¨Šå”å®š"
                ],
                correct: ["å»ºç½®å³æ™‚ç³»çµ±å‚™æ´æ©Ÿåˆ¶"],
                analysis: {
                    keywords: ["æ©Ÿå¯†æ€§", "ä¸å±¬", "å‚™æ´æ©Ÿåˆ¶"],
                    translation: "ä¸‹é¢å“ªä¸€å€‹æªæ–½ã€Œä¸æ˜¯ã€ç”¨ä¾†é˜²å·çœ‹çš„ï¼Ÿï¼ˆæš—ç¤ºï¼šæ˜¯ç”¨ä¾†é˜²ç•¶æ©Ÿæˆ–é˜²ç«„æ”¹çš„ï¼‰",
                    logic: {
                        steps: [
                            "åˆ†é¡ CIA ä¸‰è¦ç´ ï¼šC=é˜²æ´©æ¼, I=é˜²ç«„æ”¹, A=é˜²ä¸­æ–·ã€‚",
                            "åˆ†æé¸é …ç›®çš„ï¼šMFAã€å¯†ç¢¼ã€TLS éƒ½æ˜¯ç‚ºäº†ã€Œé™åˆ¶å­˜å–ã€ï¼ˆé˜²æ´©æ¼ï¼‰ã€‚",
                            "å‚™æ´æ©Ÿåˆ¶çš„ç›®çš„æ˜¯ã€Œç•¶ä¸»æ©Ÿå£æ‰æ™‚æœ‰äººæ¥æ‰‹ã€ï¼Œç¢ºä¿æœå‹™ä¸ä¸­æ–·ã€‚"
                        ],
                        principle: "å¯ç”¨æ€§ (Availability) = æˆæ¬Šä½¿ç”¨è€…åœ¨éœ€è¦æ™‚èƒ½å­˜å–è³‡ç”¢ã€‚",
                        example: "éŠ€è¡Œä¿éšªç®±ï¼ˆæ©Ÿå¯†æ€§ï¼‰ vs ç™¼é›»æ©Ÿï¼ˆå¯ç”¨æ€§ï¼‰ã€‚ç™¼é›»æ©Ÿä¸èƒ½é˜²å°å·ï¼Œä½†èƒ½è®“ä½ åœ¨åœé›»æ™‚é‚„èƒ½å·¥ä½œã€‚"
                    },
                    options_analysis: [
                        { opt: "å¤šå› å­èªè­‰ (MFA)", result: "æ©Ÿå¯†æ€§", reason: "ç¢ºèªèº«åˆ†ï¼Œé˜²æ­¢å¸³è™Ÿè¢«ç›œç”¨å·çœ‹è³‡æ–™ã€‚" },
                        { opt: "å®šæœŸæ›´æ”¹å¯†ç¢¼", result: "æ©Ÿå¯†æ€§", reason: "é™ä½èˆŠå¯†ç¢¼å¤–æ´©è¢«åˆ©ç”¨çš„é¢¨éšªã€‚" },
                        { opt: "å³æ™‚ç³»çµ±å‚™æ´", result: "å¯ç”¨æ€§ (æ­£è§£)", reason: "ç›®çš„æ˜¯ç¢ºä¿ç³»çµ±æœå‹™ä¸ä¸­æ–·ï¼Œèˆ‡è³‡æ–™ä¿å¯†ç„¡ç›´æ¥é—œä¿‚ã€‚" },
                        { opt: "TLS 1.3 åŠ å¯†", result: "æ©Ÿå¯†æ€§", reason: "é˜²æ­¢å‚³è¼¸éç¨‹è¢«ç«Šè½ã€‚" }
                    ],
                    extension: {
                        law: "CIA Triad æ˜¯è³‡å®‰æœ€æ ¸å¿ƒçš„åŸºç¤æ¨¡å‹ã€‚",
                        analogy: "DDoS æ”»æ“Šå°±æ˜¯åœ¨ç ´å£å¯ç”¨æ€§ï¼›å‹’ç´¢è»Ÿé«”åŠ å¯†æª”æ¡ˆä¹Ÿæ˜¯åœ¨ç ´å£å¯ç”¨æ€§ï¼ˆè®“ä½ ä¸èƒ½ç”¨ï¼‰ã€‚"
                    },
                    mnemonic: "ã€ŒåŠ å¯†é–é–€æ˜¯æ©Ÿå¯†ï¼Œå‚™ä»½å‚™æ´æ˜¯å¯ç”¨ã€‚ã€",
                    trap: {
                        blindspot: "æŠŠã€Œè³‡å®‰ã€ç•¶ä½œä¸€å€‹æ¨¡ç³Šçš„æ•´é«”ï¼Œæ²’åˆ†ç´°é …ã€‚",
                        guide: "çœ‹åˆ°ã€Œå‚™ä»½ã€ã€ã€Œå‚™æ´ã€ã€ã€Œé«˜å¯ç”¨ (HA)ã€ç­‰é—œéµå­—ï¼Œè«‹ç›´æ¥è¯æƒ³ã€Œå¯ç”¨æ€§ (A)ã€ã€‚"
                    },
                    self_check: [
                        { q: "å¦‚æœé§­å®¢æŠŠä½ çš„éŠ€è¡Œå­˜æ¬¾å¾ 100 å…ƒæ”¹æˆ 10000 å…ƒï¼Œé€™æ˜¯ç ´å£äº†å“ªä¸€é …ï¼Ÿ", a: "å®Œæ•´æ€§ (Integrity)ã€‚" },
                        { q: "å‹’ç´¢è»Ÿé«”æŠŠä½ é›»è…¦é–èµ·ä¾†è¦è´–é‡‘ï¼Œä¸»è¦å½±éŸ¿äº†ä»€éº¼ï¼Ÿ", a: "å¯ç”¨æ€§ (Availability)ã€‚" }
                    ]
                }
            },
            {
                id: 24,
                tag: "æ³•è¦",
                tagClass: "tag-law",
                text: "ç¶²è·¯è²©å”®ç³»çµ±ä¸Šç·š 6 å€‹æœˆå¾Œï¼Œå…¬å¸æ”¶åˆ°è­‰åˆ¸ä¸»ç®¡æ©Ÿé—œé€šçŸ¥ï¼Œå¤§é‡æœƒå“¡è³‡æ–™è¢«äººæ–¼åœ‹å¤–ç¶²ç«™ä¸Šæ¶è²©å”®ã€‚è«‹å•ç™¼ç”Ÿæ­¤å€‹è³‡å¤–æ´©äº‹ä»¶ï¼Œå…¬å¸æ–¼å›æ‡‰æ­¤è³‡å®‰äº‹ä»¶æ™‚ï¼Œé ˆæ³¨æ„ä¸‹åˆ—å“ªäº›æ³•ä»¤è¦ç« ï¼Ÿï¼ˆè¤‡é¸ï¼‰",
                type: "checkbox",
                options: [
                    "é›»è…¦è™•ç†å€‹äººè³‡æ–™ä¿è­·æ³•",
                    "ä¸Šå¸‚ä¸Šæ«ƒå…¬å¸è³‡é€šå®‰å…¨ç®¡æ§æŒ‡å¼•",
                    "å€‹äººè³‡æ–™ä¿è­·æ³•",
                    "é£Ÿå“å®‰å…¨è¡›ç”Ÿç®¡ç†æ³•"
                ],
                correct: ["ä¸Šå¸‚ä¸Šæ«ƒå…¬å¸è³‡é€šå®‰å…¨ç®¡æ§æŒ‡å¼•", "å€‹äººè³‡æ–™ä¿è­·æ³•"],
                analysis: {
                    keywords: ["ä¸Šå¸‚å…¬å¸", "å€‹è³‡å¤–æ´©", "æ³•ä»¤è¦ç« "],
                    translation: "ä¸€å®¶å¤§å…¬å¸ï¼ˆä¸Šå¸‚å…¬å¸ï¼‰æŠŠæœƒå“¡è³‡æ–™å¼„ä¸Ÿäº†ï¼Œè™•ç†é€™ä»¶äº‹è¦ç¿»å“ªå¹¾æœ¬æ³•å¾‹æ›¸ï¼Ÿ",
                    logic: {
                        steps: [
                            "åˆ†æäº‹ä»¶æœ¬è³ªï¼šå€‹è³‡å¤–æ´© -> å¿…é©ç”¨ã€Šå€‹äººè³‡æ–™ä¿è­·æ³•ã€‹ã€‚",
                            "åˆ†æå…¬å¸èº«åˆ†ï¼šä¸Šå¸‚å…¬å¸ -> å¿…é©ç”¨è­‰åˆ¸ä¸»ç®¡æ©Ÿé—œä¹‹ã€Šè³‡é€šå®‰å…¨ç®¡æ§æŒ‡å¼•ã€‹ã€‚",
                            "åˆªå»æ³•ï¼šèˆŠæ³•å·²å»¢æ­¢ï¼›é£Ÿå®‰æ³•ç®¡é£Ÿç‰©ä¸ç®¡è³‡æ–™ã€‚"
                        ],
                        principle: "æ³•è¦éµå¾ªéœ€åŒæ™‚è€ƒé‡ã€Œè¡Œæ¥­åˆ¥ï¼ˆä¸Šå¸‚å…¬å¸ï¼‰ã€èˆ‡ã€Œäº‹ä»¶å±¬æ€§ï¼ˆå€‹è³‡äº‹ä»¶ï¼‰ã€ã€‚",
                        example: "é–‹è»Šæ’äººï¼ˆåˆ‘æ³•/æ°‘æ³•ï¼‰ï¼Œå¦‚æœä½ æ˜¯è·æ¥­è¨ˆç¨‹è»Šå¸æ©Ÿï¼Œé‚„è¦å¤šçœ‹ä¸€æ¢ã€Šé“è·¯äº¤é€šç®¡ç†è™•ç½°æ¢ä¾‹ã€‹é—œæ–¼è·æ¥­é§•é§›çš„åŠ é‡è¦å®šã€‚"
                    },
                    options_analysis: [
                        { opt: "é›»è…¦è™•ç†å€‹äººè³‡æ–™...", result: "éŒ¯èª¤", reason: "é€™æ˜¯èˆŠæ³•ï¼Œå·²è¢«ã€Šå€‹äººè³‡æ–™ä¿è­·æ³•ã€‹å–ä»£ã€‚" },
                        { opt: "ä¸Šå¸‚ä¸Šæ«ƒ...ç®¡æ§æŒ‡å¼•", result: "æ­£ç¢º", reason: "å› ç‚º K å…¬å¸æ˜¯ä¸Šå¸‚å…¬å¸ï¼Œå¿…é ˆéµå®ˆé‡‘ç®¡æœƒçš„ç‰¹åˆ¥è¦ç¯„ã€‚" },
                        { opt: "å€‹äººè³‡æ–™ä¿è­·æ³•", result: "æ­£ç¢º", reason: "ç™¼ç”Ÿå€‹è³‡å¤–æ´©äº‹ä»¶çš„æœ€é«˜æŒ‡å°åŸå‰‡ã€‚" },
                        { opt: "é£Ÿå“å®‰å…¨è¡›ç”Ÿç®¡ç†æ³•", result: "éŒ¯èª¤", reason: "é€™æ˜¯ç®¡ç”¢å“ï¼ˆé£Ÿå“ï¼‰å®‰å…¨çš„ï¼Œè·Ÿè³‡æ–™å¤–æ´©ç„¡é—œã€‚" }
                    ],
                    extension: {
                        law: "ç‰¹åˆ¥æ³•å„ªæ–¼æ™®é€šæ³•æ¦‚å¿µï¼›ä¸åŒç›£ç®¡å–®ä½æœ‰ä¸åŒè¦æ±‚ã€‚",
                        analogy: "å¦‚æœæ˜¯å…¬å‹™æ©Ÿé—œç™¼ç”Ÿæ­¤äº‹ï¼Œå°±è¦çœ‹ã€Šè³‡é€šå®‰å…¨ç®¡ç†æ³•ã€‹ã€‚"
                    },
                    mnemonic: "ã€Œå€‹è³‡æ¼äº†çœ‹å€‹è³‡ï¼Œä¸Šå¸‚æ«ƒåŠ çœ‹æŒ‡å¼•ã€‚ã€",
                    trap: {
                        blindspot: "çœ‹åˆ°ã€Œé£Ÿå“è£½é€ å•†ã€å°±æƒ³é¸é£Ÿå®‰æ³•ã€‚",
                        guide: "é¡Œç›®å•çš„æ˜¯ã€Œè³‡å®‰äº‹ä»¶ã€çš„å›æ‡‰ï¼Œä¸æ˜¯å•ã€Œç”¢å“éæœŸã€çš„å›æ‡‰ã€‚è«‹å°ç—‡ä¸‹è—¥ã€‚"
                    },
                    self_check: [
                        { q: "å¦‚æœé€™å®¶å…¬å¸ä¸æ˜¯ä¸Šå¸‚å…¬å¸ï¼Œé‚„éœ€è¦éµå®ˆç®¡æ§æŒ‡å¼•å—ï¼Ÿ", a: "ä¸éœ€è¦ã€‚ä½†ä»éœ€éµå®ˆå€‹è³‡æ³•ã€‚" },
                        { q: "å¦‚æœåªæ˜¯ç³»çµ±ç•¶æ©Ÿä½†æ²’æœ‰è³‡æ–™å¤–æ´©ï¼Œå„ªå…ˆé©ç”¨å“ªä¸€å€‹ï¼Ÿ", a: "è‹¥æ˜¯ä¸Šå¸‚å…¬å¸ï¼Œä»éœ€ä¾ã€Šç®¡æ§æŒ‡å¼•ã€‹é€šå ±è³‡å®‰äº‹ä»¶ï¼Œä½†ä¸ä¸€å®šé©ç”¨ã€Šå€‹è³‡æ³•ã€‹ï¼ˆé™¤éæœ‰å€‹è³‡å—æï¼‰ã€‚" }
                    ]
                }
            }
        ]
    };

    // --- 2. ç‹€æ…‹ç®¡ç† ---
    let appState = {
        currentTab: 0,
        answers: {}, // { qId: { selected: [], isCorrect: bool, submitted: bool } }
    };

    // åˆå§‹åŒ–ç‹€æ…‹
    quizData.questions.forEach(q => {
        appState.answers[q.id] = { selected: [], isCorrect: null, submitted: false };
    });

    // --- 3. æ ¸å¿ƒåŠŸèƒ½ ---

    // æ´—ç‰Œæ¼”ç®—æ³• Fisher-Yates
    function shuffleArray(array) {
        let currentIndex = array.length, randomIndex;
        let newArr = [...array];
        while (currentIndex != 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [newArr[currentIndex], newArr[randomIndex]] = [newArr[randomIndex], newArr[currentIndex]];
        }
        return newArr;
    }

    // æ–‡å­—è™•ç†ï¼šè² é¢è©æ¨™ç´…
    function highlightKeywords(text) {
        const negativeWords = ["ä¸", "ä¸æ˜¯", "éŒ¯èª¤", "æœ€ä¸é©ç”¨", "æ²’æœ‰", "é"];
        let processedText = text;
        negativeWords.forEach(word => {
            const regex = new RegExp(`(${word})`, 'g');
            processedText = processedText.replace(regex, `<span class="highlight-negative">$1</span>`);
        });
        return processedText;
    }

    // --- 4. æ¸²æŸ“é‚è¼¯ ---

    function init() {
        renderTabs();
        renderQuestion(0);
        updateProgress();
    }

    // æ¸²æŸ“ Tabs
    function renderTabs() {
        const container = document.getElementById('tabsContainer');
        container.innerHTML = '';
        
        quizData.questions.forEach((q, index) => {
            const btn = document.createElement('div');
            btn.className = `tab ${index === appState.currentTab ? 'active' : ''}`;
            
            let icon = '';
            const state = appState.answers[q.id];
            if (state.submitted) {
                if (state.isCorrect) {
                    btn.classList.add('correct');
                    icon = 'âœ“';
                } else {
                    btn.classList.add('wrong');
                    icon = 'âœ—';
                }
            } else {
                icon = (index + 1).toString();
            }

            btn.innerHTML = `<span class="tab-icon">${icon}</span> ç¬¬ ${q.id} é¡Œ`;
            btn.onclick = () => switchTab(index);
            container.appendChild(btn);
        });
    }

    function switchTab(index) {
        appState.currentTab = index;
        renderTabs();
        renderQuestion(index);
        document.querySelector('.app-container').scrollIntoView({ behavior: 'smooth' });
    }

    // æ¸²æŸ“é¡Œç›®èˆ‡è©³è§£ (Updated Render Logic)
    function renderQuestion(index) {
        const q = quizData.questions[index];
        const state = appState.answers[q.id];
        const container = document.getElementById('questionContainer');
        const analysis = q.analysis;
        
        if (!q.shuffledOptions) {
            q.shuffledOptions = shuffleArray(q.options);
        }

        // --- å»ºæ§‹è©³è§£ HTML ---
        let explanationHTML = '';
        if (state.submitted) {
            
            // é¸é …åˆ†æè¡¨æ ¼åˆ—
            const optionsTableRows = analysis.options_analysis.map(opt => `
                <tr class="${opt.result.includes('æ­£è§£') || opt.result.includes('æ­£ç¢º') ? 'correct-row' : ''}">
                    <td><strong>${opt.opt}</strong></td>
                    <td style="white-space:nowrap;">${opt.result}</td>
                    <td>${opt.reason}</td>
                </tr>
            `).join('');

            // è‡ªæˆ‘æª¢æ¸¬é …ç›®
            const selfCheckItems = analysis.self_check.map((item, idx) => `
                <div class="check-item">
                    <div class="check-question">
                        <span>Q${idx+1}:</span>
                        <span>${item.q}</span>
                    </div>
                    <div class="check-answer-box">
                        <button class="check-toggle-btn" onclick="this.nextElementSibling.style.display='block'; this.style.display='none'">
                            ğŸ‘‡ é»æ“Šé¡¯ç¤ºåƒè€ƒç­”æ¡ˆ
                        </button>
                        <div class="check-answer">
                            <strong>A:</strong> ${item.a}
                        </div>
                    </div>
                </div>
            `).join('');

            explanationHTML = `
                <div class="explain-section" id="explainSection" style="display:block">
                    <div class="explain-header">
                        <span>ğŸ“ è©³ç´°è§£æèˆ‡è§€å¿µå°è®€</span>
                        <span>${state.isCorrect ? 'âœ… ç­”å°' : 'âŒ ç­”éŒ¯'}</span>
                    </div>
                    <div class="explain-content">
                        
                        <!-- 1. é—œéµå­— -->
                        <div class="step-box">
                            <span class="step-badge">ç¬¬ä¸€æ­¥ï¼šæ‰¾é—œéµå­—</span>
                            <div class="step-content">
                                é¡Œç›®é‡é»ï¼š${analysis.keywords.map(k => `<span class="keyword-highlight">${k}</span>`).join('ã€')}
                            </div>
                        </div>

                        <!-- 2. ç™½è©±ç¿»è­¯ -->
                        <div class="step-box">
                            <span class="step-badge">ç¬¬äºŒæ­¥ï¼šç™½è©±ç¿»è­¯</span>
                            <div class="step-content">
                                "${analysis.translation}"
                            </div>
                        </div>

                        <!-- 3. è§£é¡Œæ€è·¯ -->
                        <div class="step-box">
                            <span class="step-badge">ç¬¬ä¸‰æ­¥ï¼šè§£é¡Œæ€è·¯</span>
                            <div class="step-content">
                                <p><strong>ğŸ“Œ è§£é¡Œæ­¥é©Ÿï¼š</strong></p>
                                <ul class="logic-list">
                                    ${analysis.logic.steps.map(s => `<li>${s}</li>`).join('')}
                                </ul>
                                <hr style="margin:15px 0; border:0; border-top:1px dashed #ddd;">
                                <p><strong>âš–ï¸ åŸç†èˆ‡è¦å‰‡ï¼š</strong>${analysis.logic.principle}</p>
                                <p><strong>ğŸ ç”Ÿæ´»ä¾‹å­ï¼š</strong>${analysis.logic.example}</p>
                            </div>
                        </div>

                        <!-- 4. é¸é …åˆ†æ -->
                        <div class="step-box">
                            <span class="step-badge">ç¬¬å››æ­¥ï¼šé¸é …åˆ†æ</span>
                            <table class="analysis-table">
                                <thead>
                                    <tr>
                                        <th width="30%">é¸é …</th>
                                        <th width="15%">åˆ¤å®š</th>
                                        <th>åŸå› åˆ†æ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${optionsTableRows}
                                </tbody>
                            </table>
                        </div>

                        <!-- 5. è§€å¿µè£œå…… -->
                        <div class="step-box" style="background-color: #f4f6f7;">
                            <span class="step-badge" style="background-color:#7f8c8d;">è§€å¿µè£œå……èˆ‡å»¶ä¼¸</span>
                            <div class="step-content">
                                <p><strong>ğŸ“– å®šç¾©/æ³•æ¢ï¼š</strong>${analysis.extension.law}</p>
                                <p><strong>ğŸ”— è§¸é¡æ—é€šï¼š</strong>${analysis.extension.analogy}</p>
                            </div>
                        </div>

                        <!-- 6. è¨˜æ†¶é‡‘å¥ -->
                        <div class="golden-sentence">
                            ğŸ”‘ è¨˜æ†¶å£è¨£ï¼š${analysis.mnemonic}
                        </div>

                        <!-- 7. å¸¸è¦‹é™·é˜± -->
                        <div class="trap-box">
                            <div class="trap-title">âš ï¸ å¸¸è¦‹é™·é˜±</div>
                            <ul style="margin:0; padding-left:20px;">
                                <li><strong>å¿ƒç†ç›²é»ï¼š</strong>${analysis.trap.blindspot}</li>
                                <li><strong>é¿å‘æŒ‡å—ï¼š</strong>${analysis.trap.guide}</li>
                            </ul>
                        </div>

                        <!-- 8. è‡ªæˆ‘æª¢æ¸¬ -->
                        <div class="check-container">
                            <h4 style="color:#2c3e50; margin-bottom:10px;">ğŸ›¡ï¸ è‡ªæˆ‘æª¢æ¸¬ (Self-Check)</h4>
                            ${selfCheckItems}
                        </div>

                    </div>
                </div>
            `;
        }

        let html = `
            <div class="q-meta">
                <span class="tag ${q.tagClass}">${q.tag}</span>
                <span style="color: #666; font-size: 0.9rem;">${q.type === 'checkbox' ? 'ï¼ˆè¤‡é¸é¡Œï¼‰' : 'ï¼ˆå–®é¸é¡Œï¼‰'}</span>
            </div>
            <div class="q-text">${highlightKeywords(q.text)}</div>
            
            <div class="options-list">
                ${q.shuffledOptions.map(opt => {
                    const isSelected = state.selected.includes(opt);
                    const isSubmitted = state.submitted;
                    const isCorrectOption = q.correct.includes(opt);
                    
                    let classes = 'option-item';
                    if (isSelected) classes += ' selected';
                    if (isSubmitted) {
                        classes += ' disabled';
                        if (isCorrectOption) classes += ' correct-answer';
                        if (isSelected && !isCorrectOption) classes += ' wrong-answer';
                    }

                    return `
                        <div class="${classes}" 
                             onclick="handleOptionClick(${q.id}, '${opt.replace(/'/g, "\\'")}')"
                             data-type="${q.type}">
                            <div class="option-check"></div>
                            <div>${opt}</div>
                        </div>
                    `;
                }).join('')}
            </div>

            <div class="action-area">
                <button class="btn btn-submit" id="submitBtn" onclick="submitAnswer(${q.id})" ${state.submitted ? 'style="display:none"' : ''}>
                    é€å‡ºç­”æ¡ˆ
                </button>
                <button class="btn btn-retry" id="retryBtn" onclick="resetQuestion(${q.id})" ${state.submitted ? 'style="display:flex"' : ''}>
                    é‡æ–°ä½œç­”
                </button>
            </div>

            ${explanationHTML}
        `;

        container.innerHTML = html;
    }

    // --- 5. äº’å‹•é‚è¼¯ ---

    // é»æ“Šé¸é …
    window.handleOptionClick = function(qId, optionText) {
        const q = quizData.questions.find(x => x.id === qId);
        const state = appState.answers[qId];

        if (state.submitted) return;

        if (q.type === 'radio') {
            state.selected = [optionText];
        } else {
            const idx = state.selected.indexOf(optionText);
            if (idx > -1) {
                state.selected.splice(idx, 1);
            } else {
                state.selected.push(optionText);
            }
        }
        
        renderQuestion(quizData.questions.findIndex(x => x.id === qId));
    };

    // é€å‡ºç­”æ¡ˆ
    window.submitAnswer = function(qId) {
        const q = quizData.questions.find(x => x.id === qId);
        const state = appState.answers[qId];

        if (state.selected.length === 0) {
            alert("è«‹å…ˆé¸æ“‡è‡³å°‘ä¸€å€‹ç­”æ¡ˆï¼");
            return;
        }

        const sortedSelected = [...state.selected].sort();
        const sortedCorrect = [...q.correct].sort();
        
        const isCorrect = JSON.stringify(sortedSelected) === JSON.stringify(sortedCorrect);
        
        state.submitted = true;
        state.isCorrect = isCorrect;

        renderTabs();
        renderQuestion(quizData.questions.findIndex(x => x.id === qId));
        updateProgress();

        setTimeout(() => {
            const explain = document.getElementById('explainSection');
            if(explain) explain.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
    };

    // é‡ç½®å–®é¡Œ
    window.resetQuestion = function(qId) {
        const q = quizData.questions.find(x => x.id === qId);
        appState.answers[qId] = { selected: [], isCorrect: null, submitted: false };
        q.shuffledOptions = shuffleArray(q.options);

        renderTabs();
        renderQuestion(quizData.questions.findIndex(x => x.id === qId));
        updateProgress();
        
        document.querySelector('.question-container').scrollIntoView({ behavior: 'smooth' });
    };

    // æ›´æ–°é€²åº¦æ¢
    function updateProgress() {
        const total = quizData.questions.length;
        let completed = 0;
        Object.values(appState.answers).forEach(s => {
            if (s.submitted) completed++;
        });

        const percent = (completed / total) * 100;
        document.getElementById('progressBar').style.width = `${percent}%`;
        document.getElementById('progressText').innerText = `${completed}/${total}`;
    }

    // å•Ÿå‹•
    init();

</script>

</body>
</html>