<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iPAS è³‡å®‰é¡Œçµ„ï¼šå§”å¤–ç®¡ç†èˆ‡äº‹ä»¶è™•ç½®ï¼ˆå…¨èƒ½è§£æç‰ˆï¼‰</title>
    <style>
        :root {
            /* é…è‰²ç³»çµ± */
            --primary: #1e3a8a;
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-main: #2c3e50;
            --text-sec: #546e7a;
            --border: #e0e0e0;
            
            /* ç‹€æ…‹è‰² */
            --success: #27ae60;
            --success-bg: #e8f5e9;
            --error: #c0392b;
            --error-bg: #fce4ec;
            --neutral: #95a5a6;
            
            /* æ¨™ç±¤è‰² */
            --tag-law: #607d8b;
            --tag-iso: #27ae60;
            --tag-zt: #8e44ad;
            --tag-net: #2980b9;
            --tag-sec: #c0392b;
            --tag-mgm: #d35400;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: system-ui, "Noto Sans TC", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.6;
            margin: 0;
            padding: 20px 10px;
            font-size: 16px;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
        }

        /* --- Header & Progress --- */
        header {
            margin-bottom: 20px;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        h1 {
            font-size: 1.25rem;
            margin: 0;
            color: var(--primary);
        }

        .progress-info {
            font-weight: bold;
            color: var(--text-sec);
            font-size: 0.9rem;
        }

        .progress-track {
            background: #e9ecef;
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.4s ease;
        }

        /* --- Global Scenario --- */
        .scenario-box {
            background-color: #e3f2fd;
            border-left: 5px solid #2196f3;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            font-size: 0.95rem;
            color: #0d47a1;
        }

        .scenario-title {
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
            font-size: 1rem;
        }

        /* --- Tabs Navigation --- */
        .tabs {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 10px;
            margin-bottom: 20px;
            scrollbar-width: none; /* Firefox */
        }
        
        .tabs::-webkit-scrollbar {
            display: none; /* Chrome/Safari */
        }

        .tab-btn {
            background: var(--card-bg);
            border: 1px solid var(--border);
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            white-space: nowrap;
            font-weight: bold;
            color: var(--text-sec);
            transition: all 0.2s;
            min-height: 48px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 10px rgba(30, 58, 138, 0.3);
        }

        .tab-btn.correct {
            border-color: var(--success);
            color: var(--success);
        }
        .tab-btn.correct.active {
            background: var(--success);
            color: white;
        }

        .tab-btn.wrong {
            border-color: var(--error);
            color: var(--error);
        }
        .tab-btn.wrong.active {
            background: var(--error);
            color: white;
        }

        /* --- Question Card --- */
        .question-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            display: none; /* Hidden by default */
            animation: fadeIn 0.3s ease;
        }

        .question-card.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .q-meta {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .tag {
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
        }
        .tag-law { background-color: var(--tag-law); }
        .tag-mgm { background-color: var(--tag-mgm); }
        .tag-sec { background-color: var(--tag-sec); }
        .tag-iso { background-color: var(--tag-iso); }

        .q-text {
            font-size: 1.15rem;
            font-weight: 600;
            margin-bottom: 25px;
            color: var(--text-main);
        }

        .highlight-negative {
            color: #d32f2f;
            font-weight: 800;
            background: #ffcdd2;
            padding: 0 4px;
            border-radius: 4px;
        }

        /* --- Options --- */
        .options-grid {
            display: grid;
            gap: 12px;
        }

        .option-label {
            display: flex;
            align-items: flex-start;
            padding: 16px;
            background: #fff;
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .option-label:hover {
            background-color: #f8f9fa;
        }

        /* Hide default checkbox/radio */
        .option-input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        /* Custom check indicator */
        .checkmark {
            height: 24px;
            width: 24px;
            background-color: #eee;
            border-radius: 50%;
            margin-right: 15px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .option-input[type="checkbox"] + .checkmark {
            border-radius: 6px;
        }

        .option-label:has(.option-input:checked) {
            border-color: var(--primary);
            background-color: #e8f0fe;
        }

        .option-label:has(.option-input:checked) .checkmark {
            background-color: var(--primary);
            color: white;
        }

        .checkmark::after {
            content: "";
            display: none;
        }

        .option-input:checked + .checkmark::after {
            display: block;
            content: "âœ”";
            font-size: 14px;
        }

        /* States after submission */
        .option-label.correct-answer {
            border-color: var(--success) !important;
            background-color: var(--success-bg) !important;
        }
        .option-label.correct-answer .checkmark {
            background-color: var(--success);
            color: white;
        }

        .option-label.wrong-answer {
            border-color: var(--error) !important;
            background-color: var(--error-bg) !important;
            opacity: 0.7;
        }
        .option-label.wrong-answer .checkmark {
            background-color: var(--error);
            color: white;
        }

        .option-label.disabled {
            pointer-events: none;
        }

        /* --- Action Area --- */
        .action-area {
            margin-top: 25px;
            display: flex;
            gap: 15px;
        }

        .btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.2s;
            color: white;
            min-height: 48px;
        }

        .btn-submit { background-color: var(--primary); }
        .btn-reset { background-color: var(--neutral); display: none; }
        .btn:hover { opacity: 0.9; }

        /* --- Full Explanation Section (All 8 Steps) --- */
        .explanation {
            margin-top: 30px;
            display: none;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-block {
            margin-bottom: 20px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
            background: #fff;
        }

        .step-header {
            padding: 12px 16px;
            font-weight: bold;
            font-size: 1.05rem;
            display: flex;
            align-items: center;
        }

        .step-content {
            padding: 16px;
            border-top: 1px solid var(--border);
            color: var(--text-main);
            font-size: 0.95rem;
        }
        
        .step-content ul, .step-content ol {
            margin: 0;
            padding-left: 20px;
        }
        
        .step-content li {
            margin-bottom: 6px;
        }

        /* é¡è‰²å®šç¾© */
        .step-1 .step-header { background: #fff3e0; color: #e65100; border-bottom-color: #ffe0b2; } /* é—œéµå­— - æ©˜ */
        .step-2 .step-header { background: #e3f2fd; color: #1565c0; border-bottom-color: #bbdefb; } /* ç™½è©± - è— */
        .step-3 .step-header { background: #f3e5f5; color: #7b1fa2; border-bottom-color: #e1bee7; } /* æ€è·¯ - ç´« */
        .step-4 .step-header { background: #e8f5e9; color: #2e7d32; border-bottom-color: #c8e6c9; } /* é¸é … - ç¶  */
        .step-5 .step-header { background: #eceff1; color: #455a64; border-bottom-color: #cfd8dc; } /* è§€å¿µ - ç° */
        .step-6 .step-header { background: #fff8e1; color: #fbc02d; border-bottom-color: #ffecb3; } /* å£è¨£ - é‡‘ */
        .step-7 .step-header { background: #ffebee; color: #c62828; border-bottom-color: #ffcdd2; } /* é™·é˜± - ç´… */
        .step-8 .step-header { background: #e0f2f1; color: #00695c; border-bottom-color: #b2dfdb; } /* è‡ªæˆ‘æª¢æ¸¬ - é’ */

        /* é—œéµå­— Highlight */
        .kw-tag {
            display: inline-block;
            background: #ffe0b2;
            color: #e65100;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: bold;
            margin: 2px;
        }

        /* è‡ªæˆ‘æª¢æ¸¬ç‰¹æ®Šæ¨£å¼ */
        .self-check-item {
            background: #fafafa;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
        }
        
        .self-check-q {
            font-weight: bold;
            margin-bottom: 10px;
            color: #37474f;
        }

        .self-check-btn {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            margin-bottom: 5px;
        }
        
        .self-check-btn:hover {
            background: var(--primary);
            color: white;
        }

        .self-check-ans {
            margin-top: 10px;
            padding: 10px;
            background: #e0f2f1;
            border-radius: 6px;
            color: #00695c;
            display: none;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .container { width: 100%; padding: 0; }
            .tabs { padding: 0 10px 10px 10px; }
            .question-card { border-radius: 0; box-shadow: none; padding: 20px; }
            header { border-radius: 0; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="header-top">
            <h1>iPAS è³‡å®‰é¡Œçµ„ï¼šå§”å¤–èˆ‡äº‹ä»¶è™•ç½®</h1>
            <div class="progress-info">
                å®Œæˆé€²åº¦ï¼š<span id="progress-text">0/4</span>
            </div>
        </div>
        <div class="progress-track">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
    </header>

    <div class="scenario-box">
        <span class="scenario-title">ğŸ“š é¡Œçµ„å…±åŒæƒ…å¢ƒ</span>
        A å…¬å¸ä¸»è¦æ ¸å¿ƒæ¥­å‹™ä¿‚æä¾›åœ‹å…§å„å¤§é‡‘èæ©Ÿæ§‹ï¼ˆå‡å±¬è³‡é€šå®‰å…¨ç®¡ç†æ³•è¦ç¯„å°è±¡ï¼‰æœ‰é—œç³»çµ±ä¹‹å®¢è£½åŒ–é–‹ç™¼æ¥­å‹™ï¼Œåˆä½œå¤¥ä¼´ B å…¬å¸ç‚ºé•·å¹´æ‰¿æ¥ A å…¬å¸æ——ä¸‹èˆ‡é‡‘èæ©Ÿæ§‹å§”è¨—æ¥­å‹™ã€‚ç”²ç‚ºåœ‹å…§é¦–å±ˆä¸€æŒ‡ä¹‹é‡‘èæ©Ÿæ§‹ï¼Œä»Šæœ‰ä¸€é‡‘èç³»çµ±å§”å¤–é–‹ç™¼å°ˆæ¡ˆï¼Œå°ˆæ¡ˆåŒ…å«é«˜ç´šï¼ˆXï¼‰ã€ä¸­ç´šï¼ˆYï¼‰åŠæ™®ç´šï¼ˆZï¼‰ç³»çµ±ã€‚å§”è¨—é‡‘é¡ç‚ºæ–°å°å¹£æŒä»Ÿè¬å…ƒæ•´ï¼Œå°ˆæ¡ˆé–‹ç™¼ç‚ºæœŸä¸€å¹´ã€‚
    </div>

    <!-- Tabs Navigation -->
    <div class="tabs" id="tabs-container">
        <!-- Generated by JS -->
    </div>

    <!-- Questions Container -->
    <div id="questions-container">
        <!-- Generated by JS -->
    </div>

</div>

<script>
    // é¡Œç›®è³‡æ–™ (æ“´å……ç‚ºå…«å¤§æ­¥é©Ÿçµæ§‹)
    const quizData = {
        groupTitle: "å§”å¤–é–‹ç™¼èˆ‡è³‡å®‰ç®¡ç†é¡Œçµ„",
        groupScenario: "A å…¬å¸æ‰¿æ”¬ç”²é‡‘èæ©Ÿæ§‹ä¹‹ç³»çµ±é–‹ç™¼æ¡ˆï¼Œä¸¦å°‡éƒ¨åˆ†æ¥­å‹™è¤‡å§”è¨—äºˆ B å…¬å¸ã€‚",
        questions: [
            {
                id: 1,
                originalId: 5,
                tags: ["tag-mgm", "ç®¡ç†å ±å‘Š"],
                type: "single",
                text: "ä½ åœ¨æ•´ç†å°‡å®Œæ•´çš„æ¸¬è©¦å ±å‘Šæº–å‚™æäº¤çµ¦è‘£äº‹æœƒï¼Œä¸‹åˆ—ä½•é …å…§å®¹æœ€ã€Œä¸ã€é‡è¦ï¼Ÿ",
                options: [
                    "æ¸¬è©¦äººå“¡èƒŒæ™¯èˆ‡å·¥å…·ç‰ˆæœ¬",
                    "åŸ·è¡Œæ¸¬è©¦æ‰€éœ€è€—è²»çš„æ™‚é–“",
                    "ç¬¦åˆå…¬å¸æœŸæœ›åŠéœ€æ±‚çš„çµè«–",
                    "å¼±é»è©•ä¼°çµæœã€è©•ä¼°è¨ˆåˆ†çš„æ–¹æ³•è«–ã€åˆ†æ•¸èˆ‡ä¿®è£œå»ºè­°"
                ],
                correct: ["åŸ·è¡Œæ¸¬è©¦æ‰€éœ€è€—è²»çš„æ™‚é–“"],
                analysis: {
                    step1: ["æäº¤çµ¦è‘£äº‹æœƒ", "å®Œæ•´æ¸¬è©¦å ±å‘Š", "æœ€ä¸é‡è¦", "ä¿®è£œå»ºè­°", "æ–¹æ³•è«–"],
                    step2: "ä½ è¦çµ¦å…¬å¸çš„å¤§è€é—†å€‘çœ‹ä¸€ä»½è³‡å®‰æ¸¬è©¦çµæœï¼Œè«‹å•ä¸‹é¢å“ªä¸€å€‹é¸é …å°ä»–å€‘åšã€ŒæŠ•è³‡æ±ºç­–ã€æˆ–ã€Œåˆ¤æ–·é¢¨éšªã€æœ€æ²’æœ‰ç”¨ï¼Ÿ",
                    step3: {
                        steps: ["æ€è€ƒè‘£äº‹æœƒé—œå¿ƒä»€éº¼ï¼ˆéŒ¢ã€é¢¨éšªã€æ³•å¾‹è²¬ä»»ï¼‰ã€‚", "åˆ¤æ–·é¸é …æ€§è³ªï¼šæ˜¯ã€Œæ±ºç­–ç”¨ã€é‚„æ˜¯ã€Œç´”åŸ·è¡Œç”¨ã€ï¼Ÿ", "æ’é™¤èˆ‡é¢¨éšªæ±ºç­–ç„¡é—œçš„è¡Œæ”¿ç´°ç¯€ã€‚"],
                        principle: "å ±å‘Šå¿…é ˆä¾è®€è€…åˆ†ç´š (Executive Reporting)ã€‚è‘£äº‹æœƒçœ‹çš„æ˜¯é¢¨éšªã€å½±éŸ¿èˆ‡å»ºè­°ï¼›æŠ€è¡“äººå“¡çœ‹çš„æ˜¯ç´°ç¯€èˆ‡éç¨‹ã€‚",
                        example: "å°±åƒæ ¡é•·åªé—œå¿ƒå­¸æ ¡ç‰†å£æœƒä¸æœƒå€’ã€è¦èŠ±å¤šå°‘éŒ¢ä¿®ï¼Œè€Œä¸åœ¨ä¹ç¶­ä¿®å·¥äººèŠ±äº†å¹¾å€‹å°æ™‚åœ¨æª¢æŸ¥ã€‚"
                    },
                    step4: [
                        { opt: "(A) æ¸¬è©¦äººå“¡èƒŒæ™¯", desc: "ä»£è¡¨å ±å‘Šçš„æ¬Šå¨æ€§èˆ‡å¯ä¿¡åº¦ï¼Œè®“è‘£äº‹æœƒçŸ¥é“ä¸æ˜¯éš¨ä¾¿æ‰¾äººæ¸¬çš„ï¼Œå…·åƒè€ƒåƒ¹å€¼ã€‚" },
                        { opt: "(B) åŸ·è¡Œè€—è²»æ™‚é–“", desc: "ã€æ­£ç¢ºã€‘é€™æ˜¯å°ˆæ¡ˆç®¡ç†çš„è¡Œæ”¿ç‘£äº‹ï¼ˆèŠ±äº†å¹¾å°æ™‚ï¼‰ï¼Œå°ã€Œæ˜¯å¦è©²å¢åŠ è³‡å®‰é ç®—ã€çš„æ±ºç­–å¹«åŠ©æœ€å°ã€‚", status: "correct" },
                        { opt: "(C) ç¬¦åˆæœŸæœ›çµè«–", desc: "é€™æ˜¯åˆ¤æ–·å°ˆæ¡ˆæ˜¯å¦æˆåŠŸçš„é—œéµæŒ‡æ¨™ (KPI)ï¼Œè‘£äº‹æœƒéå¸¸çœ‹é‡ã€‚" },
                        { opt: "(D) è©•ä¼°çµæœèˆ‡å»ºè­°", desc: "é€™å‘Šè¨´è‘£äº‹æœƒé¢¨éšªåœ¨å“ªã€æœ‰å¤šåš´é‡ (åˆ†æ•¸)ã€è©²æ€éº¼ä¿® (å»ºè­°)ï¼Œæ˜¯æ±ºç­–æ ¸å¿ƒã€‚" }
                    ],
                    step5: {
                        law: "è³‡é€šå®‰å…¨ç®¡ç†æ³• - ç®¡ç†éšå±¤å¯©æŸ¥",
                        desc: "å ±å‘Šçš„ã€Œå®Œæ•´æ€§ã€å–æ±ºæ–¼ã€Œå—çœ¾çš„éœ€æ±‚ã€ã€‚å°é–‹ç™¼åœ˜éšŠè€Œè¨€ï¼ŒPayload å’Œ Log æ‰æ˜¯é‡è¦çš„ï¼›å°è‘£äº‹æœƒè€Œè¨€ï¼Œé¢¨éšªé‡åŒ–æ•¸æ“šæ‰æ˜¯é‡è¦çš„ã€‚"
                    },
                    step6: "è‘£äº‹æœƒçœ‹é¢¨éšªï¼Œä¸çœ‹è€—æ™‚ï¼›çœ‹çµæœï¼Œä¸çœ‹è‹¦å‹ã€‚",
                    step7: {
                        blind: "èª¤ä»¥ç‚ºã€Œå®Œæ•´å ±å‘Šã€å°±æ˜¯è¦é‰…ç´°é¡éºæŠŠæ‰€æœ‰éç¨‹å¯«é€²å»ã€‚",
                        guide: "çœ‹åˆ°ã€Œè‘£äº‹æœƒã€æˆ–ã€Œé«˜å±¤ã€ï¼Œç›´æ¥éæ¿¾æ‰ã€ŒæŠ€è¡“ç´°ç¯€ã€èˆ‡ã€Œè¡Œæ”¿æµæ°´å¸³ã€ã€‚"
                    },
                    selfCheck: [
                        { q: "å¦‚æœå ±å‘Šå°è±¡æ”¹æˆã€Œé–‹ç™¼åœ˜éšŠã€ï¼Œå“ªä¸€é …å…§å®¹æœƒè®Šå¾—æœ€é‡è¦ï¼Ÿ", a: "è©³ç´°çš„å¼±é»è§¸ç™¼æ­¥é©Ÿèˆ‡ Logï¼Œä»¥ä¾¿é‡ç¾èˆ‡ä¿®å¾©ã€‚" },
                        { q: "ç‚ºä»€éº¼è¦æœ‰ã€Œè©•ä¼°æ–¹æ³•è«–ã€ï¼Ÿ", a: "ç¢ºä¿åˆ†æ•¸æ˜¯å®¢è§€å…¬æ­£çš„ï¼Œä¸æ˜¯æ†‘æ„Ÿè¦ºæ‰“åˆ†æ•¸ï¼Œå¢åŠ å ±å‘Šå…¬ä¿¡åŠ›ã€‚" }
                    ]
                }
            },
            {
                id: 2,
                originalId: 6,
                tags: ["tag-law", "è¤‡å§”è¨—"],
                type: "single",
                text: "æœ‰é—œç”²é‡‘èæ©Ÿæ§‹å°± A å…¬å¸è¾¦ç†å—è¨—æ¥­å‹™ä¹‹ã€Œè¤‡å§”è¨—ã€äº‹é …ï¼Œå…¶æ‡‰æ³¨æ„ä¹‹äº‹é …ï¼Œä¸‹åˆ—èªªæ˜ä½•è€…æœ€ã€Œä¸ã€é©åˆ‡ï¼Ÿ",
                options: [
                    "è¤‡å§”è¨—ä¹‹ç¯„åœ",
                    "è¤‡å§”è¨—ä¹‹å°è±¡",
                    "è¤‡å§”è¨—ä¹‹é‡‘é¡",
                    "è¤‡å§”è¨—ä¹‹å—è¨—è€…æ‡‰å…·å‚™ä¹‹è³‡é€šå®‰å…¨ç¶­è­·æªæ–½"
                ],
                correct: ["è¤‡å§”è¨—ä¹‹é‡‘é¡"],
                analysis: {
                    step1: ["è³‡é€šå®‰å…¨ç®¡ç†æ³•", "è¤‡å§”è¨—", "å–å¾—åŒæ„", "æœ€ä¸é©åˆ‡"],
                    step2: "ç”²éŠ€è¡Œè¦å¯©æ ¸ A å…¬å¸æŠŠå·¥ä½œè½‰åŒ…çµ¦ B å…¬å¸çš„è¡Œç‚ºï¼Œç”²ç‚ºäº†è³‡å®‰ï¼Œã€Œæœ€ä¸éœ€è¦ã€å„ªå…ˆå¯©æ ¸å“ªä¸€å€‹é …ç›®ï¼Ÿ",
                    step3: {
                        steps: ["æŠ“ä½ç”²é—œå¿ƒçš„æ˜¯ã€Œè³‡å®‰é¢¨éšªã€è€Œéã€Œå•†æ¥­åˆ©æ½¤ã€ã€‚", "æª¢æŸ¥æ¯å€‹é¸é …æ˜¯å¦èƒ½ç›´æ¥é™ä½è¢«é§­å®¢æ”»æ“Šçš„é¢¨éšªã€‚", "å‰”é™¤ç´”å•†æ¥­æ¢æ¬¾ã€‚"],
                        principle: "è³‡å®‰æ³•å­æ³•è¦æ±‚ï¼šå§”å¤–æ‡‰æ˜è¨‚ã€Œè¤‡å§”è¨—ä¹‹ç¯„åœã€å°è±¡åŠæ‡‰å…·å‚™ä¹‹è³‡é€šå®‰å…¨ç¶­è­·æªæ–½ã€ã€‚",
                        example: "å°±åƒä½ è«‹è£ä¿®å…¬å¸ï¼Œä½ æœƒç®¡ä»–æ‰¾å“ªå€‹æ°´é›»å·¥(å°è±¡)ã€ä¿®å“ªè£¡(ç¯„åœ)ã€æœ‰æ²’æœ‰è­‰ç…§(æªæ–½)ï¼Œä½†ä½ ä¸æœƒç®¡è£ä¿®å…¬å¸åˆ†çµ¦æ°´é›»å·¥å¤šå°‘è–ªæ°´(é‡‘é¡)ã€‚"
                    },
                    step4: [
                        { opt: "(A) è¤‡å§”è¨—ä¹‹ç¯„åœ", desc: "ç¯„åœä¸æ¸…å¯èƒ½å°è‡´ B æ¥è§¸åˆ°ä¸è©²ç¢°çš„æ ¸å¿ƒè³‡æ–™ï¼Œé¢¨éšªæ¥µå¤§ã€‚" },
                        { opt: "(B) è¤‡å§”è¨—ä¹‹å°è±¡", desc: "å¿…é ˆå¯©æ ¸ B æ˜¯å¦ç‚ºé»‘åå–®å» å•†æˆ–æœ‰ä¸­è³‡èƒŒæ™¯ï¼ˆèƒŒæ™¯æŸ¥æ ¸ï¼‰ã€‚" },
                        { opt: "(C) è¤‡å§”è¨—ä¹‹é‡‘é¡", desc: "ã€æ­£ç¢ºã€‘é€™æ˜¯ A èˆ‡ B çš„å•†æ¥­æ©Ÿå¯†ï¼Œè·Ÿç³»çµ±æœƒä¸æœƒè¢«é§­æ²’æœ‰ç›´æ¥å› æœé—œä¿‚ã€‚", status: "correct" },
                        { opt: "(D) è³‡å®‰ç¶­è­·æªæ–½", desc: "B å¦‚æœæ²’åšé˜²æ¯’ã€æ²’åšé–€ç¦ï¼Œè³‡æ–™çµ¦ä»–å°±æ­»å®šäº†ï¼Œé€™æ˜¯æœ€æ ¸å¿ƒç®¡æ§é»ã€‚" }
                    ],
                    step5: {
                        law: "è³‡é€šå®‰å…¨è²¬ä»»ç­‰ç´šåˆ†ç´šè¾¦æ³• - é™„è¡¨å",
                        desc: "å§”å¤–ä¸ç­‰æ–¼å…è²¬ã€‚ç”²ä»è¦ç¢ºä¿å¤–åŒ…éˆæ¯ä¸€å±¤éƒ½é”åˆ°è³‡å®‰è¦æ±‚ (Supply Chain Security)ã€‚"
                    },
                    step6: "ç®¡ç¯„åœã€ç®¡å°è±¡ã€ç®¡æªæ–½ï¼›ä¸ç®¡éŒ¢ã€‚",
                    step7: {
                        blind: "è¦ºå¾—é ç®—å¤ªä½æœƒå½±éŸ¿å“è³ªï¼Œæ‰€ä»¥é‡‘é¡ä¹Ÿè¦ç®¡ã€‚",
                        guide: "é›–ç„¶é ç®—é–“æ¥å½±éŸ¿å“è³ªï¼Œä½†åœ¨è³‡å®‰æ³•è¦çš„å¯©æ ¸é …ç›®ä¸­ï¼Œé‡‘é¡ä¸æ˜¯ã€Œæ³•å®šå¿…è¦æŸ¥æ ¸é»ã€ã€‚"
                    },
                    selfCheck: [
                        { q: "ã€Œå–å¾—åŒæ„ã€çš„ä¸»è¦ç›®çš„æ˜¯ç®¡è²¬ä»»é‚„æ˜¯ç®¡é¢¨éšªï¼Ÿ", a: "ç®¡é¢¨éšªã€‚é¿å…æœªçŸ¥å» å•†å¼•å…¥ä¸å¯æ§çš„è³‡å®‰æ¼æ´ã€‚" },
                        { q: "å¦‚æœè¤‡å§”è¨—æ¶‰åŠé«˜ç´šç³»çµ±ï¼Œç”²æœ€å¯èƒ½åŠ å¼·ä»€éº¼ï¼Ÿ", a: "é™åˆ¶è¤‡å§”è¨—ç¯„åœï¼Œæˆ–è¦æ±‚ä¸å¯å°‡è³‡æ–™è½åœ°ã€‚" }
                    ]
                }
            },
            {
                id: 3,
                originalId: 7,
                tags: ["tag-sec", "æºç¢¼æª¢æ¸¬"],
                type: "single",
                text: "B å…¬å¸æ‰€è² è²¬ä¹‹ Y ç³»çµ±ï¼Œéƒ¨ä»½ç³»çµ±ç¨‹å¼ç¢¼ä¿‚å–è‡ªå¤–éƒ¨ç¬¬ä¸‰æ–¹æ‰€é–‹ç™¼ä¹‹ç¨‹å¼ç¢¼ã€‚ä¸‹åˆ—èªªæ˜ä½•è€…æœ€é©åˆ‡ï¼Ÿ",
                options: [
                    "å—è¨—æ¥­å‹™ä¹‹å§”è¨—é‡‘é¡æœªé”æ–°å°å¹£ä¸€åƒè¬å…ƒä»¥ä¸Šï¼Œæ•…ç„¡éœ€è¾¦ç†å®‰å…¨æ€§æª¢æ¸¬",
                    "æœ¬æ¡ˆæ‡‰ç”± B å…¬å¸è² è²¬æä¾›å®‰å…¨æ€§æª¢æ¸¬è­‰æ˜",
                    "ç”²é‡‘èæ©Ÿæ§‹è‡ªè¡Œæˆ–å¦è¡Œå§”è¨—ç¬¬ä¸‰æ–¹é€²è¡Œå®‰å…¨æ€§æª¢æ¸¬",
                    "æ‡‰æ¨™ç¤º B å…¬å¸éè‡ªè¡Œé–‹ç™¼ä¹‹å…§å®¹ï¼Œä½†ç„¡é ˆæä¾›å…¶ä¾†æºåŠæä¾›æˆæ¬Šè­‰æ˜"
                ],
                correct: ["ç”²é‡‘èæ©Ÿæ§‹è‡ªè¡Œæˆ–å¦è¡Œå§”è¨—ç¬¬ä¸‰æ–¹é€²è¡Œå®‰å…¨æ€§æª¢æ¸¬"],
                analysis: {
                    step1: ["ç¬¬ä¸‰æ–¹ç¨‹å¼ç¢¼", "è³‡é€šå®‰å…¨ç®¡ç†æ³•", "å®‰å…¨æ€§æª¢æ¸¬", "æœ€é©åˆ‡"],
                    step2: "ç³»çµ±è£¡é¢æœ‰ä¸€éƒ¨åˆ†ä¸æ˜¯é–‹ç™¼å•†è‡ªå·±å¯«çš„ï¼ˆæ˜¯æ‹¿åˆ¥äººçš„ç¨‹å¼ç¢¼ï¼‰ï¼Œèª°ä¾†åšå®‰å…¨æª¢æŸ¥ï¼Œæœ€èƒ½è®“æ¥­ä¸»ï¼ˆç”²ï¼‰æ”¾å¿ƒä¸”åˆè¦ï¼Ÿ",
                    step3: {
                        steps: ["ç¢ºèªèº«åˆ†ï¼šç”²æ˜¯æœ€çµ‚è² è²¬äººï¼ŒB æ˜¯é–‹ç™¼è€…ã€‚", "åˆ¤æ–·éœ€æ±‚ï¼šæª¢æ¸¬æœ€é‡è¦çš„æ˜¯ã€Œç¨ç«‹æ€§ã€èˆ‡ã€Œå…¬ä¿¡åŠ›ã€ã€‚", "é¢¨éšªåŠ æˆï¼šç¬¬ä¸‰æ–¹ç¨‹å¼ç¢¼å¯èƒ½æœ‰å¾Œé–€ã€‚"],
                        principle: "ç¨ç«‹é©—è­‰ (Independent Verification)ã€‚é¿å…çƒå“¡å…¼è£åˆ¤ã€‚",
                        example: "å°±åƒé¤å»³è²·å¤–é¢çš„åŠæˆå“ä¾†æ–™ç†ï¼Œè¡›ç”Ÿå±€æª¢æŸ¥æ™‚ï¼Œä¸èƒ½åªè½å»šå¸«èªªã€Œé€™æ²’å•é¡Œã€ï¼Œè€Œæ˜¯è¦æŠ½é©—æˆ–çœ‹ç¬¬ä¸‰æ–¹æª¢é©—å ±å‘Šã€‚"
                    },
                    step4: [
                        { opt: "(A) æœªé”åƒè¬å…æ¸¬", desc: "è³‡å®‰æ³•çœ‹çš„æ˜¯ã€Œç³»çµ±ç­‰ç´šã€èˆ‡ã€Œé¢¨éšªã€ï¼Œä¸æ˜¯çœ‹é‡‘é¡é–€æª»ã€‚" },
                        { opt: "(B) ç”± B æä¾›è­‰æ˜", desc: "çƒå“¡å…¼è£åˆ¤ï¼Œç¼ºä¹ç¨ç«‹æ€§ã€‚B å¯èƒ½æœƒéš±åŒ¿è‡ªå·±å¯«å‡ºçš„æ¼æ´ã€‚" },
                        { opt: "(C) ç”²è‡ªè¡Œæˆ–ç¬¬ä¸‰æ–¹æ¸¬", desc: "ã€æ­£ç¢ºã€‘æœ€å®¢è§€å…¬æ­£ï¼Œä¸”ç¬¦åˆè³‡å®‰æ³•å°æ©Ÿé—œç›£ç®¡çš„è¦æ±‚ï¼ˆç¨½æ ¸æ¬Šï¼‰ã€‚", status: "correct" },
                        { opt: "(D) æ¨™ç¤ºä½†å…æˆæ¬Š", desc: "éŒ¯èª¤ã€‚å¿…é ˆæä¾›ä¾†æºèˆ‡æˆæ¬Šè­‰æ˜ï¼Œå¦å‰‡æœƒæœ‰ç‰ˆæ¬Šèˆ‡ä¾›æ‡‰éˆæ”»æ“Šé¢¨éšªã€‚" }
                    ],
                    step5: {
                        law: "ä¾›æ‡‰éˆå®‰å…¨ (Supply Chain Security)",
                        desc: "ç”¨åˆ°åˆ¥äººå¯«çš„ codeï¼Œå°±è¦æ‰¿æ“”å®ƒå¯èƒ½æœ‰æ´çš„é¢¨éšªã€‚æª¢æ¸¬å¿…é ˆç”±èˆ‡é–‹ç™¼å•†ç„¡åˆ©ç›Šé—œä¿‚çš„ç¬¬ä¸‰æ–¹åŸ·è¡Œã€‚"
                    },
                    step6: "æª¢æ¸¬è¦ç¨ç«‹ï¼Œç¬¬ä¸‰æ–¹æœ€å…¬å…ï¼›ä¾†æºè¦æˆæ¬Šã€‚",
                    step7: {
                        blind: "èªç‚ºå» å•†æœ€æ‡‚ç³»çµ±ï¼Œæ‰€ä»¥è®“å» å•†æ¸¬æœ€æº–ã€‚",
                        guide: "å» å•†æ‡‚ç³»çµ±ï¼Œä½†ä¹Ÿæœ€æƒ³æ©è“‹å•é¡Œã€‚è³‡å®‰ç¨½æ ¸çš„æ ¸å¿ƒç²¾ç¥æ˜¯ Check & Balanceï¼ˆåˆ¶è¡¡ï¼‰ã€‚"
                    },
                    selfCheck: [
                        { q: "å¦‚æœ B å…¬å¸æä¾›çš„å ±å‘Šå¾ˆå®Œæ•´ï¼Œç”²é‚„éœ€è¦è¤‡æ¸¬å—ï¼Ÿ", a: "éœ€è¦ã€‚ç‚ºäº†ç¢ºä¿å ±å‘Šçš„çœŸå¯¦æ€§ï¼Œé€šå¸¸æœƒé€²è¡ŒæŠ½æ¸¬æˆ–ç¬¬ä¸‰æ–¹è¤‡æ¸¬ã€‚" },
                        { q: "ç‚ºä»€éº¼ã€Œæˆæ¬Šè­‰æ˜ã€è·Ÿè³‡å®‰æœ‰é—œï¼Ÿ", a: "ä½¿ç”¨ç›œç‰ˆæˆ–æœªæˆæ¬Šè»Ÿé«”ï¼Œå¯èƒ½å°è‡´ç³»çµ±è¢«è¿«åœç”¨ï¼ˆå¯ç”¨æ€§å–ªå¤±ï¼‰æˆ–ç„¡æ³•æ›´æ–°ä¿®è£œæ¼æ´ã€‚" }
                    ]
                }
            },
            {
                id: 4,
                originalId: 8,
                tags: ["tag-law", "äº‹ä»¶è™•ç½®"],
                type: "multi",
                text: "B å…¬å¸å·¥ç¨‹å¸«ç§æ¥å¤–ç¶²å°è‡´ Y ç³»çµ±ç¨‹å¼ç¢¼å¤–æ´©ã€‚é—œæ–¼æ­¤é‡å¤§è³‡é€šå®‰å…¨äº‹ä»¶ä¹‹è™•ç½®ï¼Œä¸‹åˆ—å“ªäº›æœ€é©åˆ‡ï¼Ÿï¼ˆè¤‡é¸ï¼‰",
                options: [
                    "è¾¦ç†å° B å…¬å¸ç¶²è·¯ç¶­è­·å·¥ç¨‹å¸«ä¹‹é©ä»»æ€§æŸ¥æ ¸",
                    "B å…¬å¸é€šå ± A å…¬å¸ä¸¦é€šçŸ¥ç”²é‡‘èæ©Ÿæ§‹è³‡é€šå®‰å…¨äº‹ä»¶",
                    "B å…¬å¸æ¡è¡Œè£œæ•‘æªæ–½",
                    "ç”²é‡‘èæ©Ÿæ§‹æ±ºè­°è§£é™¤è¤‡å§”è¨—æ¥­å‹™ï¼Œç¢ºèªè¤‡å§”è¨—ä¹‹å—è¨—è€…è¿”é‚„ã€ç§»äº¤ã€åˆªé™¤æˆ–éŠ·æ¯€å±¥è¡Œå¥‘ç´„è€ŒæŒæœ‰ä¹‹è³‡æ–™"
                ],
                correct: [
                    "B å…¬å¸é€šå ± A å…¬å¸ä¸¦é€šçŸ¥ç”²é‡‘èæ©Ÿæ§‹è³‡é€šå®‰å…¨äº‹ä»¶",
                    "B å…¬å¸æ¡è¡Œè£œæ•‘æªæ–½",
                    "ç”²é‡‘èæ©Ÿæ§‹æ±ºè­°è§£é™¤è¤‡å§”è¨—æ¥­å‹™ï¼Œç¢ºèªè¤‡å§”è¨—ä¹‹å—è¨—è€…è¿”é‚„ã€ç§»äº¤ã€åˆªé™¤æˆ–éŠ·æ¯€å±¥è¡Œå¥‘ç´„è€ŒæŒæœ‰ä¹‹è³‡æ–™"
                ],
                analysis: {
                    step1: ["ç§æ¥å¤–ç¶²", "ç¨‹å¼ç¢¼å¤–æ´©", "é‡å¤§è³‡å®‰äº‹ä»¶", "è™•ç½®", "æœ€é©åˆ‡"],
                    step2: "å¤–åŒ…å•†å‡ºåŒ…å°è‡´è³‡æ–™è¢«å·äº†ï¼Œç¾åœ¨é€™ä¸‰é–“å…¬å¸ç¬¬ä¸€æ™‚é–“è©²æ€éº¼åšï¼ˆé€šå ±ã€æ­¢è¡€ã€å–„å¾Œï¼‰æ‰å°ï¼Ÿ",
                    step3: {
                        steps: ["åˆ†é¡å‹•ä½œï¼šé€šå ±ï¼ˆé€šçŸ¥èª°ï¼‰ã€æ‡‰è®Šï¼ˆæ­¢è¡€ï¼‰ã€å–„å¾Œï¼ˆè³‡æ–™è™•ç†ï¼‰ã€‚", "æ ¸å¿ƒæª¢æŸ¥ï¼šé€šå ±è¦æœ‰é †åºï¼Œè£œæ•‘è¦å³æ™‚ï¼Œè§£ç´„è¦æ”¶å›è³‡æ–™ã€‚", "å‰”é™¤éŒ¯èª¤å°è±¡èˆ‡éå„ªå…ˆäº‹é …ã€‚"],
                        principle: "è³‡å®‰äº‹ä»¶æ‡‰è®Š (Incident Response)ï¼šé€šå ± -> æ‡‰è®Š -> å¾©åŸ -> æª¢è¨ã€‚",
                        example: "å°±åƒå®¶è£¡å¤±ç«ï¼ˆå¤–æ´©ï¼‰ï¼Œä½ è¦å…ˆæ‰“119ï¼ˆé€šå ±ï¼‰ã€æ‹¿æ»…ç«å™¨ï¼ˆè£œæ•‘ï¼‰ï¼Œè€Œä¸æ˜¯å…ˆå»ç½µè“‹æˆ¿å­çš„å·¥äººï¼ˆæŸ¥æ ¸é©ä»»æ€§ï¼‰ã€‚"
                    },
                    step4: [
                        { opt: "(A) æŸ¥æ ¸ç¶²è·¯å·¥ç¨‹å¸«", desc: "å°è±¡éŒ¯èª¤ï¼ˆæ˜¯é–‹ç™¼å·¥ç¨‹å¸«é—–ç¦ï¼‰ï¼Œä¸”ç·©ä¸æ¿Ÿæ€¥ã€‚ç•¶ä¸‹é¦–è¦ä»»å‹™æ˜¯æ­¢è¡€ã€‚" },
                        { opt: "(B) Bé€šå ±Aèˆ‡ç”²", desc: "ã€æ­£ç¢ºã€‘ç¬¦åˆé€šå ±è²¬ä»»éˆï¼Œç”²å—æ³•è¦ç›£ç®¡å¿…é ˆçŸ¥æƒ…ã€‚", status: "correct" },
                        { opt: "(C) Bæ¡è¡Œè£œæ•‘", desc: "ã€æ­£ç¢ºã€‘è‚‡äº‹è€…å¿…é ˆç«‹åˆ»æ–·ç¶²ã€æ¸…é™¤æƒ¡æ„ç¨‹å¼ï¼ˆIncident Containmentï¼‰ã€‚", status: "correct" },
                        { opt: "(D) è§£ç´„ä¸¦éŠ·æ¯€è³‡æ–™", desc: "ã€æ­£ç¢ºã€‘è§£ç´„æ™‚æœ€é‡è¦çš„å°±æ˜¯ã€Œè³‡æ–™ä¸æ®˜ç•™ã€ï¼Œé¿å…äºŒæ¬¡å¤–æ´©ã€‚", status: "correct" }
                    ],
                    step5: {
                        law: "è³‡é€šå®‰å…¨äº‹ä»¶é€šå ±åŠæ‡‰è®Šè¾¦æ³•",
                        desc: "éš±åŒ¿æœªå ±æ˜¯è³‡å®‰æ³•å¤§å¿Œã€‚è§£ç´„å¾Œçš„è³‡æ–™éŠ·æ¯€æ˜¯ç¶­è­·æ©Ÿå¯†æ€§ (Confidentiality) çš„æœ€å¾Œé˜²ç·šã€‚"
                    },
                    step6: "å…ˆé€šå ±ã€å†æ­¢è¡€ã€æœ€å¾Œå–„å¾Œï¼›è³‡æ–™è¦æ”¶å›ã€‚",
                    step7: {
                        blind: "è¦ºå¾—ã€Œè™•ç½°äºº/æ‰¾æˆ°çŠ¯ã€æœ€é‡è¦ã€‚",
                        guide: "åœ¨è³‡å®‰æ‡‰è®Š (IR) ä¸­ï¼Œã€Œæ­¢æï¼ˆé€šå ±+è£œæ•‘ï¼‰ã€æ°¸é å„ªæ–¼ã€Œè¿½è²¬ã€ã€‚ç«æ»…äº†å†ä¾†æª¢è¨äººã€‚"
                    },
                    selfCheck: [
                        { q: "è‹¥ B å·²ç¶“è‡ªè¡ŒæŠŠæ¯’æ®ºæ‰äº†ï¼Œä¸é€šçŸ¥ç”²å¯ä»¥å—ï¼Ÿ", a: "ä¸è¡Œã€‚é•åé€šå ±ç¾©å‹™ï¼Œä¸”ç”²ç„¡æ³•è©•ä¼°æ˜¯å¦æœ‰è³‡æ–™å¤–æµçš„å¾ŒçºŒé¢¨éšªã€‚" },
                        { q: "éŠ·æ¯€è³‡æ–™æ˜¯ç‚ºäº†ä¿è­·å“ªä¸€ç¨®è³‡å®‰å±¬æ€§ï¼Ÿ", a: "æ©Ÿå¯†æ€§ (Confidentiality)ã€‚" }
                    ]
                }
            }
        ]
    };

    // ç‹€æ…‹ç®¡ç†
    let userState = {
        completed: new Set(),
        currentTab: 0
    };

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
        initQuiz();
    });

    function initQuiz() {
        const tabsContainer = document.getElementById('tabs-container');
        const questionsContainer = document.getElementById('questions-container');

        quizData.questions.forEach((q, index) => {
            // 1. å»ºç«‹ Tab
            const tabBtn = document.createElement('button');
            tabBtn.className = `tab-btn ${index === 0 ? 'active' : ''}`;
            // ä¿®æ­£ï¼šé¡¯ç¤º originalId (5-8)
            tabBtn.innerHTML = `<span>ç¬¬ ${q.originalId} é¡Œ</span>`;
            tabBtn.onclick = () => switchTab(index);
            tabBtn.id = `tab-${index}`;
            tabsContainer.appendChild(tabBtn);

            // 2. å»ºç«‹é¡Œç›®å¡ç‰‡
            const card = document.createElement('div');
            card.className = `question-card ${index === 0 ? 'active' : ''}`;
            card.id = `q-card-${index}`;

            // éš¨æ©Ÿæ’åˆ—é¸é …
            const shuffledOptions = shuffleArray([...q.options]);
            
            // é—œéµå­—æ¨™ç´…è™•ç†
            const processedText = highlightKeywords(q.text);

            // æ¨™ç±¤ HTML
            const tagsHtml = q.tags.map(t => {
                let className = '';
                if(t.includes('æ³•')) className='tag-law';
                else if(t.includes('ISO') || t.includes('æ¨™æº–')) className='tag-iso';
                else if(t.includes('ç®¡') || t.includes('å ±å‘Š')) className='tag-mgm';
                else if(t.includes('æ¸¬') || t.includes('è¡“')) className='tag-sec';
                else className='tag-net';
                return `<span class="tag ${className}">${t}</span>`;
            }).join('');

            // é¸é … HTML
            const inputType = q.type === 'multi' ? 'checkbox' : 'radio';
            const optionsHtml = shuffledOptions.map((opt, i) => `
                <label class="option-label" data-val="${opt}">
                    <input type="${inputType}" name="q${index}" class="option-input" value="${opt}">
                    <span class="checkmark"></span>
                    <span>${opt}</span>
                </label>
            `).join('');

            // 3. æ§‹å»º 8 æ­¥é©Ÿè§£æ HTML
            const analysisHtml = buildAnalysisHtml(q.analysis);

            card.innerHTML = `
                <div class="q-meta">
                    <!-- ä¿®æ­£ï¼šé¡¯ç¤º originalId (5-8) -->
                    <span class="tag" style="background:#555">#${q.originalId}</span>
                    ${tagsHtml}
                    ${q.type === 'multi' ? '<span class="tag" style="background:#e67e22">è¤‡é¸é¡Œ</span>' : ''}
                </div>
                <div class="q-text">${processedText}</div>
                <div class="options-grid" id="options-${index}">
                    ${optionsHtml}
                </div>
                
                <div class="action-area">
                    <button class="btn btn-submit" onclick="submitAnswer(${index})">é€å‡ºç­”æ¡ˆ</button>
                    <button class="btn btn-reset" onclick="resetQuestion(${index})">é‡æ–°ä½œç­”</button>
                </div>

                <div class="explanation" id="explain-${index}">
                    ${analysisHtml}
                </div>
            `;
            questionsContainer.appendChild(card);
        });
    }

    // æ§‹å»ºè©³ç´°è§£æ HTML
    function buildAnalysisHtml(a) {
        // Step 1: Keywords
        const step1Html = a.step1.map(k => `<span class="kw-tag">${k}</span>`).join(' ');
        
        // Step 3: Thinking
        const step3Steps = a.step3.steps.map(s => `<li>${s}</li>`).join('');

        // Step 4: Options
        const step4Html = a.step4.map(o => `
            <li style="${o.status === 'correct' ? 'color:#2e7d32; font-weight:bold;' : 'color:#546e7a;'}">
                ${o.opt}ï¼š${o.desc}
            </li>
        `).join('');

        // Step 8: Self Check
        const step8Html = a.selfCheck.map((item, idx) => `
            <div class="self-check-item">
                <div class="self-check-q">Q${idx+1}: ${item.q}</div>
                <button class="self-check-btn" onclick="toggleAns(this)">é¡¯ç¤ºè§£ç­”</button>
                <div class="self-check-ans">${item.a}</div>
            </div>
        `).join('');

        return `
            <div class="step-block step-1">
                <div class="step-header">ã€ç¬¬ä¸€æ­¥ï¼šæ‰¾é—œéµå­—ã€‘</div>
                <div class="step-content">${step1Html}</div>
            </div>

            <div class="step-block step-2">
                <div class="step-header">ã€ç¬¬äºŒæ­¥ï¼šç™½è©±ç¿»è­¯ã€‘</div>
                <div class="step-content">${a.step2}</div>
            </div>

            <div class="step-block step-3">
                <div class="step-header">ã€ç¬¬ä¸‰æ­¥ï¼šè§£é¡Œæ€è·¯ã€‘</div>
                <div class="step-content">
                    <strong>è§£é¡Œæ­¥é©Ÿï¼š</strong>
                    <ol>${step3Steps}</ol>
                    <p><strong>åŸç†èˆ‡è¦å‰‡ï¼š</strong><br>${a.step3.principle}</p>
                    <p><strong>ç”Ÿæ´»ä¾‹å­ï¼š</strong><br>${a.step3.example}</p>
                </div>
            </div>

            <div class="step-block step-4">
                <div class="step-header">ã€ç¬¬å››æ­¥ï¼šé¸é …åˆ†æã€‘</div>
                <div class="step-content">
                    <ul style="list-style:none; padding-left:0;">${step4Html}</ul>
                </div>
            </div>

            <div class="step-block step-5">
                <div class="step-header">ã€è§€å¿µè£œå……èˆ‡å»¶ä¼¸ã€‘</div>
                <div class="step-content">
                    <p><strong>æ³•æ¢æˆ–å®šç¾©ï¼š</strong>${a.step5.law}</p>
                    <p><strong>è§¸é¡æ—é€šï¼š</strong>${a.step5.desc}</p>
                </div>
            </div>

            <div class="step-block step-6">
                <div class="step-header">ã€è¨˜æ†¶å£è¨£ã€‘</div>
                <div class="step-content" style="font-size:1.1em; font-weight:bold; color:#f57f17; text-align:center;">
                    "${a.step6}"
                </div>
            </div>

            <div class="step-block step-7">
                <div class="step-header">ã€å¸¸è¦‹é™·é˜±ã€‘</div>
                <div class="step-content">
                    <p><strong>å¿ƒç†ç›²é»ï¼š</strong>${a.step7.blind}</p>
                    <p><strong>é¿å‘æŒ‡å—ï¼š</strong>${a.step7.guide}</p>
                </div>
            </div>

            <div class="step-block step-8">
                <div class="step-header">ã€è‡ªæˆ‘æª¢æ¸¬ã€‘</div>
                <div class="step-content">
                    ${step8Html}
                </div>
            </div>
        `;
    }

    // æ´—ç‰Œæ¼”ç®—æ³• (Fisher-Yates)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // é—œéµå­—æ¨™ç´…
    function highlightKeywords(text) {
        const negativeWords = ["ä¸", "é", "éŒ¯èª¤", "æœªé”", "ç„¡é ˆ", "ä¸æ˜¯", "æœ€ä¸"];
        let newText = text;
        negativeWords.forEach(word => {
            if (text.includes(`ã€Œ${word}ã€`) || text.includes(word)) {
                 newText = newText.replace(new RegExp(`ã€Œ${word}ã€`, 'g'), `<span class="highlight-negative">ã€Œ${word}ã€</span>`);
                 if (!newText.includes('span')) {
                     newText = newText.replace(new RegExp(`æœ€${word}`, 'g'), `<span class="highlight-negative">æœ€${word}</span>`);
                 }
            }
        });
        return newText;
    }

    // åˆ‡æ› Tab
    function switchTab(index) {
        userState.currentTab = index;
        document.querySelectorAll('.tab-btn').forEach((btn, i) => {
            btn.classList.toggle('active', i === index);
        });
        document.querySelectorAll('.question-card').forEach((card, i) => {
            card.classList.toggle('active', i === index);
        });
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // é€å‡ºç­”æ¡ˆåˆ¤å®š
    function submitAnswer(index) {
        const question = quizData.questions[index];
        const container = document.getElementById(`q-card-${index}`);
        const inputs = container.querySelectorAll('input:checked');
        const submitBtn = container.querySelector('.btn-submit');
        const resetBtn = container.querySelector('.btn-reset');
        const explanation = document.getElementById(`explain-${index}`);
        const tab = document.getElementById(`tab-${index}`);
        const allLabels = container.querySelectorAll('.option-label');

        if (inputs.length === 0) {
            alert("è«‹å…ˆé¸æ“‡ä¸€å€‹é¸é …ï¼");
            return;
        }

        const userAnswers = Array.from(inputs).map(input => input.value);
        const isCorrect = arrayEquals(userAnswers.sort(), question.correct.sort());

        allLabels.forEach(label => {
            label.classList.add('disabled');
            const val = label.getAttribute('data-val');
            if (question.correct.includes(val)) label.classList.add('correct-answer');
            if (userAnswers.includes(val) && !question.correct.includes(val)) label.classList.add('wrong-answer');
        });

        explanation.style.display = 'block';
        submitBtn.style.display = 'none';
        resetBtn.style.display = 'block';

        tab.classList.remove('correct', 'wrong');
        tab.classList.add(isCorrect ? 'correct' : 'wrong');
        const icon = isCorrect ? 'âœ“' : 'âœ—';
        if (!tab.innerHTML.includes('icon')) {
             tab.innerHTML += ` <span class="icon">${icon}</span>`;
        } else {
            tab.querySelector('.icon').innerText = icon;
        }

        userState.completed.add(index);
        updateProgress();
        explanation.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // é™£åˆ—æ¯”å°
    function arrayEquals(a, b) {
        return Array.isArray(a) && Array.isArray(b) && a.length === b.length && a.every((val, index) => val === b[index]);
    }

    // é‡ç½®é¡Œç›®
    function resetQuestion(index) {
        const container = document.getElementById(`q-card-${index}`);
        const inputs = container.querySelectorAll('input');
        const labels = container.querySelectorAll('.option-label');
        const submitBtn = container.querySelector('.btn-submit');
        const resetBtn = container.querySelector('.btn-reset');
        const explanation = document.getElementById(`explain-${index}`);
        const tab = document.getElementById(`tab-${index}`);

        inputs.forEach(input => input.checked = false);
        labels.forEach(label => label.classList.remove('disabled', 'correct-answer', 'wrong-answer'));

        explanation.style.display = 'none';
        submitBtn.style.display = 'block';
        resetBtn.style.display = 'none';

        // éš±è—æ‰€æœ‰è‡ªæˆ‘æª¢æ¸¬ç­”æ¡ˆ
        container.querySelectorAll('.self-check-ans').forEach(el => el.style.display = 'none');
        container.querySelectorAll('.self-check-btn').forEach(btn => btn.innerText = 'é¡¯ç¤ºè§£ç­”');

        tab.classList.remove('correct', 'wrong');
        const icon = tab.querySelector('.icon');
        if (icon) icon.remove();

        userState.completed.delete(index);
        updateProgress();
        window.scrollTo({ top: container.offsetTop - 100, behavior: 'smooth' });
    }

    // è‡ªæˆ‘æª¢æ¸¬é–‹é—œ
    function toggleAns(btn) {
        const ansDiv = btn.nextElementSibling;
        if (ansDiv.style.display === 'block') {
            ansDiv.style.display = 'none';
            btn.innerText = 'é¡¯ç¤ºè§£ç­”';
        } else {
            ansDiv.style.display = 'block';
            btn.innerText = 'éš±è—è§£ç­”';
        }
    }

    function updateProgress() {
        const total = quizData.questions.length;
        const current = userState.completed.size;
        const percentage = (current / total) * 100;
        document.getElementById('progress-bar').style.width = `${percentage}%`;
        document.getElementById('progress-text').innerText = `${current}/${total}`;
    }
</script>

</body>
</html>