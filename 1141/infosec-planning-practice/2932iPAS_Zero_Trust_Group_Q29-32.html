<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPAS è³‡å®‰é¡Œçµ„ï¼šé›¶ä¿¡ä»»æ¶æ§‹å¯¦å‹™ (Q29-32)</title>
    <style>
        :root {
            /* ç³»çµ±è‰²ç¥¨ */
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #333333;
            --border-radius: 16px;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
            
            /* ç‹€æ…‹è‰² */
            --success-bg: #e8f5e9;
            --success-text: #27ae60;
            --error-bg: #fce4ec;
            --error-text: #c0392b;
            --neutral-gray: #95a5a6;

            /* æ¨™ç±¤è‰²ç¥¨ */
            --tag-law: #607d8b;
            --tag-iso: #27ae60;
            --tag-zt: #8e44ad;
            --tag-net: #2980b9;
            --tag-sec: #c0392b;
            --tag-mgm: #d35400;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: system-ui, "Noto Sans TC", "Microsoft JhengHei", sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            font-size: 16px;
            padding-bottom: 50px;
        }

        /* --- å®¹å™¨èˆ‡ä½ˆå±€ --- */
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .container {
                width: 100%;
                padding: 10px;
            }
        }

        /* --- Header & é€²åº¦æ¢ --- */
        header {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        h1 {
            font-size: 1.5rem;
            color: var(--primary-color);
            font-weight: 700;
        }

        .progress-container {
            width: 100%;
            height: 8px;
            background-color: #eee;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--success-text);
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-text {
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--accent-color);
        }

        /* --- é¡Œçµ„æƒ…å¢ƒå€å¡Š --- */
        .scenario-card {
            background-color: #e3f2fd; /* æ·¡è—è‰²åº• */
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 25px;
            border-left: 6px solid var(--accent-color);
            box-shadow: var(--shadow);
        }

        .scenario-title {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .scenario-content {
            font-size: 1rem;
            color: #444;
        }

        .scenario-image {
            width: 100%;
            max-width: 600px;
            height: auto;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid rgba(0,0,0,0.1);
            display: block;
        }

        .image-source {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
            display: block;
            text-align: right;
        }
        
        .image-source a {
            color: var(--accent-color);
            text-decoration: none;
        }

        /* --- Tabs åˆ†é  --- */
        .tabs-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 5px;
            -webkit-overflow-scrolling: touch; /* iOS smooth scroll */
        }

        .tab-btn {
            flex: 1;
            min-width: 80px;
            height: 48px; /* è§¸æ§å‹å–„ */
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            color: #777;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .tab-btn.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }

        .tab-btn.correct {
            border-color: var(--success-text);
            color: var(--success-text);
            background-color: #fff;
        }

        .tab-btn.active.correct {
            background-color: var(--success-text);
            color: white;
        }

        .tab-btn.wrong {
            border-color: var(--error-text);
            color: var(--error-text);
            background-color: #fff;
        }

        .tab-btn.active.wrong {
            background-color: var(--error-text);
            color: white;
        }

        /* --- é¡Œç›®å¡ç‰‡å€åŸŸ --- */
        .question-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 30px;
            display: none; /* é è¨­éš±è—ï¼Œç”± JS æ§åˆ¶é¡¯ç¤º */
            animation: fadeIn 0.4s ease;
        }

        .question-card.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .q-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .q-badge {
            background-color: var(--primary-color);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .tag-zt { background-color: var(--tag-zt); }
        .tag-law { background-color: var(--tag-law); }
        .tag-net { background-color: var(--tag-net); }
        .tag-mgm { background-color: var(--tag-mgm); }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 25px;
            color: #222;
        }

        /* é—œéµå­—å¼·èª¿ - ç´…è‰²åŠ ç²— */
        .highlight-negative {
            color: #e74c3c;
            font-weight: 800;
            border-bottom: 2px solid rgba(231, 76, 60, 0.3);
            padding-bottom: 1px;
        }

        /* --- é¸é …å€åŸŸ --- */
        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            min-height: 56px; /* è§¸æ§å‹å–„ */
        }

        .option-item:hover {
            background-color: #f8f9fa;
            border-color: #bdc3c7;
        }

        .option-item.selected {
            border-color: var(--accent-color);
            background-color: #eef7fd;
        }

        /* ä½œç­”å¾Œçš„ç‹€æ…‹ */
        .option-item.correct-answer {
            border-color: var(--success-text);
            background-color: var(--success-bg);
            color: #1b5e20;
        }

        .option-item.wrong-choice {
            border-color: var(--error-text);
            background-color: var(--error-bg);
            color: #b71c1c;
            opacity: 0.8;
        }

        .option-item.disabled {
            pointer-events: none;
            opacity: 0.9;
        }

        .option-marker {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #eee;
            color: #555;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
            font-weight: bold;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .option-item.selected .option-marker {
            background: var(--accent-color);
            color: white;
        }

        /* --- æ“ä½œæŒ‰éˆ•å€ --- */
        .action-area {
            margin-top: 30px;
            display: flex;
            justify-content: center;
        }

        .btn {
            border: none;
            border-radius: 8px;
            padding: 12px 40px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s, background 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            min-height: 48px;
        }

        .btn:active {
            transform: scale(0.96);
        }

        .btn-submit {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-retry {
            background-color: var(--accent-color);
            color: white;
            display: none; /* åˆå§‹éš±è— */
        }

        .btn-retry:hover { background-color: #2980b9; }

        /* --- è©³ç´°è§£æå€å¡Šæ¨£å¼ (æ–°ç‰ˆ) --- */
        .explanation-section {
            margin-top: 40px;
            display: none; /* åˆå§‹éš±è— */
            animation: fadeIn 0.5s ease;
        }

        .exp-header-text {
            text-align: center;
            color: var(--primary-color);
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 20px;
            position: relative;
        }
        
        .exp-header-text::after {
            content: '';
            display: block;
            width: 50px;
            height: 3px;
            background: var(--accent-color);
            margin: 8px auto 0;
        }

        .exp-block {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid var(--accent-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }

        .exp-block h4 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.05rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .exp-block h4 .icon {
            font-size: 1.2rem;
        }

        .exp-content {
            color: #555;
            font-size: 0.95rem;
            line-height: 1.7;
        }

        .highlight-keyword {
            background-color: #fff3cd;
            padding: 2px 5px;
            border-radius: 4px;
            font-weight: bold;
            color: #856404;
        }

        /* é¸é …åˆ†æè¡¨æ ¼ */
        .analysis-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .analysis-table th {
            background: #f8f9fa;
            padding: 10px;
            text-align: left;
            border-bottom: 2px solid #dee2e6;
        }
        
        .analysis-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            vertical-align: top;
        }

        /* è¨˜æ†¶å£è¨£ç‰¹åˆ¥æ¨£å¼ */
        .mnemonic-box {
            background: linear-gradient(135deg, #fff9c4 0%, #fff 100%);
            border-left-color: #fbc02d;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
            color: #f57f17;
            padding: 25px;
        }

        /* é™·é˜±å€å¡Š */
        .trap-box {
            border-left-color: var(--error-text);
            background-color: #fffafa;
        }

        /* è‡ªæˆ‘æª¢æ¸¬æ¨£å¼ */
        .self-check-item {
            margin-bottom: 15px;
            border-bottom: 1px dashed #eee;
            padding-bottom: 10px;
        }

        .self-check-q {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
            display: flex;
            gap: 8px;
        }

        .self-check-a-container {
            margin-top: 5px;
        }

        .toggle-answer-btn {
            background: #eee;
            border: none;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            color: #666;
        }
        
        .toggle-answer-btn:hover {
            background: #e0e0e0;
        }

        .self-check-answer {
            display: none;
            margin-top: 8px;
            color: var(--success-text);
            background: var(--success-bg);
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9rem;
        }

    </style>
</head>
<body>

<div class="container">
    <!-- é é¦–èˆ‡é€²åº¦ -->
    <header>
        <div class="header-top">
            <h1>iPAS è³‡å®‰ã€é¡Œçµ„é¡Œã€‘å…¨èƒ½ç·´ç¿’</h1>
            <div class="progress-text">å®Œæˆé€²åº¦ï¼š<span id="completed-count">0</span> / <span id="total-count">4</span></div>
        </div>
        <div class="progress-container">
            <div class="progress-bar" id="global-progress"></div>
        </div>
    </header>

    <!-- é¡Œçµ„å…±ç”¨æƒ…å¢ƒ -->
    <div class="scenario-card">
        <div class="scenario-title">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
            é¡Œçµ„æƒ…å¢ƒï¼ˆç¬¬ 29-32 é¡Œå…±ç”¨ï¼‰
        </div>
        <div class="scenario-content" id="scenario-text">
            <!-- JS è¼‰å…¥ -->
        </div>
        <!-- åœ–ç‰‡æ’å…¥ä½ç½® -->
        <img src="https://i.meee.com.tw/yd6Nn85.png" alt="é›¶ä¿¡ä»»æ¶æ§‹ç¤ºæ„åœ–" class="scenario-image">
        <span class="image-source">åœ–ç‰‡ä¾†æºï¼š<a href="https://www.goupsec.com/guide/12461.html" target="_blank">goupsec.com</a></span>
    </div>

    <!-- åˆ‡æ› Tabs -->
    <div class="tabs-container" id="tabs-container">
        <!-- JS å‹•æ…‹ç”Ÿæˆ -->
    </div>

    <!-- é¡Œç›®å€åŸŸ -->
    <div id="questions-container">
        <!-- JS å‹•æ…‹ç”Ÿæˆæ¯é¡Œçš„ Card -->
    </div>

</div>

<script>
    // --- é¡Œç›®è³‡æ–™ ---
    const quizData = {
        groupTitle: "é¡Œçµ„ï¼šé›¶ä¿¡ä»»æ¶æ§‹å¯¦å‹™èˆ‡åŸå‰‡",
        groupScenario: "2020 å¹´ç¾åœ‹åœ‹å®¶æ¨™æº–æŠ€è¡“ç ”ç©¶é™¢ï¼ˆNISTï¼šç¾åœ‹åˆ¶å®šè³‡å®‰èˆ‡ç§‘æŠ€æ¨™æº–çš„é‡è¦æ©Ÿæ§‹ï¼‰æ­£å¼ç™¼å¸ƒæ¨™æº–æ–‡ä»¶ SP 800-207ï¼šé›¶ä¿¡ä»»æ¶æ§‹ï¼ˆZero Trust Architectureï¼ŒZTAï¼‰ã€‚é›¶ä¿¡ä»»å·²å¾æ¦‚å¿µé€æ¼¸é€²éšè‡³å¯¦å‹™éƒ¨ç½²è¦åŠƒã€‚<br><br>æŸä¼æ¥­ä¹‹è³‡å®‰ç®¡ç†äººå“¡ï¼Œå› æ‡‰ä¾›æ‡‰éˆä¸Šä¸‹æ¸¸è¦æ±‚ï¼ŒåŒ…å«é ç«¯ä½¿ç”¨ä¾›æ‡‰éˆç®¡ç†ç³»çµ±ã€è³‡æ–™å­˜å–ã€è¨­å‚™è¾¨è­˜èˆ‡æ¬Šé™æ§ç®¡ç­‰éœ€æ±‚ï¼Œä¾å¾ª NIST SP 800-207 é€²è¡Œè¦åŠƒï¼Œä»¥ä¸‹ç‚ºè¦åŠƒé›¶ä¿¡ä»»æ¶æ§‹æ™‚æ‰€é‡åˆ°çš„å•é¡Œã€‚",
        questions: [
            {
                id: 29,
                tag: "tag-zt",
                tagName: "é›¶ä¿¡ä»»æ¶æ§‹",
                type: "single", // å–®é¸
                text: "é—œæ–¼è¦åŠƒé›¶ä¿¡ä»»è³‡å®‰æ¶æ§‹çš„æ•˜è¿°ï¼Œä¸‹åˆ—ä½•è€…ã€Œæœ‰èª¤ã€ï¼Ÿ",
                options: [
                    "ç™½åå–®ä¹‹éæ³•é ç«¯é€£ç·šï¼ˆRDPï¼‰æ˜¯é›¶ä¿¡ä»»åœ¨ç¶²è·¯å±¤çš„æ§åˆ¶é …ç›®ä¹‹ä¸€",
                    "åªè¦è¨­å®šç™½åå–®å°±å¯ä»¥ã€Œå®Œå…¨ç¬¦åˆã€é›¶ä¿¡ä»»ä¹‹éœ€æ±‚", // æ­£è§£
                    "è³‡å®‰å¾®éš”é›¢ï¼ˆMicro-Segmentationï¼‰æ˜¯é›¶ä¿¡ä»»åœ¨ç¶²è·¯å±¤çš„æ§åˆ¶é …ç›®ä¹‹ä¸€",
                    "è³‡æ–™å­˜å–çš„é›¶ä¿¡ä»»å¯ä»¥é€éé˜²æ²»è³‡æ–™å¤–æ´©ï¼ˆDLPï¼‰æ–¹æ¡ˆè½å¯¦"
                ],
                correctIndices: [1], 
                analysis: {
                    step1_keywords: ["é›¶ä¿¡ä»»è³‡å®‰æ¶æ§‹", "æœ‰èª¤", "ç™½åå–®", "å®Œå…¨ç¬¦åˆ"],
                    step2_translate: "é›¶ä¿¡ä»»æ˜¯å¾ˆé¾œæ¯›ä¸”å…¨é¢çš„æª¢æŸ¥ç³»çµ±ã€‚é¡Œç›®å•å“ªå€‹èªªæ³•ã€Œå¤ªå¤©çœŸã€äº†ï¼Œå°¤å…¶æ˜¯é‚£ç¨®èªªã€Œåšäº†ä¸€ä»¶äº‹å°±å¤©ä¸‹ç„¡æ•µã€çš„ã€‚",
                    step3_logic: {
                        steps: "1. æª¢æŸ¥é¸é …æ˜¯å¦ç¬¦åˆã€Œé›¶ä¿¡ä»»=å¤šå±¤é˜²è­·ã€åŸå‰‡ã€‚<br>2. æ‰¾å‡ºä½¿ç”¨ã€Œçµ•å°æ€§è©å½™ã€ï¼ˆå¦‚ï¼šåªè¦...å°±...ï¼‰çš„é¸é …ã€‚",
                        principle: "é›¶ä¿¡ä»»å¼·èª¿ã€Œæ°¸ä¸ä¿¡ä»»ï¼ŒæŒçºŒé©—è­‰ã€ã€‚éœ€æ¶µè“‹èº«åˆ†ã€è¨­å‚™ã€ç¶²è·¯ã€æ‡‰ç”¨ã€è³‡æ–™äº”å¤§æ”¯æŸ±ï¼Œå–®ä¸€æŠ€è¡“ç„¡æ³•é”æˆã€‚",
                        example: "ç”Ÿæ´»ä¾‹å­ï¼šæ©Ÿå ´å®‰æª¢ä¸æœƒå› ç‚ºä½ é€™å¼µè‡‰æ˜¯ç†Ÿé¢å­”ï¼ˆç™½åå–®ï¼‰å°±è®“ä½ ç›´æ¥ä¸Šé£›æ©Ÿï¼Œé‚„æ˜¯è¦é X å…‰æ©Ÿã€æŸ¥é©—è­·ç…§ï¼ˆæŒçºŒé©—è­‰ï¼‰ã€‚"
                    },
                    step4_options: [
                        { label: "(A)", valid: "æ­£ç¢º", content: "é™åˆ¶ RDP é ç«¯é€£ç·šåªå…è¨±ç‰¹å®šä¾†æºï¼ˆç™½åå–®ï¼‰ï¼Œç¢ºå¯¦æ˜¯ã€Œç¶²è·¯å±¤ã€çš„æ§åˆ¶æ‰‹æ®µä¹‹ä¸€ã€‚" },
                        { label: "(B)", valid: "æœ‰èª¤", content: "éŒ¯åœ¨ã€Œå®Œå…¨ç¬¦åˆã€ã€‚ç™½åå–®åªèƒ½é˜²ç¯„æœªçŸ¥ä¾†æºï¼Œä½†ç„¡æ³•é˜²ç¯„ã€Œåˆæ³•å¸³è™Ÿè¢«ç›œç”¨ã€æˆ–ã€Œå…§éƒ¨å¨è„…ã€ã€‚" },
                        { label: "(C)", valid: "æ­£ç¢º", content: "å¾®éš”é›¢ï¼ˆæŠŠç¶²è·¯åˆ‡å¾ˆç´°ï¼‰æ˜¯é›¶ä¿¡ä»»é˜²æ­¢é§­å®¢åœ¨å…§ç¶²äº‚ç«„çš„æ¨™æº–åšæ³•ã€‚" },
                        { label: "(D)", valid: "æ­£ç¢º", content: "DLPï¼ˆé˜²æ­¢è³‡æ–™å¤–æ´©ï¼‰æ˜¯ä¿è­·ã€Œè³‡æ–™å±¤ã€çš„é‡è¦å·¥å…·ã€‚" }
                    ],
                    supplement: {
                        definition: "<strong>NIST SP 800-207ï¼š</strong> å®šç¾©äº†é›¶ä¿¡ä»»çš„æ¨™æº–ï¼Œå¼·èª¿ã€Œä»¥è³‡æ–™ç‚ºä¸­å¿ƒã€çš„é˜²è­·ã€‚",
                        analogy: "<strong>è§¸é¡æ—é€šï¼š</strong> å°±åƒç¾åœ¨çš„é˜²ç–«ï¼Œä¸æ˜¯åªæœ‰æˆ´å£ç½©ï¼ˆå–®ä¸€æªæ–½ï¼‰ï¼Œé‚„è¦æ´—æ‰‹ã€æ‰“ç–«è‹—ã€ä¿æŒè·é›¢ï¼ˆå¤šå±¤é˜²è­·ï¼‰ã€‚"
                    },
                    mnemonic: "é›¶ä¿¡ä»»ä¸æ˜¯ä¸€æŠŠé–ï¼ˆç™½åå–®ï¼‰ï¼Œè€Œæ˜¯ä¸€æ•´å¥—æ™ºæ…§é–€ç¦ç³»çµ±ã€‚",
                    trap: {
                        blindSpot: "çœ‹åˆ°ã€Œç™½åå–®ã€è¦ºå¾—æ˜¯å¾ˆå¼·çš„è³‡å®‰æ‰‹æ®µï¼Œå°±èª¤ä»¥ç‚ºå®ƒèƒ½è§£æ±ºæ‰€æœ‰å•é¡Œã€‚",
                        guide: "çœ‹åˆ°ã€Œåªè¦...å°±...ã€ã€ã€Œå®Œå…¨ç¬¦åˆã€é€™ç¨®è©±ï¼Œ99% æ˜¯éŒ¯çš„ã€‚è³‡å®‰æ²’æœ‰éŠ€è‰²å­å½ˆï¼ˆè¬èƒ½è§£è—¥ï¼‰ã€‚"
                    },
                    selfCheck: [
                        { q: "ç‚ºä»€éº¼åªé– IP (ç™½åå–®) ä¸å¤ å®‰å…¨ï¼Ÿ", a: "å› ç‚ºé§­å®¢å¯èƒ½ç›œç”¨åˆæ³•å“¡å·¥çš„å¸³è™Ÿå¯†ç¢¼ï¼Œå¾åˆæ³•çš„ IP ç™»å…¥ï¼Œé€™æ™‚å€™ç™½åå–®å°±å¤±æ•ˆäº†ã€‚" },
                        { q: "å¾®éš”é›¢ (Micro-Segmentation) çš„ä½œç”¨æ˜¯ä»€éº¼ï¼Ÿ", a: "åƒæ˜¯èˆ¹è‰™çš„éš”æ°´é–€ï¼Œè¬ä¸€é€™å€è¢«é§­å®¢æ”»ç ´ï¼Œå°‡æå®³é™åˆ¶åœ¨å°å€åŸŸï¼Œä¸è®“ç½æƒ…æ“´æ•£ã€‚" }
                    ]
                }
            },
            {
                id: 30,
                tag: "tag-mgm",
                tagName: "è¨­è¨ˆåŸå‰‡",
                type: "single",
                text: "é‡å°é ç«¯ä½¿ç”¨ä¾›æ‡‰éˆç®¡ç†ç³»çµ±ã€è³‡æ–™å­˜å–ç­‰é …ç›®è¦åŠƒé›¶ä¿¡ä»»æ¶æ§‹ã€‚åœ¨è¨­è¨ˆè³‡å®‰æ¶æ§‹æ™‚ï¼Œã€Œä¸ã€åŒ…å«ä¸‹åˆ—ä½•é …åŸå‰‡ï¼Ÿ",
                options: [
                    "è³‡ç”¢æ¡è³¼", // æ­£è§£
                    "å…ƒä»¶é—œä¿‚",
                    "å·¥ä½œæµç¨‹è¦åŠƒ",
                    "å­˜å–æ”¿ç­–"
                ],
                correctIndices: [0],
                analysis: {
                    step1_keywords: ["è¨­è¨ˆè³‡å®‰æ¶æ§‹", "ä¸åŒ…å«", "åŸå‰‡", "è³‡ç”¢æ¡è³¼"],
                    step2_translate: "è€é—†å«ä½ ç•«ä¸€å¼µå¤§æ¨“çš„ã€Œè¨­è¨ˆåœ–ã€ï¼Œä½ åœ¨æƒ³éš”é–“æ€éº¼ç•«çš„æ™‚å€™ï¼Œé€™å«è¨­è¨ˆã€‚ä½†å¦‚æœä½ åœ¨æƒ³ã€Œè¦å»å“ªå®¶åº—è²·ç£šé ­ã€ï¼Œé€™å«æ¡è³¼ã€‚",
                    step3_logic: {
                        steps: "1. å€åˆ†ã€Œé‚è¼¯è¦åŠƒï¼ˆå‹•è…¦ï¼‰ã€èˆ‡ã€Œè¡Œæ”¿åŸ·è¡Œï¼ˆå‹•æ‰‹/èŠ±éŒ¢ï¼‰ã€ã€‚<br>2. æ‰¾å‡ºå±¬æ–¼å•†æ¥­è²·è³£è¡Œç‚ºçš„é¸é …ã€‚",
                        principle: "æ¶æ§‹è¨­è¨ˆéšæ®µé—œæ³¨çš„æ˜¯ï¼šå…ƒä»¶å¦‚ä½•äº’å‹•ã€æµç¨‹å¦‚ä½•è·‘ã€è¦å‰‡ï¼ˆPolicyï¼‰æ€éº¼è¨‚ã€‚",
                        example: "ç”Ÿæ´»ä¾‹å­ï¼šä½ è¦è¦åŠƒä¸€å ´æ—…éŠï¼ˆæ¶æ§‹è¨­è¨ˆï¼‰ï¼Œé‡é»æ˜¯è·¯ç·šã€æ™¯é»ã€ä½å®¿é»ï¼›è‡³æ–¼ã€Œåˆ·å¡è²·æ©Ÿç¥¨ã€ï¼ˆæ¡è³¼ï¼‰æ˜¯ç¢ºå®šè¡Œç¨‹å¾Œçš„åŸ·è¡Œå‹•ä½œã€‚"
                    },
                    step4_options: [
                        { label: "(A)", valid: "ä¸åŒ…å«", content: "ã€Œè³‡ç”¢æ¡è³¼ã€æ˜¯å¾ŒçºŒçš„å•†æ¥­è¡Œæ”¿æµç¨‹ï¼Œä¸æ˜¯æ¶æ§‹æœ¬èº«çš„é‚è¼¯è¨­è¨ˆåŸå‰‡ã€‚" },
                        { label: "(B)", valid: "åŒ…å«", content: "è¨­è¨ˆæ™‚å¿…é ˆå®šç¾©å„å€‹ç³»çµ±å…ƒä»¶ï¼ˆå¦‚èº«åˆ†é©—è­‰å™¨ã€é–˜é“ï¼‰ä¹‹é–“çš„é—œä¿‚ã€‚" },
                        { label: "(C)", valid: "åŒ…å«", content: "è¦åŠƒè³‡æ–™æµå‘èˆ‡é©—è­‰çš„å·¥ä½œæµç¨‹æ˜¯è¨­è¨ˆçš„æ ¸å¿ƒã€‚" },
                        { label: "(D)", valid: "åŒ…å«", content: "åˆ¶å®šã€Œèª°å¯ä»¥å­˜å–ä»€éº¼ã€çš„æ”¿ç­–ï¼ˆPolicyï¼‰æ˜¯é›¶ä¿¡ä»»çš„éˆé­‚ã€‚" }
                    ],
                    supplement: {
                        definition: "<strong>è¨­è¨ˆåŸå‰‡ (Design Principles)ï¼š</strong> æŒ‡å°ç³»çµ±å»ºæ§‹çš„æ ¸å¿ƒæ€æƒ³ã€‚",
                        analogy: "<strong>è§¸é¡æ—é€šï¼š</strong> å°±åƒå¯«ç¨‹å¼ï¼Œã€Œæ¼”ç®—æ³•ã€æ˜¯è¨­è¨ˆï¼Œã€Œè²·é›»è…¦ã€æ˜¯æ¡è³¼ã€‚"
                    },
                    mnemonic: "é›¶ä¿¡ä»»å…ˆè¨­è¨ˆé‚è¼¯ï¼Œä¸æ˜¯å…ˆåˆ·å¡è²·å–®ã€‚",
                    trap: {
                        blindSpot: "çœ‹åˆ°ã€Œè³‡ç”¢ã€å…©å€‹å­—ï¼Œèª¤ä»¥ç‚ºæ˜¯é›¶ä¿¡ä»»å¼·èª¿çš„ã€Œè³‡ç”¢ç›¤é»ã€ï¼Œä½†é€™è£¡é…çš„æ˜¯ã€Œæ¡è³¼ã€ã€‚",
                        guide: "ä»”ç´°çœ‹å‹•è©ã€‚æ˜¯ã€Œè¦åŠƒ/å®šç¾©ã€é‚„æ˜¯ã€Œè³¼è²·ã€ï¼Ÿè³¼è²·å±¬æ–¼åŸ·è¡Œå±¤ã€‚"
                    },
                    selfCheck: [
                        { q: "ç‚ºä»€éº¼ä¸èƒ½å…ˆæ¡è³¼å†è¨­è¨ˆï¼Ÿ", a: "å› ç‚ºå¦‚æœæ²’å…ˆè¦åŠƒå¥½æ¶æ§‹ï¼Œè²·å›ä¾†çš„è¨­å‚™å¯èƒ½æ ¹æœ¬ç„¡æ³•æ•´åˆï¼Œæˆ–è€…ä¸ç¬¦åˆå®‰å…¨éœ€æ±‚ï¼Œæµªè²»éŒ¢ã€‚" }
                    ]
                }
            },
            {
                id: 31,
                tag: "tag-iso",
                tagName: "æˆç†Ÿåº¦æ¨¡å‹",
                type: "single",
                text: "CISA é›¶ä¿¡ä»»æˆç†Ÿæ¨¡å‹ï¼ˆZTMMï¼‰ï¼Œé—œæ–¼è¨­è¨ˆèˆ‡éƒ¨ç½²åŸå‰‡çš„æ•˜è¿°ï¼Œä¸‹åˆ—ä½•è€…æœ€æ­£ç¢ºï¼Ÿ",
                options: [
                    "å“¡å·¥è‡ªå¸¶è£ç½®ï¼ˆBYODï¼‰å¯ä»¥ä¸ç®—åœ¨é›¶ä¿¡ä»»æ¶æ§‹ä¸­",
                    "é›²ç«¯è³‡æ–™ä¾†æºèˆ‡é‹ç®—æœå‹™ï¼Œä¸ç´å…¥é›¶ä¿¡ä»»æ¶æ§‹",
                    "æ‰€æœ‰çš„è³‡æ–™ä¾†æºèˆ‡é‹ç®—æœå‹™ï¼Œéƒ½è¦è¢«ç•¶ä½œæ˜¯è³‡æº", // æ­£è§£
                    "åœ¨å…è¨±å­˜å–ä¹‹å‰ï¼Œèº«åˆ†é‘‘åˆ¥èˆ‡æˆæ¬Šæ©Ÿåˆ¶ä¸éœ€ç›£æ§çµæœå‹•æ…‹æ±ºå®š"
                ],
                correctIndices: [2],
                analysis: {
                    step1_keywords: ["CISA ZTMM", "è¨­è¨ˆèˆ‡éƒ¨ç½²", "æœ€æ­£ç¢º", "æ‰€æœ‰...è³‡æº"],
                    step2_translate: "é›¶ä¿¡ä»»å°±æ˜¯å€‹ã€Œè¶…ç´šæ§åˆ¶ç‹‚ã€ï¼Œä¸ç®¡æ˜¯å…¬å¸çš„é›»è…¦ã€é›²ç«¯ã€é‚„æ˜¯å“¡å·¥è‡ªå·±çš„æ‰‹æ©Ÿï¼Œåªè¦ç”¨åˆ°å…¬å¸çš„è³‡æ–™ï¼Œé€šé€šéƒ½è¦ç®¡ï¼",
                    step3_logic: {
                        steps: "1. æª¢æŸ¥é¸é …æ˜¯å¦æœ‰ã€Œæ’é™¤ã€æŸäº›é …ç›®ï¼ˆé€šå¸¸æ˜¯éŒ¯çš„ï¼‰ã€‚<br>2. æ‰¾å°‹ã€Œå…¨é¢ç´ç®¡ã€çš„æ•˜è¿°ã€‚",
                        principle: "é›¶ä¿¡ä»»æ ¸å¿ƒå‡è¨­ï¼šå…§å¤–ç¶²éƒ½ä¸å®‰å…¨ã€‚å› æ­¤æ‰€æœ‰æœƒæ¥è§¸è³‡æ–™çš„ç«¯é»èˆ‡æœå‹™ï¼Œå¿…é ˆå…¨éƒ¨è¦–ç‚ºè³‡æºç´å…¥ä¿è­·ã€‚",
                        example: "ç”Ÿæ´»ä¾‹å­ï¼šå°±åƒé˜²ç–«æœŸé–“ï¼Œä¸ç®¡æ˜¯æœ¬åœ‹äººï¼ˆå…§éƒ¨è¨­å‚™ï¼‰é‚„æ˜¯å¤–åœ‹äººï¼ˆå¤–éƒ¨é›²ç«¯/BYODï¼‰ï¼Œå…¥å¢ƒé€šé€šè¦éš”é›¢æª¢æŸ¥ï¼Œæ²’æœ‰ä¾‹å¤–ã€‚"
                    },
                    step4_options: [
                        { label: "(A)", valid: "éŒ¯èª¤", content: "BYODï¼ˆè‡ªå¸¶è¨­å‚™ï¼‰é¢¨éšªæ›´é«˜ï¼Œçµ•å°è¦ç´å…¥ç®¡ç†ã€‚" },
                        { label: "(B)", valid: "éŒ¯èª¤", content: "ç¾ä»£ä¼æ¥­å¤§é‡ä½¿ç”¨é›²ç«¯ï¼Œé›²ç«¯ç•¶ç„¶æ˜¯é›¶ä¿¡ä»»ä¿è­·çš„é‡é»ã€‚" },
                        { label: "(C)", valid: "æ­£ç¢º", content: "ç¬¦åˆé›¶ä¿¡ä»»ç²¾ç¥ï¼šè¬ç‰©çš†è³‡æºï¼Œç„¡ä¸€å¯ä¾‹å¤–ã€‚" },
                        { label: "(D)", valid: "éŒ¯èª¤", content: "é›¶ä¿¡ä»»å¼·èª¿ã€Œå‹•æ…‹æ±ºç­–ã€ï¼Œå¿…é ˆæŒçºŒç›£æ§ç•¶ä¸‹ç‹€æ…‹ï¼ˆå¦‚æœ‰ç„¡ä¸­æ¯’ï¼‰ä¾†æ±ºå®šæ˜¯å¦æ”¾è¡Œã€‚" }
                    ],
                    supplement: {
                        definition: "<strong>CISA ZTMMï¼š</strong> ç¾åœ‹æå‡ºçš„é›¶ä¿¡ä»»æˆç†Ÿåº¦æ¨¡å‹ï¼Œåˆ†ç‚ºå‚³çµ±ã€é€²éšã€æœ€ä½³åŒ–ä¸‰å€‹éšæ®µã€‚",
                        analogy: "<strong>è§¸é¡æ—é€šï¼š</strong> ä¸ç®¡æ˜¯æ”¾åœ¨ä¿éšªç®±çš„éŒ¢ï¼ˆåœ°ç«¯ï¼‰ï¼Œé‚„æ˜¯å­˜åœ¨éŠ€è¡Œçš„éŒ¢ï¼ˆé›²ç«¯ï¼‰ï¼Œéƒ½æ˜¯ä½ çš„éŒ¢ï¼ˆè³‡æºï¼‰ï¼Œéƒ½è¦ä¿è­·ã€‚"
                    },
                    mnemonic: "é›¶ä¿¡ä»»çœ¼ä¸­ï¼Œè¬ç‰©çš†è³‡æºï¼Œæ²’æœ‰æ³•å¤–ä¹‹åœ°ã€‚",
                    trap: {
                        blindSpot: "è¦ºå¾—é›²ç«¯æ˜¯å» å•†ç®¡çš„ã€å“¡å·¥æ‰‹æ©Ÿæ˜¯ç§äººçš„ï¼Œæ‰€ä»¥å…¬å¸ç®¡ä¸åˆ°ï¼ŸéŒ¯ï¼",
                        guide: "åªè¦èƒ½ã€Œå­˜å–ã€å…¬å¸è³‡æ–™ï¼Œå®ƒå°±æ˜¯æ¶æ§‹çš„ä¸€éƒ¨åˆ†ï¼Œå¿…é ˆè¢«é©—è­‰ã€‚"
                    },
                    selfCheck: [
                        { q: "BYOD (Bring Your Own Device) çš„é¢¨éšªæ˜¯ä»€éº¼ï¼Ÿ", a: "å“¡å·¥ç§äººæ‰‹æ©Ÿå¯èƒ½äº‚è£ App æˆ–æ²’æ›´æ–°ï¼Œå®¹æ˜“æˆç‚ºé§­å®¢å…¥ä¾µå…¬å¸ç¶²è·¯çš„è·³æ¿ã€‚" },
                        { q: "ä»€éº¼æ˜¯ã€Œå‹•æ…‹æ±ºå®šã€ï¼Ÿ", a: "ä¸æ˜¯çœ‹ä¸€æ¬¡è­‰ä»¶å°±æ°¸ä¹…æ”¾è¡Œï¼Œè€Œæ˜¯æ¯æ¬¡å‹•ä½œå‰éƒ½è¦çœ‹ç•¶ä¸‹çš„ç’°å¢ƒå®‰å…¨ç‹€æ…‹å†æ±ºå®šã€‚" }
                    ]
                }
            },
            {
                id: 32,
                tag: "tag-zt",
                tagName: "NISTåŸºæœ¬è¦å‰‡",
                type: "multi", // è¤‡é¸
                text: "é—œæ–¼ NIST SP 800-207 é›¶ä¿¡ä»»æ¶æ§‹çš„åŸºæœ¬è¦å‰‡æ•˜è¿°ï¼Œä¸‹åˆ—ä½•è€…æ­£ç¢ºï¼Ÿï¼ˆè¤‡é¸ï¼‰",
                options: [
                    "æ‰€æœ‰çš„é€šè¨Šéƒ½éœ€è¢«ä¿è­·ï¼Œç„¡è«–å…¶æ‰€åœ¨ä¹‹ç¶²è·¯ä½ç½®", // æ­£è§£
                    "é ˆè§€å¯Ÿèˆ‡é‡æ¸¬æ‰€æ“æœ‰è³‡ç”¢èˆ‡ç›¸é—œè³‡ç”¢ï¼Œå…¶å®Œæ•´æ€§èˆ‡å®‰å…¨æ…‹å‹¢", // æ­£è§£
                    "é‹ç®—æœå‹™å’Œè³‡æ–™ä¾†æºçš†å¯è¦–ç‚ºè³‡æº", // æ­£è§£
                    "æ‡‰å…ˆè’é›†è³‡ç”¢ã€ç¶²è·¯æ¶æ§‹ç­‰ç¾ç‹€ï¼Œå»ºç«‹è³‡ç”¢æ¸…å†Š" // éŒ¯ (é€™æ˜¯å°å…¥æ­¥é©Ÿï¼ŒéTenets)
                ],
                correctIndices: [0, 1, 2],
                analysis: {
                    step1_keywords: ["NIST SP 800-207", "åŸºæœ¬è¦å‰‡ (Tenets)", "è¤‡é¸", "æ­£ç¢º"],
                    step2_translate: "é€™é¡Œè€ƒçš„æ˜¯é›¶ä¿¡ä»»çš„ã€Œä¸ƒå¤§å¤©æ¢ã€ã€‚å°±åƒæ†²æ³•ä¸€æ¨£ï¼Œæ˜¯æœ€é«˜æŒ‡å°åŸå‰‡ã€‚",
                    step3_logic: {
                        steps: "1. å€åˆ†ã€Œé•·æœŸåŸå‰‡ï¼ˆTenetsï¼‰ã€èˆ‡ã€Œæº–å‚™å·¥ä½œï¼ˆActionï¼‰ã€ã€‚<br>2. è¨˜ä½é—œéµå­—ï¼šä¸åˆ†ä½ç½®ã€æŒçºŒé‡æ¸¬ã€è¦–ç‚ºè³‡æºã€‚",
                        principle: "NIST åˆ—å‡ºäº† 7 æ¢ Tenetsï¼Œæè¿°é›¶ä¿¡ä»»ç³»çµ±æ‡‰æœ‰çš„ã€Œå±¬æ€§ã€ã€‚",
                        example: "ç”Ÿæ´»ä¾‹å­ï¼šå®¶è¦æ˜¯ã€Œé€²é–€è¦æ´—æ‰‹ã€ï¼ˆåŸå‰‡ï¼‰ï¼›è€Œå»è²·æ´—æ‰‹ä¹³ã€è£æ°´é¾é ­æ˜¯ã€Œæº–å‚™å·¥ä½œã€ã€‚D é¸é …å°±åƒæ˜¯å»è²·æ´—æ‰‹ä¹³ã€‚"
                    },
                    step4_options: [
                        { label: "(A)", valid: "æ­£ç¢º", content: "ä¸è«–å…§ç¶²å¤–ç¶²ï¼Œé€£ç·šä¸€å¾‹åŠ å¯†é©—è­‰ã€‚" },
                        { label: "(B)", valid: "æ­£ç¢º", content: "è¦éš¨æ™‚å¹«é›»è…¦ã€Œé‡é«”æº«ã€ï¼ˆæª¢æŸ¥å®‰å…¨æ…‹å‹¢ï¼‰ï¼Œç™¼ç‡’ï¼ˆä¸­æ¯’ï¼‰å°±ä¸èƒ½å·¥ä½œã€‚" },
                        { label: "(C)", valid: "æ­£ç¢º", content: "å†æ¬¡å¼·èª¿ï¼Œæ‰€æœ‰è³‡æ–™èˆ‡é‹ç®—èƒ½åŠ›éƒ½æ˜¯è³‡æºã€‚" },
                        { label: "(D)", valid: "éŒ¯èª¤", content: "ã€Œå»ºç«‹è³‡ç”¢æ¸…å†Šã€éå¸¸é‡è¦ï¼Œä½†å®ƒæ˜¯å¯¦æ–½é›¶ä¿¡ä»»çš„ã€Œç¬¬ä¸€æ­¥æº–å‚™å·¥ä½œã€ï¼Œè€Œä¸æ˜¯æ¶æ§‹æœ¬èº«çš„ã€Œé‹ä½œæ³•å‰‡ï¼ˆTenetsï¼‰ã€ã€‚" }
                    ],
                    supplement: {
                        definition: "<strong>NIST Tenetsï¼š</strong> é›¶ä¿¡ä»»æ¶æ§‹çš„å…¬ç†ï¼Œä¾‹å¦‚ã€Œæ‰€æœ‰é€šè¨Šéƒ½è¦åšå®‰å…¨æºé€šã€ã€ã€Œå­˜å–æˆæ¬Šè¦æ˜¯å‹•æ…‹çš„ã€ã€‚",
                        analogy: "<strong>è§¸é¡æ—é€šï¼š</strong> è€ƒè©¦å¸¸æ‹¿ã€Œå°å…¥æ­¥é©Ÿã€æ··å……ã€ŒåŸºæœ¬åŸå‰‡ã€ã€‚æ­¥é©Ÿæœ‰å…ˆå¾Œï¼ŒåŸå‰‡æ˜¯æ°¸æ†çš„ã€‚"
                    },
                    mnemonic: "ä¸åˆ†å…§å¤–çš†åŠ å¯†ï¼ŒæŒçºŒé©—è­‰ä¸æ”¾é¬†ï¼›è¬ç‰©è³‡æºçš†ç´ç®¡ï¼Œæ¸…å†Šåªæ˜¯æº–å‚™åŠŸã€‚",
                    trap: {
                        blindSpot: "çœ‹åˆ° D é¸é …è¦ºå¾—å¾ˆåˆç†å°±é¸äº†ã€‚å®ƒç¢ºå¯¦æ˜¯ã€Œå°çš„äº‹ã€ï¼Œä½†é¡Œç›®å•çš„æ˜¯ã€ŒåŸºæœ¬è¦å‰‡ (Tenets)ã€ã€‚",
                        guide: "åˆ†é¡é¡Œå‹æœ€é›£ã€‚å•è‡ªå·±ï¼šé€™æ˜¯ã€Œå±¬æ€§ã€é‚„æ˜¯ã€Œå‹•ä½œã€ï¼ŸD æ˜¯å‹•ä½œã€‚"
                    },
                    selfCheck: [
                        { q: "ç‚ºä»€éº¼å…§ç¶²é€šè¨Šä¹Ÿè¦åŠ å¯†ï¼Ÿ", a: "å› ç‚ºé›¶ä¿¡ä»»å‡è¨­é§­å®¢å·²ç¶“åœ¨å…§ç¶²äº†ï¼Œå¦‚æœä¸åŠ å¯†ï¼Œè³‡æ–™å°±æœƒè¢«ç«Šè½ã€‚" }
                    ]
                }
            }
        ]
    };

    // --- ç‹€æ…‹ç®¡ç†è®Šæ•¸ ---
    let currentTab = 0;
    const userState = quizData.questions.map(() => ({
        selected: [], 
        shuffledIndices: [], 
        isSubmitted: false,
        isCorrect: false
    }));

    // --- åˆå§‹åŒ– ---
    function init() {
        document.getElementById('scenario-text').innerHTML = quizData.groupScenario;
        document.getElementById('total-count').innerText = quizData.questions.length;
        
        renderTabs();
        renderQuestions();
        updateProgress();
    }

    // --- Fisher-Yates æ´—ç‰Œæ¼”ç®—æ³• ---
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // --- æ¸²æŸ“ Tabs ---
    function renderTabs() {
        const container = document.getElementById('tabs-container');
        container.innerHTML = '';
        
        quizData.questions.forEach((q, index) => {
            const btn = document.createElement('div');
            btn.className = `tab-btn ${index === currentTab ? 'active' : ''}`;
            btn.innerHTML = `<span>ç¬¬ ${q.id} é¡Œ</span> <span class="status-icon"></span>`;
            btn.onclick = () => switchTab(index);
            container.appendChild(btn);
        });
    }

    // --- æ¸²æŸ“é¡Œç›® ---
    function renderQuestions() {
        const container = document.getElementById('questions-container');
        container.innerHTML = '';

        quizData.questions.forEach((q, qIndex) => {
            // æ´—ç‰Œé‚è¼¯
            let optionsObj = q.options.map((text, idx) => ({ originalIndex: idx, text: text }));
            if (userState[qIndex].shuffledIndices.length === 0) {
                shuffleArray(optionsObj);
                userState[qIndex].shuffledIndices = optionsObj.map(o => o.originalIndex);
            }
            const currentOptionsDisplay = userState[qIndex].shuffledIndices.map(idx => q.options[idx]);

            // é—œéµå­—æ¨™ç´…
            let processedText = q.text.replace(/(ä¸åŒ…å«|æœ‰èª¤|éŒ¯èª¤|ä¸|ä¸æ˜¯|æœ€ä¸é©ç”¨)/g, '<span class="highlight-negative">$1</span>');

            const card = document.createElement('div');
            card.className = `question-card ${qIndex === currentTab ? 'active' : ''}`;
            card.id = `q-card-${qIndex}`;

            // ç”Ÿæˆé¸é …åˆ†æè¡¨æ ¼ HTML
            const analysisTableRows = q.analysis.step4_options.map(opt => `
                <tr>
                    <td style="font-weight:bold; color:var(--primary-color);">${opt.label}</td>
                    <td style="white-space:nowrap; font-weight:bold; color:${opt.valid.includes('æ­£ç¢º')||opt.valid.includes('åŒ…å«') ? 'var(--success-text)' : 'var(--error-text)'}">${opt.valid}</td>
                    <td>${opt.content}</td>
                </tr>
            `).join('');

            // ç”Ÿæˆè‡ªæˆ‘æª¢æ¸¬ HTML
            const selfCheckHTML = q.analysis.selfCheck.map((item, idx) => `
                <div class="self-check-item">
                    <div class="self-check-q">
                        <span style="color:var(--accent-color)">Q${idx+1}:</span>
                        <span>${item.q}</span>
                    </div>
                    <div class="self-check-a-container">
                        <button class="toggle-answer-btn" onclick="toggleAnswer(this)">æŸ¥çœ‹ç­”æ¡ˆ</button>
                        <div class="self-check-answer">${item.a}</div>
                    </div>
                </div>
            `).join('');

            // é—œéµå­—æ¨™ç±¤ HTML
            const keywordsHTML = q.analysis.step1_keywords.map(k => `<span class="highlight-keyword">${k}</span>`).join(' ');

            card.innerHTML = `
                <div class="q-header">
                    <span class="q-badge ${q.tag}"># ${q.tagName}</span>
                    <span style="color: #666; font-size: 0.9rem;">${q.type === 'multi' ? 'ï¼ˆè¤‡é¸é¡Œï¼‰' : 'ï¼ˆå–®é¸é¡Œï¼‰'}</span>
                </div>
                <div class="question-text">Q${q.id}. ${processedText}</div>
                
                <div class="options-grid" id="options-grid-${qIndex}">
                    ${currentOptionsDisplay.map((optText, idx) => `
                        <div class="option-item" onclick="toggleOption(${qIndex}, ${idx})" id="opt-${qIndex}-${idx}">
                            <div class="option-marker">${String.fromCharCode(65 + idx)}</div>
                            <div>${optText}</div>
                        </div>
                    `).join('')}
                </div>

                <div class="action-area">
                    <button class="btn btn-submit" id="btn-submit-${qIndex}" onclick="submitAnswer(${qIndex})">é€å‡ºç­”æ¡ˆ</button>
                    <button class="btn btn-retry" id="btn-retry-${qIndex}" onclick="resetQuestion(${qIndex})">é‡æ–°ä½œç­”</button>
                </div>

                <!-- å®Œæ•´è©³è§£å€ -->
                <div class="explanation-section" id="exp-${qIndex}">
                    <div class="exp-header-text">è©¦é¡Œå…¨è§£æ</div>

                    <!-- Step 1 & 2 -->
                    <div class="exp-block">
                        <h4><span class="icon">ğŸ”</span> ç¬¬ä¸€æ­¥ï¼šæ‰¾é—œéµå­—</h4>
                        <div class="exp-content">${keywordsHTML}</div>
                        <div style="margin-top:15px; padding-top:15px; border-top:1px dashed #ddd;">
                            <h4><span class="icon">ğŸ’¬</span> ç¬¬äºŒæ­¥ï¼šç™½è©±ç¿»è­¯</h4>
                            <div class="exp-content">${q.analysis.step2_translate}</div>
                        </div>
                    </div>

                    <!-- Step 3 -->
                    <div class="exp-block">
                        <h4><span class="icon">ğŸ§ </span> ç¬¬ä¸‰æ­¥ï¼šè§£é¡Œæ€è·¯</h4>
                        <div class="exp-content">
                            <p><strong>è§£é¡Œæ­¥é©Ÿï¼š</strong> ${q.analysis.step3_logic.steps}</p>
                            <p style="margin-top:10px;"><strong>åŸç†èˆ‡è¦å‰‡ï¼š</strong> ${q.analysis.step3_logic.principle}</p>
                            <p style="margin-top:10px; background:#f0f8ff; padding:10px; border-radius:5px;"><strong>ç”Ÿæ´»ä¾‹å­ï¼š</strong> ${q.analysis.step3_logic.example}</p>
                        </div>
                    </div>

                    <!-- Step 4 -->
                    <div class="exp-block">
                        <h4><span class="icon">âš–ï¸</span> ç¬¬å››æ­¥ï¼šé¸é …åˆ†æ</h4>
                        <table class="analysis-table">
                            <thead><tr><th width="10%">é¸é …</th><th width="15%">åˆ¤æ–·</th><th>è§£æ</th></tr></thead>
                            <tbody>${analysisTableRows}</tbody>
                        </table>
                    </div>

                    <!-- è£œå……èˆ‡å»¶ä¼¸ -->
                    <div class="exp-block">
                        <h4><span class="icon">ğŸ“š</span> è§€å¿µè£œå……èˆ‡å»¶ä¼¸</h4>
                        <div class="exp-content">
                            <p>${q.analysis.supplement.definition}</p>
                            <p style="margin-top:10px;">${q.analysis.supplement.analogy}</p>
                        </div>
                    </div>

                    <!-- è¨˜æ†¶å£è¨£ -->
                    <div class="exp-block mnemonic-box">
                        <span style="font-size:1.5rem; display:block; margin-bottom:5px;">ğŸ”‘</span>
                        ${q.analysis.mnemonic}
                    </div>

                    <!-- é™·é˜± -->
                    <div class="exp-block trap-box">
                        <h4><span class="icon">ğŸ’£</span> å¸¸è¦‹é™·é˜±</h4>
                        <div class="exp-content">
                            <p><strong>å¿ƒç†ç›²é»ï¼š</strong> ${q.analysis.trap.blindSpot}</p>
                            <p style="margin-top:5px; color:#c0392b; font-weight:bold;"><strong>é¿å‘æŒ‡å—ï¼š</strong> ${q.analysis.trap.guide}</p>
                        </div>
                    </div>

                    <!-- è‡ªæˆ‘æª¢æ¸¬ -->
                    <div class="exp-block" style="border-left-color: #2c3e50;">
                        <h4><span class="icon">ğŸ§</span> è‡ªæˆ‘æª¢æ¸¬</h4>
                        <div class="exp-content">
                            ${selfCheckHTML}
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(card);
        });
    }

    // --- åˆ‡æ› Tab ---
    function switchTab(index) {
        const tabs = document.querySelectorAll('.tab-btn');
        tabs.forEach(t => t.classList.remove('active'));
        tabs[index].classList.add('active');

        const cards = document.querySelectorAll('.question-card');
        cards.forEach(c => c.classList.remove('active'));
        document.getElementById(`q-card-${index}`).classList.add('active');

        currentTab = index;
        window.scrollTo({
            top: document.querySelector('.tabs-container').offsetTop - 20,
            behavior: 'smooth'
        });
    }

    // --- é¸é …é»æ“Š ---
    function toggleOption(qIndex, optDisplayIndex) {
        if (userState[qIndex].isSubmitted) return;

        const qType = quizData.questions[qIndex].type;
        const selectedArr = userState[qIndex].selected;
        
        if (qType === 'single') {
            userState[qIndex].selected = [optDisplayIndex];
            const allOpts = document.querySelectorAll(`#options-grid-${qIndex} .option-item`);
            allOpts.forEach(el => el.classList.remove('selected'));
            document.getElementById(`opt-${qIndex}-${optDisplayIndex}`).classList.add('selected');
        } else {
            const idxInArray = selectedArr.indexOf(optDisplayIndex);
            if (idxInArray > -1) {
                selectedArr.splice(idxInArray, 1);
                document.getElementById(`opt-${qIndex}-${optDisplayIndex}`).classList.remove('selected');
            } else {
                selectedArr.push(optDisplayIndex);
                document.getElementById(`opt-${qIndex}-${optDisplayIndex}`).classList.add('selected');
            }
        }
    }

    // --- é€å‡ºç­”æ¡ˆ ---
    function submitAnswer(qIndex) {
        if (userState[qIndex].selected.length === 0) {
            alert("è«‹å…ˆé¸æ“‡ç­”æ¡ˆï¼");
            return;
        }

        userState[qIndex].isSubmitted = true;
        const qData = quizData.questions[qIndex];
        const state = userState[qIndex];
        
        const userSelectedOriginalIndices = state.selected.map(displayIdx => state.shuffledIndices[displayIdx]).sort((a, b) => a - b);
        const correctOriginalIndices = qData.correctIndices.sort((a, b) => a - b);
        
        const isCorrect = JSON.stringify(userSelectedOriginalIndices) === JSON.stringify(correctOriginalIndices);
        state.isCorrect = isCorrect;

        const allOpts = document.querySelectorAll(`#options-grid-${qIndex} .option-item`);
        
        allOpts.forEach((el, displayIdx) => {
            el.classList.add('disabled'); 
            const originalIdx = state.shuffledIndices[displayIdx];
            
            if (qData.correctIndices.includes(originalIdx)) {
                el.classList.add('correct-answer');
            }
            
            if (state.selected.includes(displayIdx) && !qData.correctIndices.includes(originalIdx)) {
                el.classList.add('wrong-choice');
            }
        });

        document.getElementById(`btn-submit-${qIndex}`).style.display = 'none';
        document.getElementById(`btn-retry-${qIndex}`).style.display = 'inline-block';

        document.getElementById(`exp-${qIndex}`).style.display = 'block';

        updateTabStatus(qIndex, isCorrect);
        updateProgress();

        document.getElementById(`exp-${qIndex}`).scrollIntoView({behavior: 'smooth', block: 'start'});
    }

    // --- å–®é¡Œé‡ç½® ---
    function resetQuestion(qIndex) {
        userState[qIndex].isSubmitted = false;
        userState[qIndex].selected = [];
        userState[qIndex].isCorrect = false;

        const allOpts = document.querySelectorAll(`#options-grid-${qIndex} .option-item`);
        allOpts.forEach(el => {
            el.classList.remove('selected', 'correct-answer', 'wrong-choice', 'disabled');
        });

        document.getElementById(`exp-${qIndex}`).style.display = 'none';
        document.getElementById(`btn-submit-${qIndex}`).style.display = 'inline-block';
        document.getElementById(`btn-retry-${qIndex}`).style.display = 'none';
        
        // é‡ç½®è‡ªæˆ‘æª¢æ¸¬çš„ç­”æ¡ˆé¡¯ç¤º
        const answers = document.querySelectorAll(`#exp-${qIndex} .self-check-answer`);
        answers.forEach(a => a.style.display = 'none');

        const tabs = document.querySelectorAll('.tab-btn');
        tabs[qIndex].classList.remove('correct', 'wrong');
        tabs[qIndex].querySelector('.status-icon').innerHTML = '';

        updateProgress();
        document.getElementById(`q-card-${qIndex}`).scrollIntoView({behavior: 'smooth', block: 'center'});
    }

    // --- è‡ªæˆ‘æª¢æ¸¬ç­”æ¡ˆåˆ‡æ› ---
    function toggleAnswer(btn) {
        const answerDiv = btn.nextElementSibling;
        if (answerDiv.style.display === 'block') {
            answerDiv.style.display = 'none';
            btn.innerText = 'æŸ¥çœ‹ç­”æ¡ˆ';
        } else {
            answerDiv.style.display = 'block';
            btn.innerText = 'éš±è—ç­”æ¡ˆ';
        }
    }

    function updateTabStatus(qIndex, isCorrect) {
        const tabs = document.querySelectorAll('.tab-btn');
        const tab = tabs[qIndex];
        const icon = tab.querySelector('.status-icon');
        
        tab.classList.remove('correct', 'wrong');
        tab.classList.add(isCorrect ? 'correct' : 'wrong');
        icon.innerHTML = isCorrect ? 'âœ“' : 'âœ—';
    }

    function updateProgress() {
        const completedCount = userState.filter(s => s.isSubmitted).length;
        const total = quizData.questions.length;
        const percent = (completedCount / total) * 100;

        document.getElementById('completed-count').innerText = completedCount;
        document.getElementById('global-progress').style.width = `${percent}%`;
    }

    window.onload = init;

</script>

</body>
</html>