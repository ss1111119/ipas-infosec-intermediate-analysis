<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è³‡å®‰é¢¨éšªè©•ä¼°æ•™å­¸æ¨¡çµ„ (Q4-Q7)</title>
    <style>
        :root {
            /* æ ¸å¿ƒè‰²ç³» */
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --error-color: #c0392b;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #333333;
            --border-color: #e0e0e0;

            /* æ¨™ç±¤è‰²ç³» */
            --tag-law: #607d8b;
            --tag-iso: #27ae60;
            --tag-zt: #8e44ad;
            --tag-net: #2980b9;
            --tag-sec: #c0392b;
            --tag-mgm: #d35400;

            /* UI å°ºå¯¸ */
            --radius: 16px;
            --spacing: 16px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: system-ui, "Noto Sans TC", sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding-bottom: 40px;
        }

        /* --- Header & Progress --- */
        header {
            background: var(--card-bg);
            padding: 16px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
            max-width: 960px;
            margin: 0 auto;
            border-bottom-left-radius: var(--radius);
            border-bottom-right-radius: var(--radius);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        h1 {
            font-size: 1.2rem;
            color: var(--primary-color);
            font-weight: 700;
        }

        .progress-text {
            font-size: 0.9rem;
            color: #666;
            font-weight: 600;
        }

        .progress-bar-bg {
            width: 100%;
            height: 8px;
            background: #eee;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), #2980b9);
            width: 0%;
            transition: width 0.4s ease;
        }

        /* --- Main Layout --- */
        main {
            max-width: 960px;
            margin: 20px auto;
            padding: 0 16px;
        }

        /* --- Scenario Box --- */
        .scenario-box {
            background: #e3f2fd;
            border-left: 5px solid var(--accent-color);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 24px;
            font-size: 0.95rem;
            color: #444;
        }

        .scenario-title {
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 8px;
            display: block;
        }

        /* --- Tabs --- */
        .tabs-container {
            display: flex;
            overflow-x: auto;
            gap: 8px;
            margin-bottom: 20px;
            padding-bottom: 4px;
            scrollbar-width: none; /* Firefox */
        }
        .tabs-container::-webkit-scrollbar {
            display: none; /* Chrome/Safari */
        }

        .tab-btn {
            flex: 0 0 auto;
            padding: 10px 20px;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            border-radius: 24px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tab-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(44, 62, 80, 0.3);
        }

        .tab-btn.correct {
            background: #e8f5e9;
            color: var(--success-color);
            border-color: var(--success-color);
        }

        .tab-btn.wrong {
            background: #fce4ec;
            color: var(--error-color);
            border-color: var(--error-color);
        }

        /* --- Question Card --- */
        .question-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 24px;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .q-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .q-id {
            font-weight: 700;
            color: #888;
            font-size: 0.9rem;
        }

        .tag {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            color: white;
            font-weight: 600;
        }
        .tag.law { background-color: var(--tag-law); }
        .tag.iso { background-color: var(--tag-iso); }
        .tag.zt { background-color: var(--tag-zt); }
        .tag.net { background-color: var(--tag-net); }
        .tag.sec { background-color: var(--tag-sec); }
        .tag.mgm { background-color: var(--tag-mgm); }

        .q-text {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 24px;
            color: #222;
        }

        .highlight-negative {
            color: var(--error-color);
            font-weight: 900;
            text-decoration: underline;
        }

        /* --- Options --- */
        .options-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-item {
            display: flex;
            align-items: flex-start;
            padding: 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            background: white;
        }

        .option-item:hover:not(.disabled) {
            background-color: #f0f7fa;
            border-color: #b3e5fc;
        }

        .option-item.selected {
            border-color: var(--accent-color);
            background-color: #e3f2fd;
        }

        .option-item.disabled {
            cursor: default;
            opacity: 0.8;
        }

        /* Correct/Wrong States */
        .option-item.correct-answer {
            border-color: var(--success-color);
            background-color: #e8f5e9;
        }
        .option-item.wrong-answer {
            border-color: var(--error-color);
            background-color: #fce4ec;
        }

        .opt-label {
            font-weight: 700;
            margin-right: 12px;
            min-width: 24px;
            color: var(--primary-color);
        }

        .opt-content {
            flex: 1;
        }

        /* --- Action Area --- */
        .action-area {
            margin-top: 24px;
            display: flex;
            justify-content: flex-end;
        }

        .btn {
            padding: 12px 32px;
            border-radius: 30px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn-submit {
            background: var(--accent-color);
            color: white;
        }
        .btn-submit:hover { background: #2980b9; }

        .btn-reset {
            background: white;
            color: var(--text-color);
            border: 2px solid var(--border-color);
        }
        .btn-reset:hover { background: #f5f5f5; }

        /* --- Explanation Section --- */
        .explanation-card {
            background: #fff;
            border-radius: var(--radius);
            padding: 24px;
            margin-top: 24px;
            border-top: 5px solid var(--accent-color);
            display: none; /* Hidden initially */
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .explanation-card.show {
            display: block;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .exp-section {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px dashed #eee;
        }
        
        .exp-section:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
        }

        .exp-header {
            font-size: 1rem;
            color: var(--accent-color);
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f0f7fa;
            padding: 6px 12px;
            border-radius: 6px;
            display: inline-block;
        }

        .exp-content {
            font-size: 0.95rem;
            color: #444;
            padding-left: 4px;
            margin-top: 8px;
            white-space: pre-line; /* ä¿ç•™æ›è¡Œ */
        }

        .sub-title {
            font-weight: 700;
            color: var(--primary-color);
            margin-top: 8px;
            margin-bottom: 4px;
            display: block;
        }

        .golden-sentence {
            background: #fff3e0;
            padding: 16px;
            border-radius: 8px;
            color: #d35400;
            font-weight: 700;
            text-align: center;
            margin: 20px 0;
            border: 2px solid #ffe0b2;
            font-size: 1.1rem;
        }

        /* Self Check */
        .self-check-container {
            margin-top: 24px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            border: 1px solid #e0e0e0;
        }
        
        .sc-question {
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 12px;
            display: flex;
            gap: 8px;
        }
        .sc-icon { color: var(--accent-color); }

        details.self-check-details summary {
            cursor: pointer;
            color: #666;
            font-size: 0.9rem;
            user-select: none;
            padding: 8px 12px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: inline-block;
        }
        
        details.self-check-details[open] summary {
            margin-bottom: 8px;
        }

        .sc-answer {
            margin-top: 8px;
            padding: 12px;
            background: #e8f5e9;
            color: #2e7d32;
            border-radius: 4px;
            font-weight: 500;
        }

        /* List styling within explanation */
        .exp-list {
            padding-left: 20px;
            margin: 4px 0;
        }
        .exp-list li {
            margin-bottom: 4px;
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            header, main {
                width: 100%;
                padding: 12px;
            }
            .question-card, .explanation-card {
                padding: 16px;
            }
            .btn {
                width: 100%;
            }
            .tabs-container {
                padding-bottom: 10px;
            }
        }

    </style>
</head>
<body>

<header>
    <div class="header-top">
        <h1 id="group-title">è³‡å®‰é¢¨éšªè©•ä¼°</h1>
        <div class="progress-text">å®Œæˆé€²åº¦ï¼š<span id="progress-count">0/0</span></div>
    </div>
    <div class="progress-bar-bg">
        <div class="progress-bar-fill" id="progress-bar"></div>
    </div>
</header>

<main>
    <!-- é¡Œçµ„æƒ…å¢ƒ -->
    <section id="scenario-container" class="scenario-box">
        <!-- JS Inject -->
    </section>

    <!-- é¡Œè™Ÿåˆ‡æ› Tabs -->
    <nav class="tabs-container" id="tabs-container">
        <!-- JS Inject -->
    </nav>

    <!-- é¡Œç›®å¡ç‰‡ -->
    <article class="question-card" id="question-card">
        <div class="q-meta">
            <span class="q-id" id="q-id-display">Question 1</span>
            <span class="tag" id="q-tag">æ¨™ç±¤</span>
        </div>
        <div class="q-text" id="q-text">
            <!-- JS Inject -->
        </div>
        
        <div class="options-list" id="options-list">
            <!-- JS Inject -->
        </div>

        <div class="action-area">
            <button class="btn btn-submit" id="action-btn">é€å‡ºç­”æ¡ˆ</button>
        </div>
    </article>

    <!-- è©³è§£å¡ç‰‡ï¼šæ”¹ç‚ºå‹•æ…‹ç”Ÿæˆå…§å®¹ -->
    <section class="explanation-card" id="explanation-card">
        <!-- JS Inject Content Here -->
    </section>
</main>

<script>
    // --- è³‡æ–™å±¤ (Model) ---
    const quizData = {
        groupTitle: "Risk_Assessment_Vulnerability_Q4-Q7",
        groupScenario: "<span class='scenario-title'>ã€å…±åŒæƒ…å¢ƒã€‘</span>å…¬å¸å› ä¾›æ‡‰éˆä¹‹å®¢æˆ¶è¦æ±‚ï¼Œåœ¨åŸ·è¡Œå—è¨—æ¥­å‹™æ™‚ï¼Œå¿…é ˆé‡å°æ‰€æ‰¿æ¥ä¹‹å—è¨—æ¥­å‹™ç›¸é—œçš„è³‡è¨Šå®‰å…¨æœ‰æ‰€ä½œç‚ºï¼Œå› æ­¤å…¬å¸é«˜å±¤ä¸‹ä»¤ç›¸é—œäººå“¡ï¼Œé‡å°å…¬å¸åœ¨åŸ·è¡Œå—è¨—æ¥­å‹™ä¸­å¯èƒ½é¢è‡¨çš„è³‡è¨Šå®‰å…¨é¢¨éšªè­°é¡Œé€²è¡Œç ”è­°ã€‚",
        questions: [
            {
                id: 4,
                tag: "é¢¨éšªç®¡ç†",
                tagClass: "mgm",
                type: "single",
                text: "ä¾æ“š NIST SP800-30ã€ŠGuide for Conducting Risk Assessmentsã€‹æ–‡ä»¶ï¼Œå°æ–¼ã€Œå¼±é»ï¼ˆVulnerabilityï¼Œå°±æ˜¯ã€ç³»çµ±æœ¬èº«å­˜åœ¨ã€å¯èƒ½è¢«åˆ©ç”¨çš„ç¼ºé™·ã€ï¼‰ã€ä¹‹æ•˜è¿°ä¿‚æŒ‡ï¼šã€Œç³»çµ±å®‰å…¨ç¨‹åºã€è¨­è¨ˆã€è£ç½®ã€æˆ–å…§éƒ¨æ§åˆ¶çš„ä¸€å€‹ç‘•ç–µæˆ–ç¼ºé™·ï¼Œè‹¥è¢«åˆ©ç”¨å¾Œï¼Œæœƒç ´å£å®‰å…¨æ€§æˆ–é•èƒŒç³»çµ±å®‰å…¨æ”¿ç­–ã€ã€‚è«‹å•é—œæ–¼ã€Œå¼±é»ã€çš„æ•˜è¿°ï¼Œä¸‹åˆ—ä½•é …éŒ¯èª¤ï¼Ÿ",
                options: [
                    "å¾®è»Ÿç™¼å¸ƒä¹‹ Windows ä½œæ¥­ç³»çµ±æ¼æ´",
                    "ç³»çµ±ç®¡ç†äººå“¡ä¾ç¨‹åºæ–¼æ¯å­£æœ«å°‡é›¢è·äººå“¡ä¹‹å¸³è™Ÿåœç”¨",
                    "IoT è¨­å‚™ç„¡æ³•è®Šæ›´é è¨­å¯†ç¢¼åŠå¸³è™Ÿ",
                    "çµ„ç¹”å…§éƒ¨äººå“¡é•åè³‡å®‰è¦å®šï¼Œç§è‡ªæ”œå¸¶å¤–æ¥å¼å„²å­˜è¨­å‚™ä¸¦é€£æ¥è‡³çµ„ç¹”å…§éƒ¨é‡è¦ä¼ºæœå™¨ä½¿ç”¨ï¼Œé€²è€Œå°è‡´æª”æ¡ˆä¼ºæœå™¨é­å—å‹’ç´¢ç—…æ¯’æ„ŸæŸ“ï¼Œé‡è¦è³‡æ–™é­å—åŠ å¯†ç„¡æ³•ä½¿ç”¨"
                ],
                correctIndices: [3], // (D) is index 3
                analysis: {
                    step1: "NIST SP800-30ã€å¼±é»ï¼ˆVulnerabilityï¼‰ã€ç‘•ç–µæˆ–ç¼ºé™·ã€è¢«åˆ©ç”¨å¾Œï¼ˆæè¿°å‡è¨­æƒ…å¢ƒï¼Œè€Œéå·²ç™¼ç”Ÿäº‹æ•…ï¼‰",
                    step2: "é€™é¡Œåœ¨å•ï¼šã€Œå“ªä¸€å€‹é¸é …å…¶å¯¦ä¸æ˜¯ã€ç³»çµ±æœ¬ä¾†å°±æœ‰çš„ç ´å£ã€ï¼Œè€Œæ˜¯ã€äººé•è¦ï¼‹äº‹æƒ…å·²ç¶“ç™¼ç”Ÿã€ï¼Ÿã€",
                    step3: {
                        steps: [
                            "å…ˆè¨˜ä½ï¼šå¼±é» = ç¼ºé™·æœ¬èº«",
                            "æª¢æŸ¥é¸é …æ˜¯å¦æè¿°ã€äº‹ä»¶ç¶“éæˆ–çµæœã€",
                            "åªè¦æ˜¯ã€äººåšäº†ä»€éº¼ï¼‹é€ æˆä»€éº¼å¾Œæœã€ï¼Œé€šå¸¸ä¸æ˜¯å¼±é»"
                        ],
                        principle: "NIST é¢¨éšªæ¨¡å‹ï¼šå¼±é»ï¼ˆé–€æ²’é–ï¼‰vs å¨è„…ï¼ˆå°å·ä¾†äº†ï¼‰vs å½±éŸ¿ï¼ˆæ±è¥¿è¢«å·ï¼‰",
                        example: "USB å­”æœªç®¡æ§ â†’ å¼±é»<br>å“¡å·¥æ’ USB â†’ å¨è„…è¡Œç‚º<br>ä¸­å‹’ç´¢ç—…æ¯’ â†’ äº‹æ•…çµæœ"
                    },
                    step4: "A. Windows æ¼æ´ï¼šç³»çµ±è¨­è¨ˆç¼ºé™· â†’ å¼±é»<br>B. ä¾ç¨‹åºåœç”¨å¸³è™Ÿï¼šæ­£ç¢ºæ§åˆ¶æµç¨‹ï¼Œæœ¬èº«ä¸æ§‹æˆéŒ¯èª¤å¼±é»æè¿°<br>C. IoT ç„¡æ³•æ”¹é è¨­å¸³å¯†ï¼šè¨­è¨ˆç¼ºé™· â†’ å¼±é»<br>D. æè¿°é•è¦è¡Œç‚ºï¼‹æ„ŸæŸ“çµæœ â†’ ä¸æ˜¯å¼±é»",
                    concept: {
                        title: "é¢¨éšªç®¡ç†åŸºç¤å®šç¾©é¡Œï¼ˆé«˜é »å¿…è€ƒï¼‰",
                        law: "å¼±é»ï¼šç³»çµ±å“ªè£¡æœ‰ç ´å£"
                    },
                    analogy: "USB ç®¡æ§æœªåš â†’ å¼±é»<br>å‹’ç´¢ç—…æ¯’ â†’ å¨è„…",
                    mnemonic: "ã€Œå¼±é»æ˜¯ç ´å£ï¼Œä¸æ˜¯çµæœã€‚ã€",
                    traps: {
                        blindspot: "çœ‹åˆ°åš´é‡å¾Œæœå°±ç›´è¦ºé¸ï¼Œå®¹æ˜“æŠŠäº‹æ•…çµæœç•¶å¼±é»",
                        guide: "æè¿°ã€Œå·²ç¶“ç™¼ç”Ÿã€é€šå¸¸ä¸æ˜¯å¼±é»"
                    },
                    self_check: {
                        q: "ã€ŒUSB å­”æœªé™åˆ¶ä½¿ç”¨ã€ç®—ä¸ç®—å¼±é»ï¼Ÿ",
                        a: "ç®—ï¼Œå› ç‚ºæ˜¯æ§åˆ¶ç¼ºé™·ã€‚"
                    }
                }
            },
            {
                id: 5,
                tag: "æŠ€è¡“æª¢æ¸¬",
                tagClass: "sec",
                type: "single",
                text: "å·¥ç¨‹å¸«æ­£è©•ä¼°æ¡ç”¨ã€Œå¼±é»è©•ä¼°ï¼ˆVulnerability Assessmentï¼Œå°±æ˜¯ã€ç”¨å·¥å…·ç³»çµ±åŒ–æ‰¾å¼±é»ã€ï¼‰ã€å·¥å…·ä¾†è©•ä¼°å…¬å¸å…§éƒ¨æ½›åœ¨å¼±é»ï¼Œä¸‹åˆ—æ•˜è¿°ä½•è€…æœ‰èª¤ï¼Ÿ",
                options: [
                    "Nessus Professional å¯é€²è¡Œç³»çµ±å¼±é»è©•ä¼°",
                    "Acunetix å¯é€²è¡Œç¶²ç«™å¼±é»è©•ä¼°",
                    "Fortify SCA å‹•æ…‹åŸå§‹ç¢¼æª¢æ¸¬å·¥å…·å¯ç”¨æ–¼åŸå§‹ç¢¼å¼±é»è©•ä¼°",
                    "Nmap å¯é€²è¡Œç¶²è·¯è¨­å‚™å¼±é»è©•ä¼°"
                ],
                correctIndices: [2], // (C) is index 2
                analysis: {
                    step1: "å¼±é»è©•ä¼°å·¥å…·ã€Nessus / Acunetix / Fortify / Nmapã€å‹•æ…‹ vs éœæ…‹",
                    step2: "å“ªä¸€å€‹å·¥å…·ã€Œç”¨é€”è¢«èªªéŒ¯ã€ï¼Ÿ",
                    step3: {
                        steps: [
                            "è¨˜ä½å„å·¥å…·ä¸»è¦ç”¨é€”",
                            "ç‰¹åˆ¥ç•™æ„ SAST / DAST åè©"
                        ],
                        principle: "å·¥å…·åˆ†é¡éŒ¯èª¤æ˜¯è€ƒè©¦å¸¸è¦‹é™·é˜±",
                        example: "ç”¨æº«åº¦è¨ˆé‡è¡€å£“ï¼Œä¸€å®šéŒ¯"
                    },
                    step4: "A. Nessusï¼šä¸»æ©Ÿ/ç³»çµ± â†’ æ­£ç¢º<br>B. Acunetixï¼šWeb â†’ æ­£ç¢º<br>C. Fortify SCA æ˜¯ã€Œéœæ…‹ã€ä¸æ˜¯ã€Œå‹•æ…‹ã€ â†’ éŒ¯<br>D. Nmap å¯ç”¨æ–¼å‰ç½®å¼±é»ç™¼ç¾ â†’ æ­£ç¢º",
                    concept: {
                        title: "å·¥å…·åˆ†é¡",
                        law: "SASTï¼šçœ‹åŸå§‹ç¢¼<br>DASTï¼šè·‘èµ·ä¾†æ¸¬"
                    },
                    analogy: "ç„¡",
                    mnemonic: "ã€ŒFortify çœ‹ç¨‹å¼ï¼Œä¸è·‘ç³»çµ±ã€‚ã€",
                    traps: {
                        blindspot: "çœ‹åˆ°ã€Œå‹•æ…‹ã€å°±ä»¥ç‚ºæ¯”è¼ƒé«˜ç´š",
                        guide: "çœ‹åˆ° Fortify â†’ ç›´æ¥è¯æƒ³åˆ° SAST"
                    },
                    self_check: {
                        q: "OWASP ZAP å±¬æ–¼ SAST é‚„æ˜¯ DASTï¼Ÿ",
                        a: "DASTï¼ˆå‹•æ…‹æ‡‰ç”¨ç¨‹å¼å®‰å…¨æ¸¬è©¦ï¼‰ã€‚"
                    }
                }
            },
            {
                id: 6,
                tag: "æ¨™æº–è¦ç¯„",
                tagClass: "iso",
                type: "multi", // è¤‡é¸
                text: "é—œæ–¼ CVSS (Common Vulnerability Scoring System)ï¼Œä¸‹åˆ—æ•˜è¿°ä½•é …éŒ¯èª¤ï¼Ÿï¼ˆè¤‡é¸ï¼‰",
                options: [
                    "CVSS æ˜¯é¢¨éšªè©•ä¼°æ¡†æ¶",
                    "CVSS æœƒç”¢ç”Ÿå¼±é»åš´é‡åº¦åˆ†æ•¸",
                    "åˆ†æ•¸å¯è½‰ç‚ºä½ä¸­é«˜åš´é‡",
                    "CVSS ç”±ä¸‰å€‹åº¦é‡çµ„æ§‹æˆ"
                ],
                correctIndices: [0, 3], // (A) and (D)
                analysis: {
                    step1: "CVSSã€æ¡†æ¶ vs è©•åˆ†ç³»çµ±ã€åº¦é‡çµ„",
                    step2: "å“ªäº›æ•˜è¿°æŠŠ CVSS èªªéŒ¯å®šä½ï¼Ÿ",
                    step3: {
                        steps: [
                            "è¨˜ä½ï¼šCVSS = è©•åˆ†ç³»çµ±",
                            "ä¸ç­‰æ–¼å®Œæ•´é¢¨éšªç®¡ç†"
                        ],
                        principle: "åè©ç²¾æº–åº¦",
                        example: "æˆç¸¾å–®ä¸æ˜¯å­¸æ ¡åˆ¶åº¦"
                    },
                    step4: "A. éŒ¯ï¼šä¸æ˜¯é¢¨éšªæ¡†æ¶<br>B. å°<br>C. å°<br>D. éŒ¯ï¼šæ•˜è¿°ç”¨èªä¸ç²¾æº–",
                    concept: {
                        title: "åè©å®šç¾©",
                        law: "CVSS æ˜¯è©•åˆ†æ¨™æº–ï¼ŒRisk = Severity x Likelihood"
                    },
                    analogy: "ç„¡",
                    mnemonic: "ã€ŒCVSS è©•åˆ†ï¼Œä¸è©•æµç¨‹ã€‚ã€",
                    traps: {
                        blindspot: "æŠŠäº‹æ•…çµæœç•¶å¼±é»",
                        guide: "åˆ†æ•¸ä¸ä»£è¡¨çµ•å°é¢¨éšªï¼Œé‚„è¦çµåˆæƒ…å¢ƒ"
                    },
                    self_check: {
                        q: "CVSS åˆ†æ•¸èƒ½ç›´æ¥ä»£è¡¨é¢¨éšªå—ï¼Ÿ",
                        a: "ä¸èƒ½ï¼Œé‚„è¦çµåˆæƒ…å¢ƒèˆ‡è³‡ç”¢åƒ¹å€¼ã€‚"
                    }
                }
            },
            {
                id: 7,
                tag: "æ‡‰è®Šè™•ç½®",
                tagClass: "sec",
                type: "multi", // è¤‡é¸
                text: "ç³»çµ±å­˜åœ¨ CVE-2022-26809 RPC RCE å¼±é»ï¼Œä¸‹åˆ—å“ªäº›å› æ‡‰æªæ–½åˆé©ï¼Ÿï¼ˆè¤‡é¸ï¼‰",
                options: [
                    "æŸ¥ CVE è³‡è¨Š",
                    "å®‰è£å¾®è»Ÿä¿®è£œç¨‹å¼",
                    "é˜²ç«ç‰†é˜»æ“‹ TCP 445",
                    "å…¨é¢æ›´æ›ä½œæ¥­ç³»çµ±"
                ],
                correctIndices: [0, 1, 2], // (A), (B), (C)
                analysis: {
                    step1: "CVEã€ä¿®è£œã€ç·©è§£æªæ–½",
                    step2: "å“ªäº›åšæ³•ã€Œå¯¦éš›åˆåˆç†ã€ï¼Ÿ",
                    step3: {
                        steps: [
                            "è™•ç†æµç¨‹ï¼šæŸ¥ â†’ è£œ â†’ æ“‹"
                        ],
                        principle: "æˆæœ¬èˆ‡æ•ˆç›Šå¹³è¡¡",
                        example: "ç„¡"
                    },
                    step4: "A. æŸ¥è³‡è¨Š â†’ å°<br>B. ä¿®è£œ â†’ å°<br>C. ç·©è§£ â†’ å°<br>D. éåº¦ä¸”ä¸å¯¦éš› â†’ éŒ¯",
                    concept: {
                        title: "è™•ç½®å„ªå…ˆé †åº",
                        law: "ä¿®è£œå„ªå…ˆï¼Œç·©è§£æ¬¡ä¹‹"
                    },
                    analogy: "ç„¡",
                    mnemonic: "ã€Œæ¼æ´ä¸‰æ­¥é©Ÿï¼šæŸ¥ã€è£œã€æ“‹ã€‚ã€",
                    traps: {
                        blindspot: "ä»¥ç‚ºæ›æ–°ç³»çµ±æœ€å®‰å…¨",
                        guide: "è¦è€ƒé‡å¯¦å‹™å¯è¡Œæ€§"
                    },
                    self_check: {
                        q: "å¦‚æœç„¡æ³•ç«‹å³ä¿®è£œï¼Œæœ€å„ªå…ˆåšä»€éº¼ï¼Ÿ",
                        a: "ç·©è§£æªæ–½ï¼ˆå¦‚é˜²ç«ç‰†/éš”é›¢ï¼‰ã€‚"
                    }
                }
            }
        ]
    };

    // --- ç‹€æ…‹ç®¡ç† (State) ---
    let currentTab = 0;
    // å„²å­˜æ¯é¡Œçš„ç‹€æ…‹ï¼šshuffledOptions (äº‚åºå¾Œçš„é¸é …é™£åˆ—), selectedIndices (ä½¿ç”¨è€…é¸çš„äº‚åºå¾Œç´¢å¼•), isSubmitted
    const quizState = quizData.questions.map(q => ({
        shuffledOptions: [], // æ ¼å¼: { originalIndex: 0, text: "..." }
        selectedIndices: new Set(),
        isSubmitted: false,
        isCorrect: null // null, true, false
    }));

    // --- æ ¸å¿ƒé‚è¼¯ (Controller) ---

    function init() {
        // æ¸²æŸ“æƒ…å¢ƒ
        document.getElementById('scenario-container').innerHTML = quizData.groupScenario;
        document.getElementById('group-title').textContent = quizData.groupTitle;

        // åˆå§‹åŒ–æ¯é¡Œçš„éš¨æ©Ÿé¸é …
        quizData.questions.forEach((q, idx) => {
            // å»ºç«‹åŒ…å«åŸå§‹ç´¢å¼•çš„ç‰©ä»¶é™£åˆ—
            const opts = q.options.map((opt, i) => ({ originalIndex: i, text: opt }));
            // Fisher-Yates Shuffle
            for (let i = opts.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [opts[i], opts[j]] = [opts[j], opts[i]];
            }
            quizState[idx].shuffledOptions = opts;
        });

        renderTabs();
        renderQuestion(0);
        updateProgress();
    }

    // é—œéµå­—é«˜äº®è™•ç†
    function highlightText(text) {
        const negativeKeywords = ["ä¸æ­£ç¢º", "éŒ¯èª¤", "æœ‰èª¤", "ä¸æ˜¯", "æœ€ä¸é©ç”¨"];
        let processed = text;
        negativeKeywords.forEach(kw => {
            const regex = new RegExp(kw, "g");
            processed = processed.replace(regex, `<span class="highlight-negative">${kw}</span>`);
        });
        return processed;
    }

    function renderTabs() {
        const container = document.getElementById('tabs-container');
        container.innerHTML = '';
        quizData.questions.forEach((q, idx) => {
            const btn = document.createElement('button');
            btn.className = `tab-btn ${idx === currentTab ? 'active' : ''}`;
            
            // ç‹€æ…‹æ¨£å¼
            if (quizState[idx].isSubmitted) {
                if (quizState[idx].isCorrect) {
                    btn.classList.add('correct');
                    btn.innerHTML = `Q${q.id} âœ“`;
                } else {
                    btn.classList.add('wrong');
                    btn.innerHTML = `Q${q.id} âœ—`;
                }
            } else {
                btn.innerHTML = `ç¬¬ ${q.id} é¡Œ`;
            }

            btn.onclick = () => {
                currentTab = idx;
                renderTabs(); // é‡ç¹ª Tabs ä»¥æ›´æ–° active
                renderQuestion(idx);
                // å¹³æ»‘æ²å‹•å›é ‚éƒ¨
                document.getElementById('question-card').scrollIntoView({ behavior: 'smooth', block: 'start' });
            };
            container.appendChild(btn);
        });
    }

    function renderQuestion(idx) {
        const qData = quizData.questions[idx];
        const state = quizState[idx];

        // æ›´æ–°é¡Œç›®å¡ç‰‡å…§å®¹
        document.getElementById('q-id-display').textContent = `Question ${qData.id}`;
        
        const tagEl = document.getElementById('q-tag');
        tagEl.textContent = qData.tag;
        tagEl.className = `tag ${qData.tagClass}`;

        document.getElementById('q-text').innerHTML = highlightText(qData.text);

        // æ¸²æŸ“é¸é …
        const list = document.getElementById('options-list');
        list.innerHTML = '';
        
        state.shuffledOptions.forEach((optObj, optIdx) => {
            const item = document.createElement('div');
            item.className = 'option-item';
            
            // ç‹€æ…‹è™•ç†
            if (state.isSubmitted) {
                item.classList.add('disabled');
                // åˆ¤æ–·æ˜¯å¦ç‚ºæ­£ç¢ºç­”æ¡ˆ (Original Index åœ¨ Correct Indices ä¸­)
                const isRealCorrect = qData.correctIndices.includes(optObj.originalIndex);
                // åˆ¤æ–·æ˜¯å¦è¢«é¸ä¸­
                const isSelected = state.selectedIndices.has(optIdx);

                if (isRealCorrect) {
                    item.classList.add('correct-answer'); // é¡¯ç¤ºç¶ åº•
                } else if (isSelected && !isRealCorrect) {
                    item.classList.add('wrong-answer'); // é¸éŒ¯é¡¯ç¤ºç´…åº•
                }
            } else {
                if (state.selectedIndices.has(optIdx)) {
                    item.classList.add('selected');
                }
                // é»æ“Šäº‹ä»¶
                item.onclick = () => handleOptionClick(idx, optIdx);
            }

            const label = String.fromCharCode(65 + optIdx); // A, B, C, D
            item.innerHTML = `
                <span class="opt-label">${label}</span>
                <span class="opt-content">${optObj.text}</span>
            `;
            list.appendChild(item);
        });

        // æŒ‰éˆ•ç‹€æ…‹
        const actionBtn = document.getElementById('action-btn');
        if (state.isSubmitted) {
            actionBtn.textContent = "é‡æ–°ä½œç­”";
            actionBtn.className = "btn btn-reset";
            actionBtn.onclick = () => resetQuestion(idx);
            renderExplanation(idx);
        } else {
            actionBtn.textContent = "é€å‡ºç­”æ¡ˆ";
            actionBtn.className = "btn btn-submit";
            actionBtn.onclick = () => submitAnswer(idx);
            document.getElementById('explanation-card').classList.remove('show');
        }
    }

    function handleOptionClick(qIdx, optIdx) {
        const qData = quizData.questions[qIdx];
        const state = quizState[qIdx];
        
        if (state.isSubmitted) return;

        if (qData.type === 'single') {
            state.selectedIndices.clear();
            state.selectedIndices.add(optIdx);
        } else {
            // è¤‡é¸ï¼šToggle
            if (state.selectedIndices.has(optIdx)) {
                state.selectedIndices.delete(optIdx);
            } else {
                state.selectedIndices.add(optIdx);
            }
        }
        renderQuestion(qIdx); // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–° UI
    }

    function submitAnswer(idx) {
        const state = quizState[idx];
        const qData = quizData.questions[idx];

        if (state.selectedIndices.size === 0) {
            alert("è«‹å…ˆé¸æ“‡ä¸€å€‹ç­”æ¡ˆï¼");
            return;
        }

        state.isSubmitted = true;

        // åˆ¤æ–·å°éŒ¯
        // ä½¿ç”¨è€…é¸çš„é¸é …ç´¢å¼• -> è½‰æ›ç‚ºåŸå§‹é¸é …ç´¢å¼• -> æ¯”å° Correct Indices
        const userOriginalIndices = Array.from(state.selectedIndices).map(i => state.shuffledOptions[i].originalIndex);
        
        // æª¢æŸ¥å…©å€‹é™£åˆ—æ˜¯å¦ç›¸ç­‰ (å¿½ç•¥é †åºï¼Œå…ˆæ’åº)
        userOriginalIndices.sort();
        const correctOriginalIndices = [...qData.correctIndices].sort();

        const isCorrect = JSON.stringify(userOriginalIndices) === JSON.stringify(correctOriginalIndices);
        state.isCorrect = isCorrect;

        updateProgress();
        renderTabs();
        renderQuestion(idx);
    }

    function resetQuestion(idx) {
        const state = quizState[idx];
        state.isSubmitted = false;
        state.isCorrect = null;
        state.selectedIndices.clear();
        
        // é‡æ–°æ´—ç‰Œé¸é …
        const opts = quizData.questions[idx].options.map((opt, i) => ({ originalIndex: i, text: opt }));
        for (let i = opts.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [opts[i], opts[j]] = [opts[j], opts[i]];
        }
        state.shuffledOptions = opts;

        updateProgress();
        renderTabs();
        renderQuestion(idx);
        
        // æ²å‹•å›é ‚éƒ¨
        document.getElementById('question-card').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // æ”¹å¯«ï¼šæ ¹æ“šæ–°çµæ§‹å‹•æ…‹ç”¢ç”Ÿè©³è§£ HTML
    function renderExplanation(idx) {
        const data = quizData.questions[idx].analysis;
        const container = document.getElementById('explanation-card');
        
        let html = `
            <div class="exp-section">
                <div class="exp-header">ğŸ” ç¬¬ä¸€æ­¥ï¼šæ‰¾é—œéµå­—</div>
                <div class="exp-content">${data.step1}</div>
            </div>

            <div class="exp-section">
                <div class="exp-header">ğŸ’¬ ç¬¬äºŒæ­¥ï¼šç™½è©±ç¿»è­¯</div>
                <div class="exp-content">${data.step2}</div>
            </div>

            <div class="exp-section">
                <div class="exp-header">ğŸ§  ç¬¬ä¸‰æ­¥ï¼šè§£é¡Œæ€è·¯</div>
                <div class="exp-content">
                    <span class="sub-title">1. è§£é¡Œæ­¥é©Ÿï¼š</span>
                    <ul class="exp-list">
                        ${data.step3.steps.map(s => `<li>${s}</li>`).join('')}
                    </ul>
                    <span class="sub-title">2. åŸç†èˆ‡è¦å‰‡ï¼š</span>
                    ${data.step3.principle}
                    <span class="sub-title">3. ç”Ÿæ´»ä¾‹å­ï¼š</span>
                    ${data.step3.example}
                </div>
            </div>

            <div class="exp-section">
                <div class="exp-header">âš–ï¸ ç¬¬å››æ­¥ï¼šé¸é …åˆ†æ</div>
                <div class="exp-content">${data.step4}</div>
            </div>

            <div class="exp-section">
                <div class="exp-header">ğŸ“š è§€å¿µè£œå……èˆ‡å»¶ä¼¸</div>
                <div class="exp-content">
                    <strong>æ ¸å¿ƒï¼š${data.concept.title}</strong><br>
                    æ³•æ¢/å®šç¾©ï¼š${data.concept.law}
                </div>
            </div>

            <div class="exp-section">
                <div class="exp-header">ğŸ”— è§¸é¡æ—é€šï¼ˆèˆ‰ä¸€åä¸‰ï¼‰</div>
                <div class="exp-content">${data.analogy}</div>
            </div>

            <div class="golden-sentence">
                ğŸ”‘ è¨˜æ†¶å£è¨£ï¼š${data.mnemonic}
            </div>

            <div class="exp-section">
                <div class="exp-header">âš ï¸ å¸¸è¦‹é™·é˜±</div>
                <div class="exp-content">
                    <strong>å¿ƒç†ç›²é»ï¼š</strong>${data.traps.blindspot}<br>
                    <strong>é¿å‘æŒ‡å—ï¼š</strong>${data.traps.guide}
                </div>
            </div>

            <div class="self-check-container">
                <div class="sc-question">
                    <span class="sc-icon">â“</span> è‡ªæˆ‘æª¢æ¸¬ï¼š${data.self_check.q}
                </div>
                <details class="self-check-details">
                    <summary>é»æ“ŠæŸ¥çœ‹ç­”æ¡ˆ</summary>
                    <div class="sc-answer">âœ… ${data.self_check.a}</div>
                </details>
            </div>
        `;
        
        container.innerHTML = html;
        container.classList.add('show');
    }

    function updateProgress() {
        const total = quizData.questions.length;
        const completed = quizState.filter(s => s.isSubmitted).length;
        const percentage = (completed / total) * 100;

        document.getElementById('progress-count').textContent = `${completed}/${total}`;
        document.getElementById('progress-bar').style.width = `${percentage}%`;
    }

    // å•Ÿå‹•
    window.onload = init;

</script>

</body>
</html>