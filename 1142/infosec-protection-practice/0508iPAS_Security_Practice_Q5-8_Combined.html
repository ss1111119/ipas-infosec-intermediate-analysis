<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPAS è³‡è¨Šå®‰å…¨é˜²è­·å¯¦å‹™ - é¡Œçµ„æ•´åˆç‰ˆ (Q5-Q8)</title>
    <style>
        :root {
            /* æ¨™ç±¤ç³»çµ±é…è‰² */
            --tag-law: #607d8b;
            --tag-iso: #27ae60;
            --tag-zt: #8e44ad;
            --tag-net: #2980b9;
            --tag-sec: #c0392b;
            --tag-mgm: #d35400;
            
            /* ç‹€æ…‹è‰² */
            --color-correct: #e8f5e9;
            --color-correct-text: #2e7d32;
            --color-wrong: #fce4ec;
            --color-wrong-text: #c62828;
            --color-neutral: #f5f5f5;
            
            /* UI åŸºç¤è‰² */
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-main: #333333;
            --text-light: #666666;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
            --detail-bg: #fafafa;
            --detail-border: #eeeeee;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: system-ui, "Noto Sans TC", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            font-size: 16px;
            line-height: 1.6;
        }

        /* å®¹å™¨è¦æ ¼ */
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* é é¦– Header */
        header {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        h1 {
            font-size: 1.25rem;
            color: var(--primary-color);
            margin: 0;
        }

        .progress-info {
            font-size: 0.9rem;
            color: var(--text-light);
            font-weight: bold;
        }

        /* å…¨åŸŸé€²åº¦æ¢ */
        .progress-container {
            width: 100%;
            height: 8px;
            background-color: #eee;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--accent-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* é¡Œçµ„èƒŒæ™¯ (Global Context) */
        .group-context {
            background-color: #e3f2fd;
            border-left: 5px solid #2196f3;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.95rem;
            color: #0d47a1;
        }

        .group-context-title {
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
        }

        /* åˆ‡æ›åˆ†é  Tabs */
        .tabs-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 5px;
            scrollbar-width: none; /* Firefox */
        }
        .tabs-container::-webkit-scrollbar {
            display: none; /* Chrome/Safari */
        }

        .tab-btn {
            background: white;
            border: none;
            padding: 10px 20px;
            border-radius: 24px;
            cursor: pointer;
            font-size: 1rem;
            color: var(--text-light);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.2s;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 6px;
            min-height: 48px; /* è§¸æ§å‹å–„ */
        }

        .tab-btn.active {
            background: var(--primary-color);
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(44, 62, 80, 0.3);
        }

        .tab-btn.completed {
            border: 2px solid var(--tag-iso);
            color: var(--tag-iso);
        }
        
        .tab-btn.active.completed {
            background: var(--tag-iso);
            color: white;
            border: none;
        }

        .tab-icon {
            font-size: 1.1em;
        }

        /* é¡Œç›®å¡ç‰‡ */
        .question-card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow);
            padding: 25px;
            margin-bottom: 20px;
            display: none; /* é è¨­éš±è—ï¼Œé€é JS æ§åˆ¶é¡¯ç¤º */
            animation: fadeIn 0.3s ease;
        }

        .question-card.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .q-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 10px;
            flex-wrap: wrap;
        }

        .q-badge {
            padding: 4px 12px;
            border-radius: 12px;
            color: white;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .tag-law { background-color: var(--tag-law); }
        .tag-iso { background-color: var(--tag-iso); }
        .tag-zt { background-color: var(--tag-zt); }
        .tag-net { background-color: var(--tag-net); }
        .tag-sec { background-color: var(--tag-sec); }
        .tag-mgm { background-color: var(--tag-mgm); }

        .q-text {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--text-main);
            margin-bottom: 25px;
        }

        /* é—œéµå­—å¼·èª¿ */
        .highlight-negative {
            color: #d32f2f;
            font-weight: 900;
            border-bottom: 2px solid #d32f2f;
        }

        /* é¸é …å€åŸŸ */
        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #eee;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
            background: white;
            position: relative;
        }

        .option-item:hover:not(.disabled) {
            border-color: var(--accent-color);
            background-color: #f8fbff;
        }

        .option-item.selected {
            border-color: var(--accent-color);
            background-color: #e3f2fd;
        }

        .option-item.disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        /* ä½œç­”å¾Œç‹€æ…‹ */
        .option-item.correct-ans {
            background-color: var(--color-correct);
            border-color: var(--color-correct-text);
            color: var(--color-correct-text);
        }

        .option-item.wrong-ans {
            background-color: var(--color-wrong);
            border-color: var(--color-wrong-text);
            color: var(--color-wrong-text);
        }

        .option-input {
            margin-right: 15px;
            width: 20px;
            height: 20px;
            accent-color: var(--accent-color);
        }

        /* åˆ¤å®šæŒ‰éˆ•å€ */
        .action-area {
            margin-top: 25px;
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        .btn {
            padding: 0 30px;
            height: 48px;
            border-radius: 24px;
            border: none;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-submit {
            background-color: var(--accent-color);
            color: white;
        }

        .btn-reset {
            background-color: transparent;
            border: 2px solid var(--text-light);
            color: var(--text-light);
            display: none; /* é è¨­éš±è— */
        }

        /* è©³è§£å€å¡Š (æ–°ç‰ˆè©³ç´°æ¨£å¼) */
        .explain-section {
            margin-top: 30px;
            border-top: 2px dashed #ddd;
            padding-top: 20px;
            display: none; /* é è¨­éš±è— */
            animation: slideDown 0.4s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .exp-detail-container {
            display: grid;
            gap: 15px;
        }

        .exp-block {
            background: var(--detail-bg);
            border: 1px solid var(--detail-border);
            border-radius: 8px;
            padding: 15px;
        }

        .exp-title {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }

        .exp-icon {
            color: var(--accent-color);
        }

        .exp-text {
            font-size: 0.95rem;
            color: #444;
            /* ç§»é™¤ white-space: pre-lineï¼Œæ”¹ç”¨ innerHTML æ’å…¥ <br> */
        }
        
        /* è§£æä¸­çš„ç²—é«”æ¨£å¼ */
        .exp-text strong {
            color: #d35400;
            background-color: #fff3e0;
            padding: 0 2px;
            border-radius: 2px;
        }

        /* è‡ªæˆ‘æª¢æ¸¬å€å¡Š */
        .self-check-box {
            background: #fff3e0; /* æ·¡æ©˜è‰²èƒŒæ™¯ */
            border: 1px solid #ffe0b2;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .self-check-title {
            font-weight: bold;
            color: #e65100;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .self-check-question {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .self-check-answer-btn {
            background: #ff9800;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .self-check-answer-content {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 4px;
            border: 1px dashed #ff9800;
            display: none; /* é è¨­éš±è— */
            color: #555;
        }

        /* RWD èª¿æ•´ */
        @media (max-width: 768px) {
            .container {
                width: 100%;
                padding: 15px;
            }
            
            .header-top {
                flex-direction: column;
                align-items: flex-start;
            }

            .tab-btn {
                padding: 8px 16px;
                font-size: 0.9rem;
            }

            .btn {
                width: 100%;
            }

            .action-area {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <!-- é é¦– -->
    <header>
        <div class="header-top">
            <h1>iPAS è³‡è¨Šå®‰å…¨é˜²è­·å¯¦å‹™ - é¡Œçµ„æ•´åˆç‰ˆ</h1>
            <div class="progress-info">
                å®Œæˆé€²åº¦ï¼š<span id="progress-text">0/4</span>
            </div>
        </div>
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
    </header>

    <!-- é¡Œçµ„èƒŒæ™¯ -->
    <div class="group-context">
        <span class="group-context-title">ã€é¡Œçµ„æƒ…å¢ƒã€‘</span>
        <span id="group-scenario-text"></span>
    </div>

    <!-- åˆ‡æ›åˆ†é  -->
    <div class="tabs-container" id="tabs-container">
        <!-- JS å‹•æ…‹ç”Ÿæˆ Tabs -->
    </div>

    <!-- é¡Œç›®å…§å®¹å€ (JS å‹•æ…‹æ¸²æŸ“) -->
    <div id="questions-container"></div>

</div>

<script>
// --- é¡Œç›®è³‡æ–™ ---
const quizData = {
  "groupTitle": "iPAS è³‡è¨Šå®‰å…¨é˜²è­·å¯¦å‹™",
  "groupScenario": "æŸé†«ç™‚è³‡è¨Šç³»çµ±æ¡ç”¨ Apache Struts 2 ä½œç‚ºé–‹ç™¼æ¡†æ¶ï¼Œä¸”ç‰ˆæœ¬æœªåŠæ™‚æ›´æ–°ã€‚ç´…éšŠæ¼”ç·´æ™‚ï¼Œæ–½æ¸¬äººå“¡ç™¼ç¾å¯é€éç‰¹å®š HTTP è«‹æ±‚ï¼Œæ–¼ HTTP Header ä¸­æ’å…¥æƒ¡æ„ OGNLï¼ˆObject Graph Navigation Languageï¼‰èªæ³•ï¼ŒæˆåŠŸé ç«¯åŸ·è¡Œä»»æ„æŒ‡ä»¤ï¼ˆRCEï¼‰ï¼Œå–å¾— Shell æ¬Šé™ã€‚æ–½æ¸¬äººå“¡é€²ä¸€æ­¥åˆ©ç”¨æ­¤æ¬Šé™ï¼Œåœ¨å…§ç¶²å¤§é‡æƒæä¸¦é€²è¡Œæ©«å‘ç§»å‹•ï¼ˆLateral Movementï¼‰ï¼Œæœ€çµ‚æ‰¾åˆ°è³‡æ–™åº«ä¼ºæœå™¨ï¼Œä¸¦ä»¥é è¨­å¸³è™Ÿå¯†ç¢¼ç™»å…¥ï¼Œç«Šå–å¤§é‡ç—…æ‚£é†«ç™‚è³‡æ–™ã€‚è‹¥æ­¤æ¼æ´è¢«æ”»æ“Šè€…åˆ©ç”¨ï¼Œå°‡é€ æˆåš´é‡çš„æ©Ÿå¯†è³‡æ–™å¤–æ´©äº‹ä»¶ã€‚",
  "questions": [
    {
      "id": 5,
      "tag": "web-sec", 
      "tagName": "WebæŠ€è¡“",
      "text": "ã€Œåœ¨ç³»çµ±æ’å…¥æƒ¡æ„ OGNL èªæ³•ï¼ŒæˆåŠŸé ç«¯åŸ·è¡Œä»»æ„æŒ‡ä»¤ä¸¦å–å¾— Shell æ¬Šé™ã€é€™ä¸€æ”»æ“Šè¡Œç‚ºï¼Œæ ¹æ“š MITRE ATT&CKï¼Œæœ€é©åˆæ­¸é¡æ–¼ä¸‹åˆ—å“ªä¸€å€‹æˆ°è¡“ï¼Ÿ",
      "options": [
        "(A) Reconnaissanceï¼ˆåµå¯Ÿï¼‰", 
        "(B) Initial Accessï¼ˆåˆå§‹å­˜å–ï¼‰", 
        "(C) Privilege Escalationï¼ˆæ¬Šé™æå‡ï¼‰", 
        "(D) Defense Evasionï¼ˆé˜²ç¦¦è¦é¿ï¼‰"
      ],
      "correct": ["B"],
      "analysis": {
         "keyword": "Apache Struts 2ã€ç‰ˆæœ¬æœªæ›´æ–°ã€æ’å…¥æƒ¡æ„ OGNLã€RCEã€å–å¾— Shellã€MITRE ATT&CKã€æˆ°è¡“ã€‚",
         "translation": "é§­å®¢åˆ©ç”¨ Struts 2 æ¼æ´ï¼Œå¾å¤–éƒ¨ä¸Ÿä¸€å€‹æƒ¡æ„è«‹æ±‚é€²å»ï¼ŒçµæœæˆåŠŸé‘½é€²ç³»çµ±æ‹¿åˆ°æ§åˆ¶æ¬Šã€‚è«‹å•é€™å€‹ã€Œç ´é–€è€Œå…¥ã€çš„å‹•ä½œï¼Œåœ¨ ATT&CK çŸ©é™£ä¸­ç®—å“ªä¸€æ‹›ï¼Ÿ",
         "logic_thought": "MITRE ATT&CK æ˜¯ä»¥ã€Œç›®çš„ã€ä¾†åˆ†é¡æˆ°è¡“ã€‚æœ¬é¡Œæ”»æ“Šè€…æ˜¯å¾ã€Œç„¡æ¬Šé™ï¼ˆå¤–éƒ¨ï¼‰ã€è®Šæˆã€Œæœ‰ç«‹è¶³é»ï¼ˆShellï¼‰ã€ï¼Œé€™æ˜¯æ”»æ“Šéˆçš„ã€Œå…¥å£ã€ã€‚",
         "steps": "1. **åˆ¤æ–·ç‹€æ…‹**ï¼šæ”»æ“Šè€…åŸæœ¬åœ¨ç‰†å¤–ï¼Œç¾åœ¨é€²åˆ°ç‰†å…§ã€‚\n2. **åˆ¤æ–·ç›®çš„**ï¼šå»ºç«‹ç¬¬ä¸€å€‹ç«‹è¶³é» (Foothold)ã€‚\n3. **å°æ‡‰æ¡†æ¶**ï¼šç”±å¤–è€Œå…§çš„å…¥ä¾µå±¬æ–¼ Initial Accessã€‚",
         "principles": "**Initial Access (åˆå§‹å­˜å–)**ï¼šæ”»æ“Šè€…ç”¨ä¾†é€²å…¥ç¶²è·¯çš„æŠ€è¡“ï¼ŒåŒ…å«åˆ©ç”¨æ¼æ´ã€é‡£é­šéƒµä»¶ç­‰ã€‚\n**Privilege Escalation (æ¬Šé™æå‡)**ï¼šæ”»æ“Šè€…å·²ç¶“åœ¨è£¡é¢äº†ï¼Œæƒ³å¾ User è®Š Adminã€‚",
         "life_example": "å°±åƒå°å·ã€Œæ’¬é–‹çª—æˆ¶çˆ¬é€²å®¢å»³ã€ï¼Œé€™æ˜¯ã€Œåˆå§‹å­˜å–ã€ã€‚å¦‚æœä»–é€²ä¾†å¾Œç™¼ç¾å®¢å»³æ²’éŒ¢ï¼Œè·‘å»ä¸»è‡¥å®¤æ‰¾ä¿éšªç®±é‘°åŒ™ï¼Œé‚£æ‰æ˜¯ã€Œæ¬Šé™æå‡ã€ã€‚",
         "option_analysis": "(A) **Reconnaissance**ï¼šé€™æ˜¯æ”»æ“Šå‰çš„ã€Œè¸©é»ã€ï¼Œä¾‹å¦‚æŸ¥ IPã€Google å“¡å·¥åå–®ã€‚æœ¬é¡Œå·²ç¶“æ‰“é€²å»äº†ã€‚\n(B) **Initial Access**ï¼šæ­£è§£ã€‚åˆ©ç”¨å°å¤–æœå‹™çš„æ¼æ´ (Exploit Public-Facing Application) é€²å…¥ç³»çµ±ã€‚\n(C) **Privilege Escalation**ï¼šé€™æ˜¯ã€Œå‡å®˜ã€ã€‚é¡Œç›®å¼·èª¿çš„æ˜¯ã€Œå…¥ä¾µæˆåŠŸã€ï¼Œè€Œéå¼·èª¿å¾ä½æ¬Šé™è®Šé«˜æ¬Šé™ã€‚\n(D) **Defense Evasion**ï¼šé€™æ˜¯ã€Œèº²è—ã€ã€‚ä¾‹å¦‚åˆªé™¤ Logã€é—œé–‰é˜²æ¯’ã€‚é¡Œç›®æ²’æåˆ°ã€‚",
         "supplement": "**Initial Access vs Execution**ï¼šé›–ç„¶ RCE æ¶‰åŠã€ŒåŸ·è¡Œ (Execution)ã€ï¼Œä½†è‹¥å–®é¸é¡Œå•ã€Œæ­¸é¡æ–¼å“ªå€‹æˆ°è¡“ã€ï¼Œé€šå¸¸å¼·èª¿å…¶ã€Œé€²å…¥ã€çš„æˆ°ç•¥æ„ç¾© (Initial Access)ã€‚",
         "law_def": "**MITRE ATT&CK**ï¼šä¸€å€‹åŸºæ–¼çœŸå¯¦ä¸–ç•Œè§€å¯Ÿçš„å°æŠ—æˆ°è¡“å’ŒæŠ€è¡“çš„çŸ¥è­˜åº«ã€‚",
         "analogy": "æ”¶åˆ°é‡£é­šéƒµä»¶ä¸¦é»é–‹é™„ä»¶ä¸­æ¯’ -> ä¹Ÿæ˜¯ Initial Accessã€‚",
         "mnemonic": "ç ´é–€é€²å±‹ï¼åˆå§‹å­˜å–ï¼›å‡åˆ°è€é—†ï¼æ¬Šé™æå‡ï¼›å…ˆå»è¸©é»ï¼åµå¯Ÿã€‚",
         "traps": "çœ‹åˆ°ã€Œå–å¾— Shellã€å°±ä»¥ç‚ºæ˜¯ã€Œæ¬Šé™æå‡ã€ã€‚å…¶å¯¦å–å¾— Shell åªæ˜¯ä»£è¡¨ã€Œé€²ä¾†äº†ã€ï¼Œè¦çœ‹æ˜¯å¾å“ªè£¡å–å¾—çš„ã€‚",
         "blind_spot": "åªé—œæ³¨çµæœ (Shell)ï¼Œå¿½ç•¥äº†éç¨‹ (å¾å¤–éƒ¨å…¥ä¾µ)ã€‚",
         "guide": "å…ˆå•è‡ªå·±ï¼šæ”»æ“Šè€…ç¾åœ¨æ˜¯åœ¨é–€å¤–æƒ³é€²ä¾†ï¼Œé‚„æ˜¯åœ¨é–€å…§æƒ³è®Šå¤§ï¼Ÿ",
         "self_check_q": "å¦‚æœæ”»æ“Šè€…æ˜¯é€éã€ŒçŒœæ¸¬ SSH å¯†ç¢¼ã€ç™»å…¥ç³»çµ±ï¼Œé€™å±¬æ–¼å“ªå€‹æˆ°è¡“ï¼Ÿ",
         "self_check_a": "é€™ä¹Ÿæ˜¯ Initial Accessï¼ˆå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡é€²å…¥ï¼‰ã€‚å¦‚æœæ˜¯å·²ç¶“ç™»å…¥ä¸€èˆ¬å¸³è™Ÿï¼ŒçŒœæ¸¬ root å¯†ç¢¼ï¼Œé‚£å°±æ˜¯ Privilege Escalationã€‚"
      }
    },
    {
      "id": 6,
      "tag": "net", 
      "tagName": "HTTPå”å®š",
      "text": "ä»¥é€™å€‹æ¡ˆä¾‹ä¾†èªªï¼Œæ–½æ¸¬äººå“¡ç”¨æ–¼åŸ·è¡Œ OGNL èªæ³•çš„ HTTP Header æœ€æœ‰å¯èƒ½æ˜¯ä¸‹åˆ—ä½•è€…ï¼Ÿ",
      "options": [
        "(A) Accept-Language", 
        "(B) Cache-Control", 
        "(C) Content-Type", 
        "(D) Origin"
      ],
      "correct": ["C"],
      "analysis": {
         "keyword": "Struts 2ã€OGNLã€HTTP Headerã€æœ€æœ‰å¯èƒ½ã€‚",
         "translation": "é§­å®¢æŠŠå£å£çš„ç¨‹å¼ç¢¼è—åœ¨ HTTP è«‹æ±‚çš„å“ªå€‹ã€Œä¿¡å°æ¨™ç±¤ã€è£¡ï¼Œæœƒè®“ä¼ºæœå™¨ç‚ºäº†è®€æ‡‚ä¿¡ä»¶å…§å®¹è€Œèª¤åŸ·è¡Œå®ƒï¼Ÿ",
         "logic_thought": "OGNL æ³¨å…¥é€šå¸¸ç™¼ç”Ÿåœ¨æ¡†æ¶ã€Œè§£æ (Parse)ã€è³‡æ–™çš„æ™‚å€™ã€‚å“ªå€‹ Header æœƒè§¸ç™¼æ¡†æ¶å»å‘¼å«è§£æå™¨ï¼Ÿç•¶ç„¶æ˜¯å®šç¾©ã€Œå…§å®¹æ ¼å¼ã€çš„ Headerã€‚",
         "steps": "1. **ç†è§£ç”¨é€”**ï¼šåˆ†ææ¯å€‹ Header çš„åŠŸèƒ½ã€‚\n2. **æ‰¾è§£æé»**ï¼šå“ªå€‹ Header æœƒè®“ Struts 2 å•Ÿå‹•è² è²¬è™•ç†è³‡æ–™çš„å…ƒä»¶ (Parser)ï¼Ÿ\n3. **é–å®šç­”æ¡ˆ**ï¼šContent-Type æ±ºå®šäº†ç”¨ä»€éº¼ Parserï¼Œæ˜¯å¸¸è¦‹æ¼æ´é»ã€‚",
         "principles": "**S2-045 æ¼æ´**ï¼šStruts 2 çš„ Jakarta Multipart parser åœ¨è™•ç†éŒ¯èª¤çš„ Content-Type æ™‚ï¼Œæœƒå˜—è©¦è§£æéŒ¯èª¤è¨Šæ¯ä¸­çš„ OGNLï¼Œå°è‡´ RCEã€‚",
         "life_example": "å°±åƒä½ å¯„åŒ…è£¹ï¼Œåœ¨ã€Œç‰©å“å…§å®¹ã€æ¬„ä½å¯«äº†ä¸€æ®µè©›å’’ï¼Œéƒµå·®è®€åˆ°é€™å€‹æ¬„ä½æ™‚å°±ä¸­é‚ªäº†ã€‚å…¶ä»–æ¬„ä½åƒã€Œéƒµéå€è™Ÿ (Origin)ã€æˆ–ã€Œé™æ™‚å°ˆé€ (Cache-Control)ã€é€šå¸¸åªæ˜¯çµ¦æ©Ÿå™¨çœ‹çš„è·¯ç”±è³‡è¨Šã€‚",
         "option_analysis": "(A) **Accept-Language**ï¼šå‘Šè¨´ä¼ºæœå™¨æˆ‘æƒ³çœ‹ä¸­æ–‡æˆ–è‹±æ–‡ã€‚é€šå¸¸åªå½±éŸ¿é¡¯ç¤ºèªè¨€ã€‚\n(B) **Cache-Control**ï¼šæ§åˆ¶ç€è¦½å™¨æˆ– Proxy è¦ä¸è¦å­˜å¿«å–ã€‚è·Ÿå¾Œç«¯è§£æé‚è¼¯é—œè¯å°ã€‚\n(C) **Content-Type**ï¼šæ­£è§£ã€‚å‘Šè¨´ä¼ºæœå™¨ Body æ˜¯ JSON é‚„æ˜¯ XML ç­‰ï¼Œæ¡†æ¶å¿…é ˆè®€å–ä¸¦è§£æå®ƒã€‚\n(D) **Origin**ï¼šç€è¦½å™¨ç”¨ä¾†åš CORS æª¢æŸ¥çš„ï¼Œå‘Šè¨´ä¼ºæœå™¨æˆ‘å¾å“ªä¾†ã€‚",
         "supplement": "Log4j æ¼æ´ (Log4Shell) ä¹Ÿå¯ä»¥ç™¼ç”Ÿåœ¨ Header (å¦‚ User-Agent)ï¼Œä½† Struts 2 æœ€ç¶“å…¸çš„æ¡ˆä¾‹æ˜¯ Content-Typeã€‚",
         "law_def": "**Content-Type**ï¼šç¶²éš›ç¶²è·¯åª’é«”é¡å‹ (MIME type)ï¼Œç”¨ä¾†è¡¨ç¤ºç™¼é€çµ¦æ¥æ”¶è€…çš„è³‡æ–™æ ¼å¼ã€‚",
         "analogy": "å•è·¯æ™‚ï¼Œå°æ–¹å•ã€Œä½ èªªä»€éº¼èªè¨€ (Accept-Language)ï¼Ÿã€vs å°æ–¹å•ã€Œä½ æ‰‹ä¸Šçš„ç›’å­è£¡è£ä»€éº¼ (Content-Type)ï¼Ÿã€å¾Œè€…éœ€è¦æ‰“é–‹ç›’å­æª¢æŸ¥ã€‚",
         "mnemonic": "å…§å®¹æ€éº¼è§£ï¼Œçœ‹ Content-Typeï¼›è§£ææœ‰æ´ï¼ŒRCE å°±ä¸­ã€‚",
         "traps": "ä»¥ç‚º Origin (ä¾†æº) æ˜¯é§­å®¢çš„ä¾†æº IPï¼Œæ‰€ä»¥æœ€å¯ç–‘ã€‚å…¶å¯¦å®ƒåªæ˜¯å€‹æ¨™è¨˜ã€‚",
         "blind_spot": "èªç‚ºæ‰€æœ‰ Header åªæ˜¯ç´”æ–‡å­—ï¼Œå¿½ç•¥äº†æŸäº› Header æœƒè§¸ç™¼å¾Œç«¯è¤‡é›œçš„ç¨‹å¼é‚è¼¯ã€‚",
         "guide": "çœ‹åˆ°ã€ŒStruts 2ã€+ã€ŒHeader æ³¨å…¥ã€ï¼Œç›´æ¥è¯æƒ³ Content-Typeã€‚",
         "self_check_q": "å¦‚æœé§­å®¢æ”¹åœ¨ User-Agent æ¬„ä½å¡ SQL Injectionï¼Œæœ‰å¯èƒ½æˆåŠŸå—ï¼Ÿ",
         "self_check_a": "æœ‰å¯èƒ½ã€‚å¦‚æœå¾Œç«¯ç¨‹å¼æœƒæŠŠ User-Agent å¯«å…¥è³‡æ–™åº«åšåˆ†æï¼Œä¸”æ²’æœ‰éæ¿¾ï¼Œå°±æœƒä¸­ SQL Injectionã€‚"
      }
    },
    {
      "id": 7,
      "tag": "sec", 
      "tagName": "æª¢æ¸¬å·¥å…·",
      "text": "é†«é™¢è‹¥æƒ³é‡å°å…§ç¶²ç’°å¢ƒé€²è¡Œä¸Šè¿° Struts 2 æ¼æ´çš„å¿«é€Ÿåµæ¸¬ä¸¦é©—è­‰ï¼Œä½¿ç”¨ä¸‹åˆ—ä½•ç¨®å·¥å…·æˆ–æŒ‡ä»¤æœ€ç‚ºé©åˆ‡ï¼Ÿ",
      "options": [
        "(A) nmap -sV --script=http-shellshock", 
        "(B) sqlmap -u \"https://struts2.com\"", 
        "(C) nikto -host struts2.com -C all", 
        "(D) msf ï¼ use exploit/multi/http/struts2_content_type_ognl"
      ],
      "correct": ["D"],
      "analysis": {
         "keyword": "Struts 2ã€OGNLã€å¿«é€Ÿåµæ¸¬ä¸¦é©—è­‰ã€å·¥å…·æŒ‡ä»¤ã€‚",
         "translation": "æˆ‘æƒ³è­‰æ˜é€™å€‹æ´çœŸçš„å­˜åœ¨è€Œä¸”æœƒè¢«æ‰“ç©¿ï¼Œä¸æ˜¯åªæœ‰æƒæè€Œå·²ï¼Œè©²ç”¨å“ªæ”¯ç¨‹å¼ï¼Ÿ",
         "logic_thought": "é—œéµå­—æ˜¯ã€Œé©—è­‰ (Verify/Exploit)ã€ã€‚ä¸€èˆ¬æƒæå™¨åªæœƒèªªã€Œå¯èƒ½æœ‰æ´ã€ï¼ŒMetasploit (msf) å‰‡æ˜¯ç”¨ä¾†ã€Œæ‰“æ‰“çœ‹ã€ï¼Œè­‰æ˜çœŸçš„èƒ½å–å¾—æ¬Šé™ã€‚",
         "steps": "1. **ç¢ºèªæ¼æ´**ï¼šStruts 2 OGNLã€‚\n2. **ç¢ºèªç›®çš„**ï¼šé©—è­‰ (Exploit)ã€‚\n3. **åŒ¹é…å·¥å…·**ï¼šæ‰¾æ¨¡çµ„åç¨±å« Struts 2 ä¸”åŠŸèƒ½ç‚º Exploit çš„å·¥å…·ã€‚",
         "principles": "**Metasploit Framework (MSF)**ï¼šæ»²é€æ¸¬è©¦æ¡†æ¶ï¼Œå…§å»ºå¤§é‡ Exploit Modulesï¼Œå¯ç”¨æ–¼é©—è­‰æ¼æ´çœŸå¯¦æ€§ã€‚\n**Vulnerability Assessment vs Penetration Test**ï¼šå‰è€…æ˜¯å»£æ³›æƒæ (Nmap/Nikto)ï¼Œå¾Œè€…æ˜¯æ·±åº¦é©—è­‰ (MSF)ã€‚",
         "life_example": "Nmap åƒæ˜¯ä¿å…¨å·¡é‚ï¼Œç´€éŒ„ã€Œé–€æ²’é–ã€ï¼›Metasploit åƒæ˜¯é–åŒ ï¼Œç›´æ¥æ‹¿å·¥å…·ã€ŒæŠŠé–€æ‰“é–‹çµ¦ä½ çœ‹ã€ï¼Œè­‰æ˜çœŸçš„é€²å¾—å»ã€‚",
         "option_analysis": "(A) **nmap ... http-shellshock**ï¼šé€™æ˜¯æ¸¬ Bash Shellshock æ¼æ´çš„ï¼Œè—¥ä¸å°ç—‡ã€‚\n(B) **sqlmap**ï¼šé€™æ˜¯æ¸¬ SQL Injection (è³‡æ–™åº«æ³¨å…¥) çš„ï¼Œè·Ÿ OGNL RCE ç„¡é—œã€‚\n(C) **nikto**ï¼šé€™æ˜¯ç¶²é å¼±æƒå·¥å…·ï¼Œèƒ½æƒå‡ºç‰ˆæœ¬éèˆŠï¼Œä½†é©—è­‰ RCE çš„èƒ½åŠ›ä¸å¦‚ MSF å¼·å¤§ã€‚\n(D) **msf ... struts2_content_type_ognl**ï¼šæ­£è§£ã€‚æ¨¡çµ„åç¨±å®Œå…¨å‘½ä¸­æ¼æ´ç‰¹å¾µã€‚",
         "supplement": "Nmap ä¹Ÿæœ‰ NSE script å¯ä»¥æ¸¬ Struts 2ï¼Œä½†é¸é … A æŒ‡å®šäº† Shellshockï¼Œæ‰€ä»¥éŒ¯èª¤ã€‚",
         "law_def": "**Exploit**ï¼šåˆ©ç”¨è»Ÿé«”æ¼æ´é€²è¡Œæ”»æ“Šçš„ç¨‹å¼ç¢¼æˆ–æŠ€è¡“ã€‚",
         "analogy": "ç”Ÿç—…äº†è¦åƒè—¥ã€‚æ„Ÿå†’è—¥ (Shellshock script) æ²»ä¸å¥½éª¨æŠ˜ (Struts 2)ï¼›èƒƒè—¥ (Sqlmap) ä¹Ÿæ²»ä¸å¥½éª¨æŠ˜ã€‚",
         "mnemonic": "æƒæç”¨ Nmapï¼Œé©—è­‰é  MSFï¼›è³‡æ–™åº«æ‰¾ Sqlmapï¼Œç¶²é å¼±æƒ Niktoã€‚",
         "traps": "çœ‹åˆ° Web å°±é¸ Niktoï¼Œçœ‹åˆ°æ¼æ´å°±é¸ Sqlmapã€‚æ²’æœ‰ä»”ç´°çœ‹å·¥å…·å°æ‡‰çš„æ¼æ´é¡å‹ã€‚",
         "blind_spot": "åˆ†ä¸æ¸…æ¥šã€Œæƒæ (Scan)ã€å’Œã€Œåˆ©ç”¨ (Exploit)ã€çš„å·®åˆ¥ã€‚",
         "guide": "å…ˆçœ‹é¡Œç›®æ˜¯ä»€éº¼ã€Œç—…ã€(Struts 2)ï¼Œå†çœ‹é¸é …æ˜¯ä»€éº¼ã€Œè—¥ã€(å·¥å…·)ã€‚",
         "self_check_q": "å¦‚æœä»Šå¤©è¦æ¸¬çš„æ˜¯ç¶²ç«™æœ‰æ²’æœ‰ SQL Injectionï¼Œè©²é¸å“ªå€‹ï¼Ÿ",
         "self_check_a": "é¸é … (B) sqlmapã€‚"
      }
    },
    {
      "id": 8,
      "tag": "net", 
      "tagName": "NmapæŒ‡ä»¤",
      "text": "æ”»æ“Šè€…å–å¾— RCE å¾Œï¼Œä½¿ç”¨ä¸‹åˆ—å“ªäº› nmap æŒ‡ä»¤ï¼ˆæŒ‡ä»¤ä¸­çš„ target è«‹è¦–ç‚ºè¦æƒæçš„ç³»çµ±ï¼‰å¯ä»¥ç”¨ä¾†æƒæ 3306 åŸ ï¼Œä¸¦ä¸”å¯ä»¥é¡¯ç¤ºè³‡æ–™åº«æœå‹™çš„ç‰ˆæœ¬ï¼Ÿï¼ˆè¤‡é¸ï¼‰",
      "options": [
        "(A) nmap -sV -p 3306 target", 
        "(B) nmap -O -p 1-65535 target", 
        "(C) nmap -sS -T5 target", 
        "(D) nmap -sV -p 3306 --script mysql-info target"
      ],
      "correct": ["A", "D"],
      "analysis": {
         "keyword": "3306 åŸ ã€é¡¯ç¤ºç‰ˆæœ¬ (Version)ã€Nmap æŒ‡ä»¤ã€è¤‡é¸ã€‚",
         "translation": "æˆ‘æƒ³çŸ¥é“ 3306 é€™å€‹é–€å¾Œé¢æ˜¯èª°ã€å¹¾æ­²äº† (ç‰ˆæœ¬è™Ÿ)ï¼Œè¦ä¸‹ä»€éº¼æŒ‡ä»¤ï¼Ÿ",
         "logic_thought": "çœ‹åˆ°ã€Œç‰ˆæœ¬ (Version)ã€ï¼ŒNmap çš„åƒæ•¸å°±æ˜¯ `-sV`ã€‚æ²’æœ‰ `-sV` çš„é¸é …é€šå¸¸åªèƒ½çŸ¥é“é–€æ˜¯é–‹çš„ï¼Œä¸çŸ¥é“è£¡é¢æ˜¯èª°ã€‚",
         "steps": "1. **é–å®šç›®æ¨™**ï¼šPort 3306 (MySQL)ã€‚\n2. **é–å®šéœ€æ±‚**ï¼šé¡¯ç¤ºç‰ˆæœ¬ã€‚\n3. **ç¯©é¸åƒæ•¸**ï¼šæ‰¾ `-sV` æˆ–ç›¸é—œ Scriptã€‚",
         "principles": "**-sV (Service Version Detection)**ï¼šNmap æœƒç™¼é€æ¢é‡å°åŒ…ï¼Œæ ¹æ“šå›æ‡‰ç‰¹å¾µæ¯”å°è³‡æ–™åº«ï¼Œåˆ¤æ–·æœå‹™ç‰ˆæœ¬ã€‚\n**--script**ï¼šä½¿ç”¨ NSE è…³æœ¬é€²è¡Œæ›´æ·±å…¥æ¢æ¸¬ã€‚",
         "life_example": "`-p 3306` åªæ˜¯çœ‹é–€æœ‰æ²’æœ‰é–‹ï¼›`-sV` æ˜¯æ•²é–€å•ï¼šã€Œè«‹å•è£¡é¢æ˜¯èª°ï¼Ÿã€ã€‚",
         "option_analysis": "(A) **nmap -sV -p 3306**ï¼šæ­£ç¢ºã€‚`-sV` å°ˆé–€æŸ¥ç‰ˆæœ¬ã€‚\n(B) **nmap -O ...**ï¼š`-O` æ˜¯æŸ¥ä½œæ¥­ç³»çµ± (OS) å¦‚ Windows/Linuxï¼Œä¸æ˜¯æŸ¥è»Ÿé«”ç‰ˆæœ¬ã€‚\n(C) **nmap -sS -T5**ï¼š`-sS` æ˜¯åŠé–‹æ”¾æƒæï¼Œåªçœ‹ Port é–‹é—œï¼›`-T5` æ˜¯é€Ÿåº¦å…¨é–‹ã€‚éƒ½çœ‹ä¸åˆ°ç‰ˆæœ¬ã€‚\n(D) **nmap -sV ... --script mysql-info**ï¼šæ­£ç¢ºã€‚åŠ äº† script å¯ä»¥æŸ¥åˆ°æ›´å¤šç´°ç¯€ï¼Œ`-sV` ä¹Ÿæ˜¯æ ¸å¿ƒã€‚",
         "supplement": "Nmap çš„ `-A` (Aggressive scan) åŒ…å«äº† `-sV`ã€`-O`ã€`-sC` (default scripts) å’Œ tracerouteï¼Œä¹Ÿæ˜¯å¸¸ç”¨çš„è¬èƒ½åƒæ•¸ã€‚",
         "law_def": "**Banner Grabbing**ï¼šä¸€ç¨®è’é›†ç›®æ¨™ç³»çµ±é–‹æ”¾åŸ å£ä¸Šæ‡‰ç”¨ç¨‹å¼è³‡è¨Šçš„æŠ€è¡“ã€‚",
         "analogy": "ä½ å»è²·é£²æ–™ã€‚`-p` æ˜¯çœ‹åº—å®¶æœ‰æ²’æœ‰é–‹ï¼›`-sV` æ˜¯çœ‹èœå–®ä¸Šæœ‰ä»€éº¼é£²æ–™ï¼›`-O` æ˜¯çœ‹åº—é¢è£æ½¢æ˜¯å“ªç¨®é¢¨æ ¼ã€‚",
         "mnemonic": "çœ‹ç‰ˆæœ¬ï¼Œè¨˜å¾— sVï¼›è¦æ›´ç´°ï¼ŒåŠ  scriptã€‚",
         "traps": "ä»¥ç‚ºæƒæç¯„åœè¶Šå¤§ (1-65535) è³‡è¨Šå°±è¶Šè©³ç´°ã€‚å…¶å¯¦ç¯„åœè·Ÿæ·±åº¦ç„¡é—œã€‚",
         "blind_spot": "ä»¥ç‚ºé€Ÿåº¦å¿« (-T5) æ¯”è¼ƒå²å®³ï¼Œå…¶å¯¦å¤ªå¿«å®¹æ˜“è¢«é˜²ç«ç‰†æ“‹ï¼Œä¸”è·Ÿç‰ˆæœ¬åµæ¸¬ç„¡é—œã€‚",
         "guide": "é¡Œç›®å•ä»€éº¼åƒæ•¸ï¼Œå°±æ‰¾é‚£å€‹åƒæ•¸çš„ä»£è™Ÿã€‚ç‰ˆæœ¬=Version=Vã€‚",
         "self_check_q": "å¦‚æœæˆ‘åªæƒ³çŸ¥é“ä¸»æ©Ÿæ˜¯ Windows é‚„æ˜¯ Linuxï¼Œè¦ç”¨å“ªå€‹åƒæ•¸ï¼Ÿ",
         "self_check_a": "é¸é … (B) çš„ -Oã€‚"
      }
    }
  ]
};

// --- æ ¸å¿ƒé‚è¼¯ ---

let currentTabId = 0; // 0 index based for tabs array
const userState = {}; // ç´€éŒ„æ¯é¡Œä½œç­”ç‹€æ…‹ { qId: { answered: bool, correct: bool, selected: [] } }

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', () => {
    initApp();
});

function initApp() {
    // æ¸²æŸ“æƒ…å¢ƒ
    document.getElementById('group-scenario-text').textContent = quizData.groupScenario;
    
    // åˆå§‹åŒ–ç‹€æ…‹èˆ‡è³‡æ–™
    quizData.questions.forEach((q, index) => {
        // 1. å…ˆçµæ§‹åŒ–é¸é …ï¼Œä¿ç•™ã€ŒåŸå§‹ä»£è™Ÿã€
        // å‡è¨­åŸå§‹æ ¼å¼å›ºå®šç‚º "(X) å…§å®¹"ï¼Œæˆ‘å€‘æŠŠä»£è™Ÿå’Œå…§å®¹åˆ†é–‹
        q.structuredOptions = q.options.map(opt => {
            // ç”¨æ­£å‰‡æå–ä»£è™Ÿ (A, B, C...) å’Œå‰©é¤˜å…§å®¹
            const match = opt.match(/^\(([A-Z])\)\s*(.*)/);
            if (match) {
                return {
                    originalId: match[1], // ä¾‹å¦‚ "A"
                    content: match[2]     // ä¾‹å¦‚ "Reconnaissanceï¼ˆåµå¯Ÿï¼‰"
                };
            } else {
                // å¦‚æœæ ¼å¼ä¸ç¬¦ï¼Œå°±ç•¶ä½œæ•´å€‹éƒ½æ˜¯å…§å®¹ï¼ŒID æš«æ™‚æœªçŸ¥(é€šå¸¸ä¸æœƒç™¼ç”Ÿ)
                return { originalId: '', content: opt };
            }
        });

        // 2. æ´—ç‰Œçµæ§‹åŒ–å¾Œçš„é™£åˆ— (å…§å®¹è¢«æ‰“äº‚ï¼Œä½†æ¯å€‹é …ç›®è¨˜å¾—è‡ªå·±åŸæœ¬æ˜¯èª°)
        q.shuffledOptions = shuffleArray([...q.structuredOptions]);
        
        // åˆå§‹ç‹€æ…‹
        userState[q.id] = { answered: false, correct: false, selected: [] };
    });

    renderTabs();
    renderQuestions();
    updateProgress();
    switchTab(0); // é è¨­é¡¯ç¤ºç¬¬ä¸€é¡Œ
}

// Fisher-Yates æ´—ç‰Œæ¼”ç®—æ³•
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

// Markdown è§£æå‡½å¼
function parseMarkdown(text) {
    if (!text) return '';
    return text
        // è™•ç†ç²—é«” **text** -> <strong>text</strong>
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        // è™•ç†æ›è¡Œ \n -> <br>
        .replace(/\n/g, '<br>');
}

// æ¸²æŸ“ Tabs
function renderTabs() {
    const container = document.getElementById('tabs-container');
    container.innerHTML = '';
    
    quizData.questions.forEach((q, index) => {
        const btn = document.createElement('button');
        btn.className = 'tab-btn';
        btn.dataset.index = index;
        
        // ç‹€æ…‹åœ–ç¤º
        let icon = '';
        const state = userState[q.id];
        if (state.answered) {
            btn.classList.add('completed');
            icon = state.correct ? '<span class="tab-icon">âœ“</span>' : '<span class="tab-icon">âœ—</span>';
        } else {
            icon = '<span class="tab-icon" style="color:#ccc">â—</span>';
        }
        
        btn.innerHTML = `${icon} ç¬¬ ${q.id} é¡Œ`;
        
        btn.onclick = () => switchTab(index);
        container.appendChild(btn);
    });
}

// åˆ‡æ› Tab
function switchTab(index) {
    currentTabId = index;
    
    // æ›´æ–°æŒ‰éˆ•æ¨£å¼
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`.tab-btn[data-index="${index}"]`).classList.add('active');
    
    // é¡¯ç¤ºå°æ‡‰é¡Œç›®å¡ç‰‡
    document.querySelectorAll('.question-card').forEach(card => card.classList.remove('active'));
    const targetCard = document.getElementById(`q-card-${quizData.questions[index].id}`);
    targetCard.classList.add('active');
    
    // å¹³æ»‘æ²å‹•å›é¡Œç›®é ‚ç«¯
    targetCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// æ¸²æŸ“é¡Œç›®
function renderQuestions() {
    const container = document.getElementById('questions-container');
    container.innerHTML = '';

    quizData.questions.forEach((q) => {
        const card = document.createElement('div');
        card.className = 'question-card';
        card.id = `q-card-${q.id}`;

        // æ¨™ç±¤æ¨£å¼å°æ‡‰
        let tagClass = 'tag-sec'; // default
        if (q.tag === 'web-sec') tagClass = 'tag-sec';
        if (q.tag === 'net') tagClass = 'tag-net';
        if (q.tag === 'sec') tagClass = 'tag-sec'; 

        // é—œéµå­—æ¨™ç´…è™•ç†
        const highlightedText = highlightKeywords(q.text);

        // é¡Œç›®çµæ§‹
        card.innerHTML = `
            <div class="q-header">
                <span class="q-badge ${tagClass}">${q.tagName}</span>
                <span style="color:#999; font-size:0.9rem;">#ID: ${q.id}</span>
            </div>
            <div class="q-text">${highlightedText}</div>
            
            <div class="options-grid" id="options-box-${q.id}">
                ${q.shuffledOptions.map((opt, i) => {
                    const displayLabel = String.fromCharCode(65 + i); // 65 is 'A'
                    const val = opt.originalId; 
                    const inputType = q.correct.length > 1 ? 'checkbox' : 'radio';
                    
                    // é¸é …å…§å®¹ä¹Ÿè¦éä¸€æ¬¡ Markdown parserï¼Œä»¥é˜²å…§å®¹æœ‰ç²—é«”
                    const parsedOptionContent = parseMarkdown(opt.content);

                    return `
                    <label class="option-item" data-val="${val}">
                        <input type="${inputType}" name="q-${q.id}" value="${val}" class="option-input">
                        <span>(${displayLabel}) ${parsedOptionContent}</span>
                    </label>
                    `;
                }).join('')}
            </div>

            <div class="action-area">
                <button class="btn btn-reset" id="btn-reset-${q.id}" onclick="resetQuestion(${q.id})">é‡æ–°ä½œç­”</button>
                <button class="btn btn-submit" id="btn-submit-${q.id}" onclick="submitAnswer(${q.id})">é€å‡ºç­”æ¡ˆ</button>
            </div>

            <div class="explain-section" id="explain-${q.id}">
                <div class="exp-detail-container">
                    ${renderExplainBlock('ğŸ” ç¬¬ä¸€æ­¥ï¼šæ‰¾é—œéµå­—', q.analysis.keyword)}
                    ${renderExplainBlock('ğŸ—£ï¸ ç¬¬äºŒæ­¥ï¼šç™½è©±ç¿»è­¯', q.analysis.translation)}
                    ${renderExplainBlock('ğŸ’¡ ç¬¬ä¸‰æ­¥ï¼šè§£é¡Œæ€è·¯', q.analysis.logic_thought)}
                    ${renderExplainBlock('ğŸ‘£ è§£é¡Œæ­¥é©Ÿ', q.analysis.steps)}
                    ${renderExplainBlock('ğŸ“ åŸç†èˆ‡è¦å‰‡', q.analysis.principles)}
                    ${renderExplainBlock('ğŸ ç”Ÿæ´»ä¾‹å­', q.analysis.life_example)}
                    ${renderExplainBlock('ğŸ“Š ç¬¬å››æ­¥ï¼šé¸é …åˆ†æ', q.analysis.option_analysis)}
                    ${renderExplainBlock('ğŸ“š è§€å¿µè£œå……èˆ‡å»¶ä¼¸', q.analysis.supplement)}
                    ${renderExplainBlock('âš–ï¸ æ³•æ¢æˆ–å®šç¾©ï¼ˆç™½è©±ï¼‰', q.analysis.law_def)}
                    ${renderExplainBlock('ğŸ”— è§¸é¡æ—é€šï¼ˆèˆ‰ä¸€åä¸‰ï¼‰', q.analysis.analogy)}
                    ${renderExplainBlock('ğŸ”‘ è¨˜æ†¶å£è¨£', q.analysis.mnemonic)}
                    ${renderExplainBlock('ğŸª¤ å¸¸è¦‹é™·é˜±', q.analysis.traps)}
                    ${renderExplainBlock('ğŸ™ˆ å¿ƒç†ç›²é»', q.analysis.blind_spot)}
                    ${renderExplainBlock('ğŸš§ é¿å‘æŒ‡å—', q.analysis.guide)}
                </div>

                <div class="self-check-box">
                    <div class="self-check-title">ğŸ¤” è‡ªæˆ‘æª¢æ¸¬</div>
                    <div class="self-check-question">Q: ${parseMarkdown(q.analysis.self_check_q)}</div>
                    <button class="self-check-answer-btn" onclick="toggleSelfCheck(this)">æŸ¥çœ‹åƒè€ƒç­”æ¡ˆ</button>
                    <div class="self-check-answer-content">A: ${parseMarkdown(q.analysis.self_check_a)}</div>
                </div>
            </div>
        `;
        container.appendChild(card);
    });
}

function renderExplainBlock(title, content) {
    if (!content) return '';
    // åœ¨é€™è£¡å‘¼å« parseMarkdown ä¾†è½‰æ›å…§å®¹
    const htmlContent = parseMarkdown(content);
    return `
    <div class="exp-block">
        <div class="exp-title">${title}</div>
        <div class="exp-text">${htmlContent}</div>
    </div>
    `;
}

// é—œéµå­—æ¨™ç´…é‚è¼¯
function highlightKeywords(text) {
    const negativeWords = ["ä¸æ­£ç¢º", "ä¸æ˜¯", "éŒ¯èª¤", "æœ€ä¸é©ç”¨", "ä¸åŒ…å«"];
    let newText = text;
    negativeWords.forEach(word => {
        const regex = new RegExp(word, "g");
        newText = newText.replace(regex, `<span class="highlight-negative">${word}</span>`);
    });
    return newText;
}

// é€å‡ºç­”æ¡ˆé‚è¼¯
function submitAnswer(qId) {
    const qData = quizData.questions.find(q => q.id === qId);
    const optionsBox = document.getElementById(`options-box-${qId}`);
    const inputs = optionsBox.querySelectorAll('input:checked');
    const selectedVals = Array.from(inputs).map(i => i.value);

    if (selectedVals.length === 0) {
        alert("è«‹å…ˆé¸æ“‡ç­”æ¡ˆï¼");
        return;
    }

    // é–å®šé¸é …
    const allInputs = optionsBox.querySelectorAll('input');
    allInputs.forEach(input => input.disabled = true);
    optionsBox.querySelectorAll('.option-item').forEach(item => item.classList.add('disabled'));

    // åˆ¤æ–·å°éŒ¯ (é™£åˆ—æ¯”å°)
    const sortedSelected = selectedVals.sort().toString();
    const sortedCorrect = qData.correct.sort().toString();
    const isCorrect = sortedSelected === sortedCorrect;

    // æ›´æ–°ç‹€æ…‹
    userState[qId] = { answered: true, correct: isCorrect, selected: selectedVals };
    updateProgress();
    renderTabs(); // æ›´æ–° Tabs é¡è‰²

    // UI åé¥‹
    const labels = optionsBox.querySelectorAll('.option-item');
    labels.forEach(label => {
        const val = label.dataset.val; // é€™æ˜¯åŸå§‹ ID
        if (qData.correct.includes(val)) {
            label.classList.add('correct-ans');
        }
        if (selectedVals.includes(val) && !qData.correct.includes(val)) {
            label.classList.add('wrong-ans');
        }
    });

    // æŒ‰éˆ•åˆ‡æ›
    document.getElementById(`btn-submit-${qId}`).style.display = 'none';
    document.getElementById(`btn-reset-${qId}`).style.display = 'flex';

    // é¡¯ç¤ºè©³è§£
    const explainSec = document.getElementById(`explain-${qId}`);
    explainSec.style.display = 'block';
    
    // è‡ªå‹•æ²å‹•åˆ°è©³è§£
    explainSec.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

// å–®é¡Œé‡ç½®é‚è¼¯
function resetQuestion(qId) {
    // æ¸…é™¤ç‹€æ…‹
    userState[qId] = { answered: false, correct: false, selected: [] };
    
    // UI å¾©åŸ
    const optionsBox = document.getElementById(`options-box-${qId}`);
    const inputs = optionsBox.querySelectorAll('input');
    inputs.forEach(input => {
        input.checked = false;
        input.disabled = false;
    });
    
    const labels = optionsBox.querySelectorAll('.option-item');
    labels.forEach(label => {
        label.classList.remove('disabled', 'correct-ans', 'wrong-ans', 'selected');
    });

    // å¾©åŸè‡ªæˆ‘æª¢æ¸¬æŒ‰éˆ•
    const explainSec = document.getElementById(`explain-${qId}`);
    const selfCheckBtn = explainSec.querySelector('.self-check-answer-btn');
    const selfCheckContent = explainSec.querySelector('.self-check-answer-content');
    if(selfCheckBtn) {
        selfCheckBtn.style.display = 'inline-block';
        selfCheckContent.style.display = 'none';
    }

    // æŒ‰éˆ•åˆ‡æ›
    document.getElementById(`btn-submit-${qId}`).style.display = 'flex';
    document.getElementById(`btn-reset-${qId}`).style.display = 'none';

    // éš±è—è©³è§£
    explainSec.style.display = 'none';

    // æ›´æ–°é€²åº¦èˆ‡Tabs
    updateProgress();
    renderTabs();

    // æ²å‹•å›é ‚ç«¯
    document.getElementById(`q-card-${qId}`).scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// è‡ªæˆ‘æª¢æ¸¬ç­”æ¡ˆåˆ‡æ›
function toggleSelfCheck(btn) {
    const content = btn.nextElementSibling;
    content.style.display = 'block';
    btn.style.display = 'none';
}

// æ›´æ–°é€²åº¦æ¢
function updateProgress() {
    const total = quizData.questions.length;
    const completed = Object.values(userState).filter(s => s.answered).length;
    
    document.getElementById('progress-text').textContent = `${completed}/${total}`;
    
    const percent = (completed / total) * 100;
    document.getElementById('progress-bar').style.width = `${percent}%`;
}

// ç›£è½é¸é …é»æ“Š (ç‚ºäº†è¦–è¦ºæ•ˆæœ)
document.addEventListener('change', (e) => {
    if (e.target.classList.contains('option-input')) {
        const label = e.target.closest('.option-item');
        const container = label.parentElement;
        
        if (e.target.type === 'radio') {
            container.querySelectorAll('.option-item').forEach(l => l.classList.remove('selected'));
        }
        
        if (e.target.checked) {
            label.classList.add('selected');
        } else {
            label.classList.remove('selected');
        }
    }
});

</script>

</body>
</html>